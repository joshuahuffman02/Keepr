generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model AbEnrollment {
  id             String        @id
  testId         String
  variantId      String
  campgroundId   String?
  organizationId String?
  sessionId      String
  enrolledAt     DateTime      @default(now())
  Campground     Campground?   @relation(fields: [campgroundId], references: [id])
  Organization   Organization? @relation(fields: [organizationId], references: [id])
  AbTest         AbTest        @relation(fields: [testId], references: [id], onDelete: Cascade)
  AbVariant      AbVariant     @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([testId, sessionId])
  @@index([campgroundId])
  @@index([organizationId])
}

model AbTest {
  id             String         @id
  campgroundId   String?
  organizationId String?
  key            String         @unique
  name           String
  description    String?
  status         AbTestStatus   @default(draft)
  startedAt      DateTime?
  endedAt        DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @default(now())
  AbEnrollment   AbEnrollment[]
  Campground     Campground?    @relation(fields: [campgroundId], references: [id])
  Organization   Organization?  @relation(fields: [organizationId], references: [id])
  AbVariant      AbVariant[]

  @@index([campgroundId, status])
  @@index([organizationId, status])
}

model AbVariant {
  id             String           @id
  testId         String
  name           String
  description    String?
  weight         Int?
  createdAt      DateTime         @default(now())
  AbEnrollment   AbEnrollment[]
  AbTest         AbTest           @relation(fields: [testId], references: [id], onDelete: Cascade)
  AnalyticsEvent AnalyticsEvent[]

  @@index([testId])
}

model AccessCredential {
  id                String               @id
  campgroundId      String
  reservationId     String?
  vehicleId         String?
  integrationId     String?
  provider          AccessProviderType
  type              AccessCredentialType
  maskedValue       String?
  secretHash        String?
  label             String?
  metadata          Json?
  status            AccessGrantStatus    @default(pending)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  Campground        Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  AccessIntegration AccessIntegration?   @relation(fields: [integrationId], references: [id])
  Reservation       Reservation?         @relation(fields: [reservationId], references: [id])
  Vehicle           Vehicle?             @relation(fields: [vehicleId], references: [id])
  AccessGrant       AccessGrant[]

  @@index([campgroundId])
  @@index([reservationId])
  @@index([vehicleId])
}

model AccessGrant {
  id                String             @id
  campgroundId      String
  reservationId     String
  siteId            String?
  vehicleId         String?
  credentialId      String?
  integrationId     String?
  provider          AccessProviderType
  status            AccessGrantStatus  @default(pending)
  providerAccessId  String?
  startsAt          DateTime?
  endsAt            DateTime?
  blockedReason     String?
  idempotencyKey    String?
  lastSyncAt        DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  Campground        Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  AccessCredential  AccessCredential?  @relation(fields: [credentialId], references: [id])
  AccessIntegration AccessIntegration? @relation(fields: [integrationId], references: [id])
  Reservation       Reservation        @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  Site              Site?              @relation(fields: [siteId], references: [id])
  Vehicle           Vehicle?           @relation(fields: [vehicleId], references: [id])

  @@unique([reservationId, provider])
  @@index([campgroundId])
  @@index([endsAt])
  @@index([provider, idempotencyKey])
  @@index([reservationId])
  @@index([siteId])
}

model AccessIntegration {
  id               String             @id
  campgroundId     String
  provider         AccessProviderType
  displayName      String?
  status           String?            @default("enabled")
  credentials      Json
  webhookSecret    String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  AccessCredential AccessCredential[]
  AccessGrant      AccessGrant[]
  Campground       Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, provider])
  @@index([campgroundId])
}

model Activity {
  id                        String                      @id
  campgroundId              String
  name                      String
  description               String?
  images                    String[]                    @default([])
  price                     Int
  duration                  Int
  capacity                  Int
  isActive                  Boolean                     @default(true)
  schedulingMode            ActivitySchedulingMode      @default(scheduled)
  operatingHours            Json?
  slotDuration              Int?
  maxConcurrent             Int?
  weekendPremium            Int?
  holidayPremium            Int?
  earlyBirdDiscount         Int?
  earlyBirdDays             Int?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  Campground                Campground                  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ActivityBundleItem        ActivityBundleItem[]
  ActivityRecurrencePattern ActivityRecurrencePattern[]
  ActivitySession           ActivitySession[]
}

model ActivityBooking {
  id              String          @id
  sessionId       String
  guestId         String
  reservationId   String?
  quantity        Int
  totalAmount     Int
  status          String          @default("confirmed")
  createdAt       DateTime        @default(now())
  Guest           Guest           @relation(fields: [guestId], references: [id], onDelete: Cascade)
  Reservation     Reservation?    @relation(fields: [reservationId], references: [id])
  ActivitySession ActivitySession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model ActivityBundle {
  id                 String               @id
  campgroundId       String
  name               String
  description        String?
  price              Int
  discountType       String               @default("fixed")
  discountValue      Int?
  isActive           Boolean              @default(true)
  validFrom          DateTime?
  validUntil         DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  Campground         Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ActivityBundleItem ActivityBundleItem[]

  @@index([campgroundId, isActive])
}

model ActivityBundleItem {
  id             String         @id
  bundleId       String
  activityId     String
  quantity       Int            @default(1)
  Activity       Activity       @relation(fields: [activityId], references: [id], onDelete: Cascade)
  ActivityBundle ActivityBundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)

  @@unique([bundleId, activityId])
}

model ActivityRecurrencePattern {
  id          String                @id
  activityId  String
  patternType RecurrencePatternType
  daysOfWeek  Int[]
  dayOfMonth  Int?
  weekOfMonth Int?
  startTime   String
  endTime     String
  validFrom   DateTime
  validUntil  DateTime?
  capacity    Int?
  isActive    Boolean               @default(true)
  createdAt   DateTime              @default(now())
  updatedAt   DateTime
  Activity    Activity              @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId, isActive])
}

model ActivitySession {
  id                  String            @id
  activityId          String
  recurrencePatternId String?
  startTime           DateTime
  endTime             DateTime
  capacity            Int
  bookedCount         Int               @default(0)
  status              String            @default("scheduled")
  priceOverride       Int?
  ActivityBooking     ActivityBooking[]
  Activity            Activity          @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId, startTime])
  @@index([startTime, status])
}

model AddOnService {
  id             String           @id
  campgroundId   String
  name           String
  description    String?
  priceCents     Int
  pricingType    AddOnPricingType @default(flat)
  isActive       Boolean          @default(true)
  sortOrder      Int              @default(0)
  glCode         String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now())
  Campground     Campground       @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StoreOrderItem StoreOrderItem[]

  @@index([campgroundId])
}

model AiAnomalyAlert {
  id               String     @id
  campgroundId     String
  type             String
  severity         String
  title            String
  summary          String
  aiAnalysis       String?
  suggestedAction  String?
  metric           String
  currentValue     Float
  expectedValue    Float
  deviation        Float
  comparisonPeriod String?
  status           String     @default("new")
  acknowledgedById String?
  acknowledgedAt   DateTime?
  resolvedAt       DateTime?
  dismissedReason  String?
  detectedAt       DateTime
  digestIncluded   Boolean    @default(false)
  digestSentAt     DateTime?
  metadata         Json?
  createdAt        DateTime   @default(now())
  Campground       Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, detectedAt])
  @@index([campgroundId])
  @@index([campgroundId, severity])
  @@index([campgroundId, status])
}

model AiAutonomousAction {
  id             String     @id
  campgroundId   String
  actionType     String
  entityType     String
  entityId       String
  description    String
  details        Json
  confidence     Float?
  reasoning      String?
  reversible     Boolean    @default(false)
  reversedAt     DateTime?
  reversedById   String?
  reversedReason String?
  outcome        String?
  outcomeDetails String?
  createdAt      DateTime   @default(now())
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, actionType])
  @@index([campgroundId, createdAt])
  @@index([campgroundId])
  @@index([entityType, entityId])
}

model AiAutopilotConfig {
  id                           String     @id
  campgroundId                 String     @unique
  autoReplyEnabled             Boolean    @default(false)
  autoReplyMode                String     @default("draft")
  autoReplyConfidenceThreshold Float      @default(0.8)
  autoReplyDelayMinutes        Int        @default(5)
  autoReplyExcludeCategories   String[]   @default([])
  smartWaitlistEnabled         Boolean    @default(false)
  smartWaitlistMode            String     @default("suggest")
  waitlistGuestValueWeight     Float      @default(0.3)
  waitlistLikelihoodWeight     Float      @default(0.3)
  waitlistSeasonalWeight       Float      @default(0.2)
  anomalyDetectionEnabled      Boolean    @default(false)
  anomalyAlertMode             String     @default("digest")
  anomalyDigestSchedule        String     @default("daily")
  anomalyDigestTime            String     @default("08:00")
  anomalySensitivity           String     @default("medium")
  noShowPredictionEnabled      Boolean    @default(false)
  noShowThreshold              Float      @default(0.7)
  noShowAutoReminder           Boolean    @default(false)
  noShowReminderDaysBefore     Int        @default(2)
  autoReplyAutoSendEnabled     Boolean    @default(false)
  autoReplyMaxDailyAutoSends   Int        @default(50)
  waitlistAutoOfferEnabled     Boolean    @default(false)
  waitlistAutoOfferMinScore    Float      @default(75)
  waitlistAutoOfferHoldMinutes Int        @default(30)
  anomalyAutoFixEnabled        Boolean    @default(false)
  anomalyAutoFixCategories     String[]   @default([])
  noShowAutoReleaseEnabled     Boolean    @default(false)
  noShowAutoConfirmHours       Int        @default(24)
  noShowAutoReleaseHours       Int        @default(4)
  dynamicPricingAiEnabled      Boolean    @default(false)
  dynamicPricingMode           String     @default("suggest")
  dynamicPricingMaxAdjust      Float      @default(50)
  predictiveMaintenanceEnabled Boolean    @default(false)
  maintenanceAlertThreshold    Int        @default(3)
  weatherAlertsEnabled         Boolean    @default(false)
  weatherApiKey                String?
  weatherTriggers              Json?
  phoneAgentEnabled            Boolean    @default(false)
  phoneAgentNumber             String?
  phoneAgentTransferNumber     String?
  phoneAgentHoursStart         String?
  phoneAgentHoursEnd           String?
  phoneAgentVoice              String     @default("alloy")
  morningBriefingEnabled       Boolean    @default(false)
  morningBriefingTime          String     @default("07:00")
  createdAt                    DateTime   @default(now())
  updatedAt                    DateTime
  Campground                   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model AiCampgroundContext {
  id           String     @id
  campgroundId String
  type         String
  question     String?
  answer       String
  category     String?
  priority     Int        @default(0)
  isActive     Boolean    @default(true)
  source       String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, category])
  @@index([campgroundId])
  @@index([campgroundId, isActive])
  @@index([campgroundId, type])
}

model AiConsentRecord {
  id           String        @id
  campgroundId String
  guestId      String?
  sessionId    String?
  consentType  AiConsentType
  granted      Boolean       @default(true)
  ipHash       String?
  userAgent    String?
  grantedAt    DateTime      @default(now())
  revokedAt    DateTime?
  source       String?

  @@index([campgroundId, guestId])
  @@index([consentType, granted])
  @@index([sessionId])
}

model AiDashboardMetrics {
  id                             String     @id
  campgroundId                   String
  periodStart                    DateTime
  periodEnd                      DateTime
  messagesReceived               Int        @default(0)
  messagesHandled                Int        @default(0)
  messagesAutoSent               Int        @default(0)
  avgResponseTimeMinutes         Float?
  risksIdentified                Int        @default(0)
  noShowsPrevented               Int        @default(0)
  anomaliesDetected              Int        @default(0)
  anomaliesResolved              Int        @default(0)
  pricingSuggestions             Int        @default(0)
  pricingSuggestionsApplied      Int        @default(0)
  pricingRevenueDelta            Int        @default(0)
  phoneCallsReceived             Int        @default(0)
  phoneCallsHandled              Int        @default(0)
  phoneCallsTransferred          Int        @default(0)
  avgCallDurationSeconds         Int?
  waitlistOffersGenerated        Int        @default(0)
  waitlistOffersAccepted         Int        @default(0)
  estimatedRevenueSavedCents     Int        @default(0)
  estimatedRevenueGeneratedCents Int        @default(0)
  aiTokensUsed                   Int        @default(0)
  aiCostCents                    Int        @default(0)
  roiPercent                     Float?
  calculatedAt                   DateTime   @default(now())
  Campground                     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, periodStart, periodEnd])
  @@index([campgroundId])
  @@index([periodStart])
}

model AiInteractionLog {
  id           String        @id
  campgroundId String
  featureType  AiFeatureType
  promptHash   String
  responseHash String
  tokensUsed   Int
  inputTokens  Int?
  outputTokens Int?
  latencyMs    Int
  userId       String?
  sessionId    String?
  success      Boolean       @default(true)
  errorType    String?
  provider     String        @default("openai")
  modelUsed    String?
  costCents    Int?
  createdAt    DateTime      @default(now())

  @@index([campgroundId, createdAt])
  @@index([featureType, createdAt])
  @@index([userId, createdAt])
}

model AiMaintenanceAlert {
  id                  String     @id
  campgroundId        String
  siteId              String?
  alertType           String
  severity            String
  category            String
  title               String
  summary             String
  incidentCount       Int
  incidentIds         String[]
  predictedFailure    DateTime?
  confidence          Float
  suggestedAction     String
  estimatedCostCents  Int?
  status              String     @default("new")
  acknowledgedAt      DateTime?
  acknowledgedById    String?
  maintenanceTicketId String?
  resolvedAt          DateTime?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  Campground          Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, severity])
  @@index([campgroundId, status])
  @@index([siteId])
}

model AiNoShowRisk {
  id                  String      @id
  reservationId       String      @unique
  campgroundId        String
  riskScore           Float
  paymentStatusScore  Int
  leadTimeScore       Int
  guestHistoryScore   Int
  communicationScore  Int
  bookingPatternScore Int
  factors             Json?
  flagged             Boolean     @default(false)
  staffNotifiedAt     DateTime?
  reminderSentAt      DateTime?
  guestConfirmedAt    DateTime?
  outcome             String?
  calculatedAt        DateTime    @default(now())
  updatedAt           DateTime
  Reservation         Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@index([campgroundId, flagged])
  @@index([campgroundId])
  @@index([campgroundId, riskScore])
  @@index([reservationId])
}

model AiPhoneSession {
  id                  String     @id
  campgroundId        String
  twilioCallSid       String     @unique
  callerPhone         String
  guestId             String?
  reservationId       String?
  status              String
  startedAt           DateTime   @default(now())
  connectedAt         DateTime?
  endedAt             DateTime?
  durationSeconds     Int?
  transcript          String?
  summary             String?
  intents             String[]
  actionsPerformed    Json?
  transferredAt       DateTime?
  transferReason      String?
  transferredTo       String?
  voicemailUrl        String?
  voicemailTranscript String?
  sentiment           String?
  resolutionStatus    String?
  tokensUsed          Int        @default(0)
  costCents           Int        @default(0)
  metadata            Json?
  Campground          Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([callerPhone])
  @@index([campgroundId])
  @@index([campgroundId, status])
  @@index([guestId])
  @@index([startedAt])
}

model AiPriceExperiment {
  id              String     @id
  campgroundId    String
  siteClassId     String
  name            String
  description     String?
  hypothesis      String
  controlPrice    Int
  testPrice       Int
  adjustmentPct   Float
  startDate       DateTime
  endDate         DateTime
  controlSiteIds  String[]
  testSiteIds     String[]
  controlBookings Int        @default(0)
  testBookings    Int        @default(0)
  controlRevenue  Int        @default(0)
  testRevenue     Int        @default(0)
  controlViews    Int        @default(0)
  testViews       Int        @default(0)
  pValue          Float?
  confidenceLevel Float?
  winner          String?
  liftPercent     Float?
  status          String     @default("draft")
  autoApplyWinner Boolean    @default(false)
  winnerApplied   Boolean    @default(false)
  winnerAppliedAt DateTime?
  createdAt       DateTime   @default(now())
  createdById     String?
  updatedAt       DateTime
  Campground      Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, status])
  @@index([siteClassId])
}

model AiPricingRecommendation {
  id                    String     @id
  campgroundId          String
  siteClassId           String?
  dateStart             DateTime
  dateEnd               DateTime
  recommendationType    String
  currentPriceCents     Int
  suggestedPriceCents   Int
  adjustmentPercent     Float
  confidence            Float
  reasoning             String
  factors               Json
  status                String     @default("pending")
  appliedAt             DateTime?
  appliedById           String?
  dismissedAt           DateTime?
  dismissedById         String?
  dismissedReason       String?
  estimatedRevenueDelta Int?
  createdAt             DateTime   @default(now())
  expiresAt             DateTime
  Campground            Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, dateStart])
  @@index([campgroundId])
  @@index([campgroundId, status])
  @@index([siteClassId])
}

model AiReplyDraft {
  id                  String     @id
  campgroundId        String
  communicationId     String
  guestId             String?
  reservationId       String?
  inboundSubject      String?
  inboundPreview      String?
  draftContent        String
  confidence          Float
  detectedIntent      String?
  detectedTone        String?
  usedContextIds      String[]   @default([])
  usedContextSummary  String?
  status              String     @default("pending")
  reviewedById        String?
  reviewedAt          DateTime?
  editedContent       String?
  rejectionReason     String?
  sentAt              DateTime?
  autoSendScheduledAt DateTime?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  Campground          Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([autoSendScheduledAt, status])
  @@index([campgroundId])
  @@index([campgroundId, status])
  @@index([communicationId])
}

model AiRevenueInsight {
  id              String     @id
  campgroundId    String
  insightType     String
  title           String
  summary         String
  impactCents     Int
  difficulty      String
  priority        Int        @default(50)
  recommendations Json
  status          String     @default("new")
  completedAt     DateTime?
  dismissedAt     DateTime?
  dismissedReason String?
  metadata        Json?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  Campground      Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, insightType])
  @@index([campgroundId, status])
}

model AiWaitlistScore {
  id                 String        @id
  waitlistEntryId    String        @unique
  campgroundId       String
  baseScore          Int
  guestLtvScore      Int
  bookingLikelihood  Int
  seasonalFitScore   Int
  communicationScore Int           @default(50)
  aiScore            Float
  aiReason           String?
  calculatedAt       DateTime      @default(now())
  WaitlistEntry      WaitlistEntry @relation(fields: [waitlistEntryId], references: [id], onDelete: Cascade)

  @@index([campgroundId, aiScore])
  @@index([campgroundId])
}

model AiWeatherAlert {
  id                String     @id
  campgroundId      String
  alertType         String
  severity          String
  weatherData       Json
  title             String
  message           String
  startTime         DateTime
  endTime           DateTime?
  affectedDates     DateTime[]
  guestsAffected    Int        @default(0)
  guestsNotified    Int        @default(0)
  notificationsSent Json?
  status            String     @default("active")
  autoNotifyEnabled Boolean    @default(false)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime
  Campground        Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, status])
  @@index([startTime])
}

model AnalyticsAnomaly {
  id             String        @id
  campgroundId   String?
  organizationId String?
  anomalyType    String
  severity       String
  metric         String
  expectedValue  Float
  actualValue    Float
  deviation      Float
  detectedAt     DateTime      @default(now())
  acknowledgedAt DateTime?
  acknowledgedBy String?
  notes          String?
  metadata       Json?
  Campground     Campground?   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([anomalyType, detectedAt])
  @@index([campgroundId, detectedAt])
  @@index([organizationId, detectedAt])
  @@index([severity, acknowledgedAt])
}

model AnalyticsDailyAggregate {
  id             String             @id
  campgroundId   String?
  organizationId String?
  eventName      AnalyticsEventName
  date           DateTime
  count          Int                @default(0)
  uniqueSessions Int?               @default(0)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @default(now())
  Campground     Campground?        @relation(fields: [campgroundId], references: [id])
  Organization   Organization?      @relation(fields: [organizationId], references: [id])

  @@unique([campgroundId, eventName, date])
  @@index([organizationId, eventName, date])
}

model AnalyticsEvent {
  id             String             @id
  campgroundId   String?
  organizationId String?
  reservationId  String?
  siteId         String?
  siteClassId    String?
  promotionId    String?
  imageId        String?
  sessionId      String
  eventName      AnalyticsEventName
  page           String?
  referrer       String?
  referrerUrl    String?
  deviceType     String?
  region         String?
  abVariantId    String?
  metadata       Json?
  occurredAt     DateTime           @default(now())
  createdAt      DateTime           @default(now())
  AbVariant      AbVariant?         @relation(fields: [abVariantId], references: [id])
  Campground     Campground?        @relation(fields: [campgroundId], references: [id])
  Organization   Organization?      @relation(fields: [organizationId], references: [id])
  Promotion      Promotion?         @relation(fields: [promotionId], references: [id])
  Reservation    Reservation?       @relation(fields: [reservationId], references: [id])
  SiteClass      SiteClass?         @relation(fields: [siteClassId], references: [id])
  Site           Site?              @relation(fields: [siteId], references: [id])

  @@index([abVariantId])
  @@index([campgroundId, occurredAt])
  @@index([eventName, occurredAt])
  @@index([organizationId, occurredAt])
  @@index([promotionId])
  @@index([sessionId, occurredAt])
  @@index([siteClassId])
  @@index([siteId])
}

model AnalyticsExport {
  id               String        @id
  analyticsType    AnalyticsType
  format           ExportFormat
  status           ExportStatus  @default(pending)
  scope            SegmentScope  @default(campground)
  organizationId   String?
  campgroundId     String?
  segmentId        String?
  dateRange        String?
  filters          Json?
  includePII       Boolean       @default(false)
  requestedBy      String
  requestedByEmail String
  fileName         String?
  fileUrl          String?
  fileSize         Int?
  rowCount         Int?
  startedAt        DateTime?
  completedAt      DateTime?
  errorMessage     String?
  emailTo          String[]      @default([])
  emailSentAt      DateTime?
  createdAt        DateTime      @default(now())
  expiresAt        DateTime?
  Campground       Campground?   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([createdAt])
  @@index([organizationId])
  @@index([requestedBy])
  @@index([status])
}

model AnalyticsFeatureUsage {
  id              String        @id
  campgroundId    String
  organizationId  String?
  date            DateTime      @db.Date
  feature         String
  subFeature      String?
  usageCount      Int           @default(0)
  uniqueUsers     Int           @default(0)
  avgDurationSecs Float?
  successRate     Float?
  errorCount      Int           @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  Campground      Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, date, feature, subFeature])
  @@index([feature, date])
  @@index([organizationId, date])
}

model AnalyticsFunnel {
  id                String        @id
  campgroundId      String
  organizationId    String?
  sessionId         String
  funnelName        String
  step1At           DateTime?
  step2At           DateTime?
  step3At           DateTime?
  step4At           DateTime?
  step5At           DateTime?
  step6At           DateTime?
  stepNames         String[]      @default([])
  completedAt       DateTime?
  abandonedAt       DateTime?
  abandonedStep     Int?
  abandonReason     String?
  metadata          Json?
  totalDurationSecs Int?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  Campground        Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Organization      Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([campgroundId, funnelName, createdAt])
  @@index([funnelName, abandonedStep])
  @@index([funnelName, completedAt])
  @@index([organizationId, funnelName, createdAt])
  @@index([sessionId])
}

model AnalyticsLiveEvent {
  id             String   @id
  campgroundId   String?
  organizationId String?
  sessionId      String
  eventType      String
  eventData      Json
  actorType      String
  actorId        String?
  occurredAt     DateTime @default(now())
  expiresAt      DateTime

  @@index([campgroundId, occurredAt])
  @@index([expiresAt])
  @@index([organizationId, occurredAt])
}

model AnalyticsPageStats {
  id             String        @id
  campgroundId   String?
  organizationId String?
  date           DateTime      @db.Date
  path           String
  pageTitle      String?
  featureArea    String?
  views          Int           @default(0)
  uniqueUsers    Int           @default(0)
  uniqueSessions Int           @default(0)
  avgTimeOnPage  Float?
  avgScrollDepth Float?
  bounceRate     Float?
  actions        Int           @default(0)
  searches       Int           @default(0)
  errors         Int           @default(0)
  formSubmits    Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  Campground     Campground?   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, date, path])
  @@index([date])
  @@index([featureArea, date])
  @@index([organizationId, date, path])
}

model AnalyticsSession {
  id             String             @id
  sessionId      String             @unique
  actorType      AnalyticsActorType @default(anonymous)
  userId         String?
  guestId        String?
  campgroundId   String?
  organizationId String?
  startedAt      DateTime
  endedAt        DateTime?
  durationSecs   Int?
  pageViews      Int                @default(0)
  actions        Int                @default(0)
  errors         Int                @default(0)
  entryPage      String?
  exitPage       String?
  pages          String[]           @default([])
  deviceType     String?
  browser        String?
  os             String?
  userAgent      String?
  screenSize     String?
  locale         String?
  country        String?
  region         String?
  city           String?
  referrer       String?
  utmSource      String?
  utmMedium      String?
  utmCampaign    String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime
  Campground     Campground?        @relation(fields: [campgroundId], references: [id])
  Guest          Guest?             @relation(fields: [guestId], references: [id])
  Organization   Organization?      @relation(fields: [organizationId], references: [id])
  User           User?              @relation(fields: [userId], references: [id])

  @@index([actorType, startedAt])
  @@index([campgroundId, startedAt])
  @@index([organizationId, startedAt])
  @@index([startedAt])
  @@index([userId, startedAt])
}

model AnalyticsShareLink {
  id             String           @id
  token          String           @unique
  analyticsType  AnalyticsType
  accessLevel    ShareAccessLevel @default(view_only)
  scope          SegmentScope     @default(campground)
  organizationId String?
  campgroundId   String?
  segmentId      String?
  dateRange      String?
  filters        Json?
  sharedBy       String
  sharedByEmail  String
  password       String?
  expiresAt      DateTime?
  maxViews       Int?
  viewCount      Int              @default(0)
  name           String?
  description    String?
  createdAt      DateTime         @default(now())
  revokedAt      DateTime?
  lastAccessedAt DateTime?
  Campground     Campground?      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([expiresAt])
  @@index([organizationId])
  @@index([sharedBy])
  @@index([token])
}

model AnalyticsStaffMetrics {
  id                   String     @id
  campgroundId         String
  userId               String
  date                 DateTime   @db.Date
  sessionsCount        Int        @default(0)
  totalSessionSecs     Int        @default(0)
  avgSessionSecs       Float?
  pageViews            Int        @default(0)
  actionsCount         Int        @default(0)
  searchesCount        Int        @default(0)
  errorsCount          Int        @default(0)
  reservationsCreated  Int        @default(0)
  reservationsModified Int        @default(0)
  checkInsCompleted    Int        @default(0)
  paymentsProcessed    Int        @default(0)
  guestsCreated        Int        @default(0)
  avgCheckInTime       Float?
  avgReservationTime   Float?
  avgPaymentTime       Float?
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  Campground           Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User                 User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, userId, date])
  @@index([date])
  @@index([userId, date])
}

model Announcement {
  id             String             @id
  createdAt      DateTime           @default(now())
  updatedAt      DateTime
  title          String
  message        String
  type           AnnouncementType   @default(info)
  target         AnnouncementTarget @default(all)
  campgroundId   String?
  status         AnnouncementStatus @default(draft)
  scheduledAt    DateTime?
  sentAt         DateTime?
  createdById    String
  createdByEmail String?

  @@index([createdAt])
  @@index([status])
  @@index([target])
}

model ApiClient {
  id               String            @id
  campgroundId     String
  name             String
  clientId         String            @unique
  clientSecretHash String
  scopes           String[]
  isActive         Boolean           @default(true)
  rateLimit        Int               @default(1000)
  tier             ApiClientTier     @default(free)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  Campground       Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ApiToken         ApiToken[]
  ApiUsage         ApiUsage[]
  ExternalPosSale  ExternalPosSale[]
  WebhookEndpoint  WebhookEndpoint[]

  @@index([campgroundId])
  @@index([tier])
}

model ApiToken {
  id               String    @id
  apiClientId      String
  accessTokenHash  String    @unique
  refreshTokenHash String?
  scopes           String[]
  expiresAt        DateTime
  revokedAt        DateTime?
  createdAt        DateTime  @default(now())
  ApiClient        ApiClient @relation(fields: [apiClientId], references: [id], onDelete: Cascade)

  @@index([apiClientId])
  @@index([expiresAt])
}

model ApiUsage {
  id           String    @id
  apiClientId  String
  endpoint     String
  method       String
  statusCode   Int
  responseTime Int
  requestSize  Int?
  responseSize Int?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime  @default(now())
  ApiClient    ApiClient @relation(fields: [apiClientId], references: [id], onDelete: Cascade)

  @@index([apiClientId, createdAt])
  @@index([createdAt])
  @@index([endpoint])
}

model ApprovalPolicy {
  id              String            @id
  campgroundId    String?
  name            String
  action          String
  appliesTo       String[]
  thresholdCents  Int?
  currency        String            @default("USD")
  approversNeeded Int               @default(1)
  description     String?
  isActive        Boolean           @default(true)
  approverRoles   UserRole[]
  createdById     String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  Campground      Campground?       @relation(fields: [campgroundId], references: [id])
  User            User?             @relation(fields: [createdById], references: [id])
  ApprovalRequest ApprovalRequest[]

  @@unique([campgroundId, action])
  @@index([campgroundId, action])
  @@index([campgroundId, isActive])
}

model ApprovalRequest {
  id                String          @id
  campgroundId      String?
  action            String
  requestedBy       String
  requesterName     String?
  amount            Int             @default(0)
  currency          String          @default("USD")
  reason            String?
  resource          String?
  targetId          String?
  payload           Json?
  status            ApprovalStatus  @default(pending)
  requiredApprovals Int             @default(1)
  approvals         Json?
  decidedBy         String?
  decidedAt         DateTime?
  policyId          String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  ApprovalPolicy    ApprovalPolicy? @relation(fields: [campgroundId, action], references: [campgroundId, action], onDelete: SetNull, map: "ApprovalPolicy_campground_action")
  Campground        Campground?     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, status])
  @@index([policyId])
}

model ArLedgerEntry {
  id            String       @id
  ledgerEntryId String       @unique
  invoiceId     String?
  invoiceLineId String?
  type          String
  createdAt     DateTime     @default(now())
  Invoice       Invoice?     @relation(fields: [invoiceId], references: [id])
  InvoiceLine   InvoiceLine? @relation(fields: [invoiceLineId], references: [id])
  LedgerEntry   LedgerEntry  @relation(fields: [ledgerEntryId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([invoiceLineId])
}

model Attraction {
  id                    String                 @id
  type                  AttractionType
  name                  String
  slug                  String                 @unique
  state                 String?
  city                  String?
  country               String                 @default("USA")
  latitude              Decimal                @db.Decimal(12, 8)
  longitude             Decimal                @db.Decimal(12, 8)
  npsCode               String?
  googlePlaceId         String?
  wikipediaUrl          String?
  metaTitle             String?
  metaDescription       String?
  heroImageUrl          String?
  description           String?
  activities            String[]               @default([])
  bestSeason            String?
  nearbyCampgroundCount Int                    @default(0)
  avgCampgroundRating   Decimal?               @db.Decimal(3, 2)
  statsUpdatedAt        DateTime?
  isPublished           Boolean                @default(false)
  publishedAt           DateTime?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  CampgroundAttraction  CampgroundAttraction[]

  @@index([isPublished])
  @@index([state])
  @@index([type])
}

model AuditExport {
  id            String     @id
  campgroundId  String
  requestedById String
  format        String
  filters       Json?
  recordCount   Int
  createdAt     DateTime   @default(now())
  Campground    Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User          User       @relation(fields: [requestedById], references: [id], onDelete: Cascade)

  @@index([campgroundId, createdAt])
  @@index([requestedById, createdAt])
}

model AuditLog {
  id           String     @id
  campgroundId String
  actorId      String?
  action       String
  entity       String
  entityId     String
  before       Json?
  after        Json?
  ip           String?
  userAgent    String?
  chainHash    String     @default("")
  prevHash     String?
  version      Int        @default(1)
  retentionAt  DateTime?
  createdAt    DateTime   @default(now())
  User         User?      @relation(fields: [actorId], references: [id])
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, chainHash])
  @@index([campgroundId, createdAt])
}

model AutoCollectSchedule {
  id                       String          @id
  depositPolicyId          String          @unique
  attemptOffsetsDays       Int[]
  cutoffHoursBeforeArrival Int
  backoffStrategy          BackoffStrategy
  maxAttempts              Int
  notifyTemplateIds        Json?
  createdAt                DateTime        @default(now())
  updatedAt                DateTime
  DepositPolicy            DepositPolicy   @relation(fields: [depositPolicyId], references: [id], onDelete: Cascade)
}

model AvailabilityOverride {
  id           String     @id
  campgroundId String
  userId       String
  date         DateTime   @db.Date
  isAvailable  Boolean    @default(false)
  startTime    String?
  endTime      String?
  reason       String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, userId, date])
  @@index([campgroundId, date])
}

model BatchMovement {
  id                String               @id
  batchId           String
  movementId        String?
  qty               Int
  movementType      String
  referenceType     String?
  referenceId       String?
  disposalReason    BatchDisposalReason?
  disposalNotes     String?
  previousQty       Int
  newQty            Int
  actorUserId       String
  createdAt         DateTime             @default(now())
  User              User                 @relation(fields: [actorUserId], references: [id])
  InventoryBatch    InventoryBatch       @relation(fields: [batchId], references: [id], onDelete: Cascade)
  InventoryMovement InventoryMovement?   @relation(fields: [movementId], references: [id])

  @@index([actorUserId])
  @@index([batchId])
  @@index([createdAt])
  @@index([movementId])
}

model BillingCycle {
  id            String      @id
  campgroundId  String
  reservationId String
  cadence       String
  periodStart   DateTime
  periodEnd     DateTime
  status        String      @default("open")
  generatedAt   DateTime?
  closedAt      DateTime?
  Campground    Campground  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Reservation   Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  Invoice       Invoice[]

  @@index([campgroundId, reservationId, periodStart, periodEnd])
}

model BlackoutDate {
  id           String     @id
  campgroundId String
  siteId       String?
  startDate    DateTime
  endDate      DateTime
  reason       String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site         Site?      @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([endDate])
  @@index([siteId])
  @@index([startDate])
}

model BookingPageConfig {
  id               String     @id
  campgroundId     String     @unique
  heroHeadline     String?
  heroSubline      String?
  dreamOutcome     String?
  showReviewCount  Boolean    @default(true)
  showTrustBadges  Boolean    @default(true)
  showScarcity     Boolean    @default(true)
  showLiveViewers  Boolean    @default(false)
  showLimitedAvail Boolean    @default(true)
  bookButtonText   String     @default("Book Now")
  checkAvailText   String     @default("Check availability")
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  Campground       Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model Campaign {
  id               String            @id
  campgroundId     String
  name             String
  subject          String
  fromEmail        String
  fromName         String?
  html             String
  textBody         String?
  channel          ChannelType       @default(email)
  templateId       String?
  audienceJson     Json?
  suggestedReason  String?
  variables        Json?
  status           CampaignStatus    @default(draft)
  scheduledAt      DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  Campground       Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  CampaignTemplate CampaignTemplate? @relation(fields: [templateId], references: [id])
  CampaignSend     CampaignSend[]

  @@index([campgroundId])
  @@index([status])
}

model CampaignSend {
  id                String             @id
  campaignId        String
  campgroundId      String
  guestId           String?
  email             String
  phone             String?
  channel           ChannelType        @default(email)
  status            CampaignSendStatus @default(queued)
  providerMessageId String?
  error             String?
  sentAt            DateTime?
  createdAt         DateTime           @default(now())
  Campaign          Campaign           @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  Campground        Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest             Guest?             @relation(fields: [guestId], references: [id])

  @@index([campaignId])
  @@index([campgroundId])
  @@index([guestId])
  @@index([status])
}

model CampaignTemplate {
  id                  String                @id
  campgroundId        String
  name                String
  channel             ChannelType           @default(email)
  category            String?               @default("general")
  subject             String?
  html                String?
  textBody            String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @default(now())
  Campaign            Campaign[]
  Campground          Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  NotificationTrigger NotificationTrigger[]

  @@index([campgroundId])
  @@index([channel])
}

model Campground {
  id                                                             String                          @id
  organizationId                                                 String
  name                                                           String
  slug                                                           String                          @unique
  isExternal                                                     Boolean                         @default(false)
  isBookable                                                     Boolean                         @default(true)
  externalUrl                                                    String?
  nonBookableReason                                              String?
  claimStatus                                                    CampgroundClaimStatus           @default(unclaimed)
  claimedAt                                                      DateTime?
  claimedByUserId                                                String?
  verificationMethod                                             ClaimVerificationMethod?
  verificationCode                                               String?
  verificationCodeExpiry                                         DateTime?
  verificationAttempts                                           Int                             @default(0)
  seededDataSource                                               CampgroundDataSource?
  seededDataSourceId                                             String?
  seededAt                                                       DateTime?
  lastEnrichedAt                                                 DateTime?
  seoScore                                                       Int?
  seoMissingFields                                               String[]                        @default([])
  city                                                           String?
  state                                                          String?
  country                                                        String?
  address1                                                       String?
  address2                                                       String?
  postalCode                                                     String?
  latitude                                                       Decimal?                        @db.Decimal(12, 8)
  longitude                                                      Decimal?                        @db.Decimal(12, 8)
  timezone                                                       String?                         @default("UTC")
  currency                                                       String                          @default("USD")
  taxId                                                          String?
  taxIdName                                                      String                          @default("Tax ID")
  phone                                                          String?
  email                                                          String?
  website                                                        String?
  facebookUrl                                                    String?
  instagramUrl                                                   String?
  dataSource                                                     String?
  dataSourceId                                                   String?
  dataSourceUpdatedAt                                            DateTime?
  dataImportNotes                                                String?
  provenance                                                     Json?
  gaMeasurementId                                                String?
  metaPixelId                                                    String?
  aiEnabled                                                      Boolean                         @default(false)
  aiReplyAssistEnabled                                           Boolean                         @default(false)
  aiBookingAssistEnabled                                         Boolean                         @default(false)
  aiAnalyticsEnabled                                             Boolean                         @default(false)
  aiForecastingEnabled                                           Boolean                         @default(false)
  aiAnonymizationLevel                                           String                          @default("strict")
  aiProvider                                                     String                          @default("openai")
  aiApiKey                                                       String?
  aiConsentCollected                                             Boolean                         @default(false)
  aiConsentCollectedAt                                           DateTime?
  aiMonthlyBudgetCents                                           Int?
  aiTotalTokensUsed                                              Int                             @default(0)
  npsAutoSendEnabled                                             Boolean                         @default(false)
  npsSendHour                                                    Int?                            @default(7)
  npsTemplateId                                                  String?
  npsSchedule                                                    Json?                           @default("[]")
  description                                                    String?
  tagline                                                        String?
  amenities                                                      String[]                        @default([])
  photos                                                         String[]                        @default([])
  photosMeta                                                     Json?
  heroImageUrl                                                   String?
  isPublished                                                    Boolean                         @default(false)
  amenitySummary                                                 Json?
  faqs                                                           Json?
  importedAt                                                     DateTime?
  seasonStart                                                    DateTime?
  seasonEnd                                                      DateTime?
  checkInTime                                                    String?                         @default("15:00")
  checkOutTime                                                   String?                         @default("11:00")
  officeClosesAt                                                 String?                         @default("17:00")
  parkTimeZone                                                   String?
  slaMinutes                                                     Int?                            @default(30)
  senderDomain                                                   String?
  senderDomainStatus                                             String?
  senderDomainCheckedAt                                          DateTime?
  senderDomainDmarc                                              String?
  senderDomainSpf                                                String?
  quietHoursStart                                                String?
  quietHoursEnd                                                  String?
  routingAssigneeId                                              String?
  smsEnabled                                                     Boolean                         @default(false)
  twilioAccountSid                                               String?
  twilioAuthToken                                                String?
  twilioFromNumber                                               String?
  smsWelcomeMessage                                              String?
  longTermEnabled                                                Boolean                         @default(false)
  longTermMinNights                                              Int?                            @default(28)
  longTermAutoApply                                              Boolean                         @default(true)
  bookingSources                                                 String[]                        @default([])
  stayReasons                                                    String[]                        @default([])
  logoUrl                                                        String?
  primaryColor                                                   String?
  accentColor                                                    String?
  brandingNote                                                   String?
  secondaryColor                                                 String?
  buttonColor                                                    String?
  brandFont                                                      String?
  emailHeader                                                    String?
  receiptFooter                                                  String?
  taxState                                                       Decimal?                        @db.Decimal(10, 4)
  taxLocal                                                       Decimal?                        @db.Decimal(10, 4)
  depositRule                                                    String?
  depositPercentage                                              Int?
  depositConfig                                                  Json?
  defaultDepositPolicyId                                         String?                         @unique
  cancellationPolicyType                                         String?
  cancellationWindowHours                                        Int?
  cancellationFeeType                                            String?
  cancellationFeeFlatCents                                       Int?
  cancellationFeePercent                                         Int?
  cancellationNotes                                              String?
  storeOpenHour                                                  Int?
  storeCloseHour                                                 Int?
  orderWebhookUrl                                                String?
  stripeAccountId                                                String?                         @unique
  applicationFeeFlatCents                                        Int?                            @default(300)
  billingPlan                                                    BillingPlan                     @default(ota_only)
  perBookingFeeCents                                             Int?                            @default(300)
  monthlyFeeCents                                                Int?
  feeMode                                                        PaymentFeeMode                  @default(absorb)
  maxDiscountFraction                                            Decimal?                        @default(0.4) @db.Decimal(4, 3)
  managerApprovalThreshold                                       Decimal?                        @default(0.25) @db.Decimal(4, 3)
  minOverrideRateCents                                           Int?
  maxOverrideRateCents                                           Int?
  stripeCapabilities                                             Json?
  stripeCapabilitiesFetchedAt                                    DateTime?
  enableCardPayments                                             Boolean                         @default(true)
  enableApplePay                                                 Boolean                         @default(true)
  enableGooglePay                                                Boolean                         @default(true)
  enableACH                                                      Boolean                         @default(true)
  enableCash                                                     Boolean                         @default(true)
  enableCheck                                                    Boolean                         @default(true)
  enableFolio                                                    Boolean                         @default(true)
  allowedCardBrands                                              String[]                        @default(["visa", "mastercard", "amex", "discover"])
  showFeeBreakdown                                               Boolean                         @default(false)
  reviewScore                                                    Decimal?                        @db.Decimal(4, 2)
  reviewCount                                                    Int                             @default(0)
  reviewSources                                                  Json?
  reviewsUpdatedAt                                               DateTime?
  showPublicMap                                                  Boolean                         @default(false)
  adaCertificationLevel                                          String?                         @default("none")
  adaAssessment                                                  Json?
  adaAssessmentUpdatedAt                                         DateTime?
  adaAccessibleSiteCount                                         Int                             @default(0)
  adaTotalSiteCount                                              Int                             @default(0)
  adaVerified                                                    Boolean                         @default(false)
  adaVerifiedAt                                                  DateTime?
  adaVerifiedBy                                                  String?
  createdAt                                                      DateTime                        @default(now())
  updatedAt                                                      DateTime                        @default(now())
  deletedAt                                                      DateTime?
  deletedBy                                                      String?
  embedding                                                      Unsupported("vector")?
  AbEnrollment                                                   AbEnrollment[]
  AbTest                                                         AbTest[]
  AccessCredential                                               AccessCredential[]
  AccessGrant                                                    AccessGrant[]
  AccessIntegration                                              AccessIntegration[]
  Activity                                                       Activity[]
  ActivityBundle                                                 ActivityBundle[]
  AddOnService                                                   AddOnService[]
  AiAnomalyAlert                                                 AiAnomalyAlert[]
  AiAutonomousAction                                             AiAutonomousAction[]
  AiAutopilotConfig                                              AiAutopilotConfig?
  AiCampgroundContext                                            AiCampgroundContext[]
  AiDashboardMetrics                                             AiDashboardMetrics[]
  AiMaintenanceAlert                                             AiMaintenanceAlert[]
  AiPhoneSession                                                 AiPhoneSession[]
  AiPriceExperiment                                              AiPriceExperiment[]
  AiPricingRecommendation                                        AiPricingRecommendation[]
  AiReplyDraft                                                   AiReplyDraft[]
  AiRevenueInsight                                               AiRevenueInsight[]
  AiWeatherAlert                                                 AiWeatherAlert[]
  AnalyticsAnomaly                                               AnalyticsAnomaly[]
  AnalyticsDailyAggregate                                        AnalyticsDailyAggregate[]
  AnalyticsEvent                                                 AnalyticsEvent[]
  AnalyticsExport                                                AnalyticsExport[]
  AnalyticsFeatureUsage                                          AnalyticsFeatureUsage[]
  AnalyticsFunnel                                                AnalyticsFunnel[]
  AnalyticsPageStats                                             AnalyticsPageStats[]
  AnalyticsSession                                               AnalyticsSession[]
  AnalyticsShareLink                                             AnalyticsShareLink[]
  AnalyticsStaffMetrics                                          AnalyticsStaffMetrics[]
  ApiClient                                                      ApiClient[]
  ApprovalPolicy                                                 ApprovalPolicy[]
  ApprovalRequest                                                ApprovalRequest[]
  AuditExport                                                    AuditExport[]
  AuditLog                                                       AuditLog[]
  AvailabilityOverride                                           AvailabilityOverride[]
  BillingCycle                                                   BillingCycle[]
  BlackoutDate                                                   BlackoutDate[]
  BookingPageConfig                                              BookingPageConfig?
  Campaign                                                       Campaign[]
  CampaignSend                                                   CampaignSend[]
  CampaignTemplate                                               CampaignTemplate[]
  User                                                           User?                           @relation(fields: [claimedByUserId], references: [id])
  DepositPolicy_Campground_defaultDepositPolicyIdToDepositPolicy DepositPolicy?                  @relation("Campground_defaultDepositPolicyIdToDepositPolicy", fields: [defaultDepositPolicyId], references: [id])
  Organization                                                   Organization                    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  CampgroundAttraction                                           CampgroundAttraction[]
  CampgroundAward                                                CampgroundAward[]
  CampgroundBonus                                                CampgroundBonus[]
  CampgroundCharity                                              CampgroundCharity?
  CampgroundClaim                                                CampgroundClaim[]
  CampgroundGuarantee                                            CampgroundGuarantee[]
  CampgroundLocation                                             CampgroundLocation[]
  CampgroundMapConfig                                            CampgroundMapConfig?
  CampgroundMembership                                           CampgroundMembership[]
  CampgroundPaymentGatewayConfig                                 CampgroundPaymentGatewayConfig?
  CategoryExpirationConfig                                       CategoryExpirationConfig[]
  CertificateOfInsurance                                         CertificateOfInsurance[]
  CharityDonation                                                CharityDonation[]
  ChatConversation                                               ChatConversation[]
  CleaningTaskTemplate                                           CleaningTaskTemplate[]
  CleaningZone                                                   CleaningZone[]
  CoiUpload                                                      CoiUpload[]
  Communication                                                  Communication[]
  CommunicationPlaybook                                          CommunicationPlaybook[]
  CommunicationPlaybookJob                                       CommunicationPlaybookJob[]
  CommunicationTemplate                                          CommunicationTemplate[]
  CommunicationWorkflow                                          CommunicationWorkflow[]
  Competitor                                                     Competitor[]
  ConsentLog                                                     ConsentLog[]
  DemandBand                                                     DemandBand[]
  DepositPolicy_DepositPolicy_campgroundIdToCampground           DepositPolicy[]                 @relation("DepositPolicy_campgroundIdToCampground")
  DigitalWaiver                                                  DigitalWaiver[]
  Dispute                                                        Dispute[]
  DocumentTemplate                                               DocumentTemplate[]
  DynamicPricingRule                                             DynamicPricingRule[]
  Event                                                          Event[]
  ExpirationAlert                                                ExpirationAlert[]
  ExternalPosSale                                                ExternalPosSale[]
  FactPosDaily                                                   FactPosDaily[]
  FactReservationsDaily                                          FactReservationsDaily[]
  FactStoredValueDaily                                           FactStoredValueDaily[]
  FeatureSetupQueue                                              FeatureSetupQueue[]
  FlexCheckPolicy                                                FlexCheckPolicy?
  FormTemplate                                                   FormTemplate[]
  GamificationSetting                                            GamificationSetting?
  GlAccount                                                      GlAccount[]
  GlPeriod                                                       GlPeriod[]
  GroupBooking                                                   GroupBooking[]
  GuestSegment                                                   GuestSegment[]
  IdVerification                                                 IdVerification[]
  Incident                                                       Incident[]
  IntegrationConnection                                          IntegrationConnection[]
  IntegrationExportJob                                           IntegrationExportJob[]
  InternalConversation                                           InternalConversation[]
  InventoryBatch                                                 InventoryBatch[]
  InventoryMovement                                              InventoryMovement[]
  InventoryTransfer                                              InventoryTransfer[]
  InviteToken                                                    InviteToken[]
  Invoice                                                        Invoice[]
  KioskDevice                                                    KioskDevice[]
  KioskPairingCode                                               KioskPairingCode[]
  LateFeeRule                                                    LateFeeRule[]
  LeadCaptureConfig                                              LeadCaptureConfig?
  LedgerEntry                                                    LedgerEntry[]
  LockCode                                                       LockCode[]
  MaintenanceTicket                                              MaintenanceTicket[]
  MarkdownApplication                                            MarkdownApplication[]
  MarkdownRule                                                   MarkdownRule[]
  MarketplaceConnection                                          MarketplaceConnection[]
  MembershipType                                                 MembershipType[]
  Message                                                        Message[]
  MobileDeviceToken                                              MobileDeviceToken[]
  NotificationTrigger                                            NotificationTrigger[]
  NpsInvite                                                      NpsInvite[]
  NpsResponse                                                    NpsResponse[]
  NpsSurvey                                                      NpsSurvey[]
  OAuthClient                                                    OAuthClient[]
  OccupancySnapshot                                              OccupancySnapshot[]
  OnboardingInvite                                               OnboardingInvite[]
  OnboardingSession                                              OnboardingSession[]
  OpBadge                                                        OpBadge[]
  OpRecurrenceRule                                               OpRecurrenceRule[]
  OpStaffBadge                                                   OpStaffBadge[]
  OpStaffDailyStats                                              OpStaffDailyStats[]
  OpStaffStats                                                   OpStaffStats[]
  OpTask                                                         OpTask[]
  OpTaskTemplate                                                 OpTaskTemplate[]
  OpTaskTrigger                                                  OpTaskTrigger[]
  OpTeam                                                         OpTeam[]
  OperationalTask                                                OperationalTask[]
  OrganizationBillingLineItem                                    OrganizationBillingLineItem[]
  OtaChannel                                                     OtaChannel[]
  OverrideRequest                                                OverrideRequest[]
  OvertimeConfig                                                 OvertimeConfig?
  Payment                                                        Payment[]
  Payout                                                         Payout[]
  PayoutRecon                                                    PayoutRecon[]
  PayrollConfig                                                  PayrollConfig?
  PayrollExport                                                  PayrollExport[]
  PermissionRule                                                 PermissionRule[]
  PlatformGoal                                                   PlatformGoal[]
  PortfolioMetric                                                PortfolioMetric[]
  PosCart                                                        PosCart[]
  PosOfflineReplay                                               PosOfflineReplay[]
  PosProviderIntegration                                         PosProviderIntegration[]
  PosTerminal                                                    PosTerminal[]
  PricingRule                                                    PricingRule[]
  PricingRuleV2                                                  PricingRuleV2[]
  PrivacySetting                                                 PrivacySetting?
  Product                                                        Product[]
  ProductCategory                                                ProductCategory[]
  ProductExpirationConfig                                        ProductExpirationConfig[]
  ProductExternalMapping                                         ProductExternalMapping[]
  Promotion                                                      Promotion[]
  PublicLead                                                     PublicLead[]
  PushNotification                                               PushNotification[]
  PushSubscription                                               PushSubscription[]
  QRCode                                                         QRCode[]
  RateParityAlert                                                RateParityAlert[]
  ReferralProgram                                                ReferralProgram[]
  Reservation                                                    Reservation[]
  RevenueForecast                                                RevenueForecast[]
  Review                                                         Review[]
  ReviewRequest                                                  ReviewRequest[]
  ReviewVote                                                     ReviewVote[]
  RoomMoveRequest                                                RoomMoveRequest[]
  SavedReport                                                    SavedReport[]
  ScheduleTemplate                                               ScheduleTemplate[]
  ScheduledNotification                                          ScheduledNotification[]
  SeasonalCommunication                                          SeasonalCommunication[]
  SeasonalGuest                                                  SeasonalGuest[]
  SeasonalPayment                                                SeasonalPayment[]
  SeasonalRate                                                   SeasonalRate[]
  SeasonalRateCard                                               SeasonalRateCard[]
  ShiftSwapRequest                                               ShiftSwapRequest[]
  SignatureArtifact                                              SignatureArtifact[]
  SignatureRequest                                               SignatureRequest[]
  Site                                                           Site[]
  SiteClass                                                      SiteClass[]
  SiteHold                                                       SiteHold[]
  SiteMapAssignment                                              SiteMapAssignment[]
  SiteMapLayout                                                  SiteMapLayout[]
  SiteMapShape                                                   SiteMapShape[]
  SmartLock                                                      SmartLock[]
  SocialContentAsset                                             SocialContentAsset[]
  SocialOpportunityAlert                                         SocialOpportunityAlert[]
  SocialPerformanceInput                                         SocialPerformanceInput[]
  SocialPost                                                     SocialPost[]
  SocialStrategy                                                 SocialStrategy[]
  SocialSuggestion                                               SocialSuggestion[]
  SocialTemplate                                                 SocialTemplate[]
  SocialWeeklyIdea                                               SocialWeeklyIdea[]
  StaffAvailability                                              StaffAvailability[]
  StaffPerformance                                               StaffPerformance[]
  StaffRole                                                      StaffRole[]
  StaffShift                                                     StaffShift[]
  StayRule                                                       StayRule[]
  StoreLocation                                                  StoreLocation[]
  StoreOrder                                                     StoreOrder[]
  StoredValueAccount                                             StoredValueAccount[]
  StoredValueLedger                                              StoredValueLedger[]
  StripeCustomer                                                 StripeCustomer[]
  StripeTerminalLocation                                         StripeTerminalLocation[]
  StripeTerminalReader                                           StripeTerminalReader[]
  SupportReport                                                  SupportReport[]
  TaxRule                                                        TaxRule[]
  TillSession                                                    TillSession[]
  TimeOffRequest                                                 TimeOffRequest[]
  UpsellBundle                                                   UpsellBundle[]
  UpsellItem                                                     UpsellItem[]
  UsageEvent                                                     UsageEvent[]
  UtilityMeter                                                   UtilityMeter[]
  UtilityRatePlan                                                UtilityRatePlan[]
  Vehicle                                                        Vehicle[]
  WaitlistEntry                                                  WaitlistEntry[]
  WaiverTemplate                                                 WaiverTemplate[]
  WebhookEndpoint                                                WebhookEndpoint[]
  XpBalance                                                      XpBalance[]
  XpEvent                                                        XpEvent[]
  XpRule                                                         XpRule[]

  @@index([claimStatus])
  @@index([dataSource, dataSourceId])
  @@index([deletedAt])
  @@index([latitude, longitude])
  @@index([seededDataSource, seededDataSourceId])
  @@index([state, city])
}

model CampgroundAttraction {
  id               String     @id
  campgroundId     String
  attractionId     String
  distanceMiles    Float
  driveTimeMinutes Int?
  isNearby         Boolean    @default(true)
  createdAt        DateTime   @default(now())
  Attraction       Attraction @relation(fields: [attractionId], references: [id], onDelete: Cascade)
  Campground       Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, attractionId])
  @@index([attractionId])
  @@index([distanceMiles])
  @@index([isNearby])
}

model CampgroundAward {
  id             String     @id
  campgroundId   String
  awardType      AwardType
  year           Int
  npsScore       Int?
  npsImprovement Int?
  rank           Int?
  createdAt      DateTime   @default(now())
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, awardType, year])
  @@index([awardType])
  @@index([campgroundId])
  @@index([year])
}

model CampgroundBonus {
  id             String     @id
  campgroundId   String
  name           String
  description    String?
  valueCents     Int
  iconName       String?
  siteClassIds   String[]   @default([])
  isAutoIncluded Boolean    @default(true)
  sortOrder      Int        @default(0)
  isActive       Boolean    @default(true)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([isActive])
}

model CampgroundCharity {
  id             String     @id
  campgroundId   String     @unique
  charityId      String
  isEnabled      Boolean    @default(true)
  customMessage  String?
  roundUpType    String     @default("nearest_dollar")
  roundUpOptions Json?
  defaultOptIn   Boolean    @default(false)
  glCode         String     @default("2400")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Charity        Charity    @relation(fields: [charityId], references: [id])

  @@index([charityId])
}

model CampgroundClaim {
  id                   String                   @id
  campgroundId         String
  userId               String
  status               String                   @default("pending")
  claimantName         String
  claimantEmail        String
  claimantPhone        String?
  claimantRole         String?
  businessName         String?
  businessAddress      String?
  verificationMethod   ClaimVerificationMethod?
  verificationCode     String?
  verificationExpiry   DateTime?
  verificationAttempts Int                      @default(0)
  verifiedAt           DateTime?
  documents            Json?
  notes                String?
  rejectionReason      String?
  reviewedByUserId     String?
  reviewedAt           DateTime?
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime
  Campground           Campground               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User                 User                     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model CampgroundGuarantee {
  id           String        @id
  campgroundId String
  type         GuaranteeType
  title        String
  description  String
  iconName     String?
  sortOrder    Int           @default(0)
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  Campground   Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([isActive])
}

model CampgroundLocation {
  id            String      @id
  campgroundId  String
  locationId    String
  distanceMiles Float?
  isPrimary     Boolean     @default(false)
  createdAt     DateTime    @default(now())
  Campground    Campground  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SeoLocation   SeoLocation @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, locationId])
  @@index([isPrimary])
  @@index([locationId])
}

model CampgroundMapConfig {
  campgroundId  String     @id
  bounds        Json?
  defaultCenter Json?
  defaultZoom   Float?
  layers        Json?
  legend        Json?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @default(now())
  Campground    Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model CampgroundMembership {
  id           String     @id
  userId       String
  campgroundId String
  role         UserRole
  createdAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  XpEvent      XpEvent[]

  @@unique([userId, campgroundId])
  @@index([campgroundId])
}

model CampgroundPaymentGatewayConfig {
  id                        String                 @id
  campgroundId              String                 @unique
  gateway                   PaymentGatewayProvider
  mode                      PaymentGatewayMode     @default(test)
  feeMode                   PaymentFeeMode         @default(absorb)
  feePercentBasisPoints     Int?
  feeFlatCents              Int?
  feePresetId               String?
  publishableKeySecretId    String?
  secretKeySecretId         String?
  merchantAccountIdSecretId String?
  webhookSecretId           String?
  additionalConfig          Json?
  createdAt                 DateTime               @default(now())
  updatedAt                 DateTime               @default(now())
  Campground                Campground             @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  GatewayFeePreset          GatewayFeePreset?      @relation(fields: [feePresetId], references: [id])

  @@index([campgroundId])
  @@index([gateway, mode])
}

model CampgroundSeedJob {
  id               String               @id
  source           CampgroundDataSource
  status           String               @default("pending")
  startedAt        DateTime?
  completedAt      DateTime?
  totalRecords     Int                  @default(0)
  processedRecords Int                  @default(0)
  createdRecords   Int                  @default(0)
  updatedRecords   Int                  @default(0)
  skippedRecords   Int                  @default(0)
  errorRecords     Int                  @default(0)
  errors           Json?
  config           Json?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime

  @@index([createdAt])
  @@index([source])
  @@index([status])
}

model CategoryExpirationConfig {
  id              String          @id
  campgroundId    String
  categoryId      String
  warningDays     Int             @default(7)
  criticalDays    Int             @default(2)
  slowMovingDays  Int             @default(30)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now())
  Campground      Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ProductCategory ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, categoryId])
  @@index([campgroundId])
}

model CentralizedRatePush {
  id            String       @id
  orgId         String
  name          String
  rateConfig    Json
  targetCampIds String[]
  status        String       @default("draft")
  appliedAt     DateTime?
  appliedBy     String?
  results       Json?
  createdBy     String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  Organization  Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@index([orgId])
}

model CertificateOfInsurance {
  id            String       @id
  campgroundId  String
  guestId       String?
  reservationId String?
  incidentId    String?
  provider      String?
  policyNumber  String?
  coverageType  String?
  fileUrl       String
  effectiveDate DateTime?
  expiresAt     DateTime?
  uploadedBy    String?
  uploadedAt    DateTime     @default(now())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @default(now())
  Campground    Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest         Guest?       @relation(fields: [guestId], references: [id])
  Incident      Incident?    @relation(fields: [incidentId], references: [id])
  Reservation   Reservation? @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([expiresAt])
  @@index([guestId])
  @@index([incidentId])
  @@index([reservationId])
}

model Charity {
  id                String              @id
  name              String
  description       String?
  logoUrl           String?
  taxId             String?
  website           String?
  category          String?
  isActive          Boolean             @default(true)
  isVerified        Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  CampgroundCharity CampgroundCharity[]
  CharityDonation   CharityDonation[]
  CharityPayout     CharityPayout[]

  @@index([category])
  @@index([isActive])
}

model CharityDonation {
  id             String         @id
  reservationId  String         @unique
  charityId      String
  campgroundId   String
  guestId        String?
  amountCents    Int
  status         DonationStatus @default(collected)
  payoutId       String?
  journalEntryId String?
  refundedAt     DateTime?
  createdAt      DateTime       @default(now())
  Campground     Campground     @relation(fields: [campgroundId], references: [id])
  Charity        Charity        @relation(fields: [charityId], references: [id])
  CharityPayout  CharityPayout? @relation(fields: [payoutId], references: [id])
  Reservation    Reservation    @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([charityId])
  @@index([createdAt])
  @@index([status])
}

model CharityPayout {
  id              String              @id
  charityId       String
  amountCents     Int
  status          CharityPayoutStatus @default(pending)
  payoutDate      DateTime?
  payoutMethod    String?
  reference       String?
  notes           String?
  createdBy       String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime
  CharityDonation CharityDonation[]
  Charity         Charity             @relation(fields: [charityId], references: [id])

  @@index([charityId])
  @@index([status])
}

model ChatConversation {
  id              String              @id
  campgroundId    String
  participantType ChatParticipantType
  participantId   String
  title           String?
  metadata        Json?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime
  Campground      Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ChatMessage     ChatMessage[]

  @@index([campgroundId])
  @@index([campgroundId, participantType])
  @@index([participantType, participantId])
  @@index([updatedAt])
}

model ChatMessage {
  id               String           @id
  conversationId   String
  role             ChatMessageRole
  content          String
  toolCalls        Json?
  toolResults      Json?
  metadata         Json?
  createdAt        DateTime         @default(now())
  ChatConversation ChatConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([conversationId])
  @@index([role])
}

model CleaningTaskTemplate {
  id                 String     @id
  campgroundId       String
  taskType           TaskType
  siteType           SiteType?
  name               String
  estimatedMinutes   Int
  checklist          Json
  suppliesNeeded     Json?
  priority           Int        @default(100)
  slaMinutes         Int?
  requiresInspection Boolean    @default(false)
  isActive           Boolean    @default(true)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime
  Campground         Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([siteType])
  @@index([taskType])
}

model CleaningZone {
  id                 String         @id
  campgroundId       String
  name               String
  zoneType           String
  parentZoneId       String?
  primaryTeamId      String?
  color              String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime
  Campground         Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  CleaningZone       CleaningZone?  @relation("CleaningZoneToCleaningZone", fields: [parentZoneId], references: [id])
  other_CleaningZone CleaningZone[] @relation("CleaningZoneToCleaningZone")

  @@index([campgroundId])
  @@index([parentZoneId])
}

model CohortAnalysis {
  id              String   @id
  campgroundId    String
  cohortType      String
  cohortValue     String
  periodStart     DateTime @db.Date
  periodEnd       DateTime @db.Date
  guestCount      Int
  bookings        Int
  revenue         Int
  repeatRate      Float?
  avgBookingValue Int?
  createdAt       DateTime @default(now())

  @@unique([campgroundId, cohortType, cohortValue, periodStart])
  @@index([campgroundId, cohortType])
}

model CoiUpload {
  id            String       @id
  campgroundId  String
  reservationId String?
  guestId       String?
  fileUrl       String
  storageKey    String?
  status        CoiStatus    @default(active)
  expiresAt     DateTime?
  reminderAt    DateTime?
  reminderCount Int          @default(0)
  uploadedAt    DateTime     @default(now())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  notes         String?
  Campground    Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest         Guest?       @relation(fields: [guestId], references: [id])
  Reservation   Reservation? @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([expiresAt])
  @@index([guestId])
  @@index([reservationId])
}

model Communication {
  id                String       @id
  campgroundId      String
  organizationId    String?
  guestId           String?
  reservationId     String?
  conversationId    String?
  type              String
  direction         String
  subject           String?
  body              String?
  preview           String?
  status            String
  provider          String?
  providerMessageId String?
  toAddress         String?
  fromAddress       String?
  sentAt            DateTime?
  receivedAt        DateTime?
  metadata          Json?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @default(now())
  sentiment         String?
  sentimentScore    Float?
  urgencyLevel      String?
  detectedIntent    String?
  aiAnalyzedAt      DateTime?
  Campground        Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest             Guest?       @relation(fields: [guestId], references: [id])
  Reservation       Reservation? @relation(fields: [reservationId], references: [id])

  @@index([campgroundId, conversationId, createdAt])
  @@index([campgroundId, createdAt])
  @@index([campgroundId, sentiment])
  @@index([campgroundId, urgencyLevel])
  @@index([guestId, createdAt])
  @@index([reservationId, createdAt])
  @@index([type, direction])
}

model CommunicationPlaybook {
  id                       String                     @id
  campgroundId             String
  type                     String
  enabled                  Boolean                    @default(false)
  templateId               String?
  channel                  String?
  offsetMinutes            Int?
  quietHoursStart          String?
  quietHoursEnd            String?
  throttlePerMinute        Int?
  routingAssigneeId        String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  Campground               Campground                 @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  CommunicationTemplate    CommunicationTemplate?     @relation(fields: [templateId], references: [id])
  CommunicationPlaybookJob CommunicationPlaybookJob[]

  @@index([campgroundId, type])
  @@index([templateId])
}

model CommunicationPlaybookJob {
  id                    String                @id
  playbookId            String
  campgroundId          String
  reservationId         String?
  guestId               String?
  status                String                @default("pending")
  scheduledAt           DateTime
  attempts              Int                   @default(0)
  lastError             String?
  metadata              Json?                 @default("{}")
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  Campground            Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest                 Guest?                @relation(fields: [guestId], references: [id])
  CommunicationPlaybook CommunicationPlaybook @relation(fields: [playbookId], references: [id], onDelete: Cascade)
  Reservation           Reservation?          @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([playbookId, status, scheduledAt])
  @@index([reservationId])
}

model CommunicationTemplate {
  id                    String                  @id
  campgroundId          String
  name                  String
  subject               String?
  bodyHtml              String?
  status                String                  @default("draft")
  version               Int                     @default(1)
  approvedById          String?
  approvedAt            DateTime?
  auditLog              Json?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  CommunicationPlaybook CommunicationPlaybook[]
  User                  User?                   @relation(fields: [approvedById], references: [id])
  Campground            Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([status])
}

model CommunicationWorkflow {
  id                String              @id
  campgroundId      String
  name              String
  description       String?
  trigger           WorkflowTrigger
  triggerValue      Int?
  conditions        Json?
  status            WorkflowStatus      @default(draft)
  priority          Int                 @default(100)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  Campground        Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  WorkflowExecution WorkflowExecution[]
  WorkflowStep      WorkflowStep[]

  @@index([campgroundId, status])
}

model Competitor {
  id             String           @id
  campgroundId   String
  name           String
  url            String?
  notes          String?
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  Campground     Campground       @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  CompetitorRate CompetitorRate[]

  @@index([campgroundId])
  @@index([campgroundId, isActive])
}

model CompetitorRate {
  id           String     @id
  competitorId String
  siteType     String
  rateNightly  Int
  source       String
  capturedAt   DateTime   @default(now())
  validFrom    DateTime?
  validTo      DateTime?
  notes        String?
  Competitor   Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([capturedAt])
  @@index([competitorId])
  @@index([competitorId, siteType])
}

model ConsentLog {
  id           String        @id
  campgroundId String
  subject      String
  consentType  String
  grantedBy    String
  method       ConsentMethod @default(digital)
  purpose      String?
  expiresAt    DateTime?
  revokedAt    DateTime?
  metadata     Json?
  grantedAt    DateTime      @default(now())
  Campground   Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, grantedAt])
}

model DemandBand {
  id              String         @id
  campgroundId    String
  siteClassId     String?
  thresholdPct    Int
  adjustmentType  AdjustmentType
  adjustmentValue Decimal        @db.Decimal(8, 4)
  priority        Int
  active          Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  Campground      Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass       SiteClass?     @relation(fields: [siteClassId], references: [id])
}

model DemoRequest {
  id             String   @id
  name           String
  email          String
  phone          String?
  campgroundName String
  siteCount      String
  message        String?
  status         String   @default("new")
  notes          String?
  assignedTo     String?
  source         String   @default("website")
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([createdAt])
  @@index([status])
}

model DepositPolicy {
  id                                                          String               @id
  campgroundId                                                String
  siteClassId                                                 String?
  name                                                        String
  strategy                                                    DepositStrategy
  value                                                       Int
  minCap                                                      Int?
  maxCap                                                      Int?
  applyTo                                                     DepositApplyTo
  dueTiming                                                   DepositDueTiming
  retryPlanId                                                 String?
  active                                                      Boolean              @default(true)
  version                                                     Int                  @default(1)
  createdBy                                                   String?
  updatedBy                                                   String?
  createdAt                                                   DateTime             @default(now())
  updatedAt                                                   DateTime
  AutoCollectSchedule                                         AutoCollectSchedule?
  Campground_Campground_defaultDepositPolicyIdToDepositPolicy Campground?          @relation("Campground_defaultDepositPolicyIdToDepositPolicy")
  Campground_DepositPolicy_campgroundIdToCampground           Campground           @relation("DepositPolicy_campgroundIdToCampground", fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass                                                   SiteClass?           @relation(fields: [siteClassId], references: [id])
}

model DigitalWaiver {
  id            String       @id
  campgroundId  String
  reservationId String?
  guestId       String
  templateId    String?
  status        WaiverStatus @default(pending)
  signedAt      DateTime?
  signatureData Json?
  ipAddress     String?
  userAgent     String?
  pdfUrl        String?
  expiresAt     DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  Campground    Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest         Guest        @relation(fields: [guestId], references: [id], onDelete: Cascade)
  Reservation   Reservation? @relation(fields: [reservationId], references: [id])

  @@index([campgroundId, status])
  @@index([guestId])
  @@index([reservationId])
}

model Dispute {
  id                    String        @id
  campgroundId          String
  reservationId         String?
  payoutId              String?
  stripeDisputeId       String        @unique
  stripeChargeId        String?
  stripePaymentIntentId String?
  amountCents           Int
  currency              String        @default("usd")
  reason                String?
  status                DisputeStatus @default(needs_response)
  evidenceDueBy         DateTime?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @default(now())
  notes                 String?
  Campground            Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Payout                Payout?       @relation(fields: [payoutId], references: [id])
  Reservation           Reservation?  @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([payoutId])
  @@index([reservationId])
  @@index([status])
  @@index([stripeChargeId])
  @@index([stripeDisputeId])
  @@index([stripePaymentIntentId])
}

model DocumentTemplate {
  id               String                @id
  campgroundId     String
  siteClassId      String?
  siteId           String?
  name             String
  description      String?
  type             SignatureDocumentType
  version          Int                   @default(1)
  content          String
  policyConfig     Json?
  isActive         Boolean               @default(true)
  autoSend         Boolean               @default(false)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime
  Campground       Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass        SiteClass?            @relation(fields: [siteClassId], references: [id])
  Site             Site?                 @relation(fields: [siteId], references: [id])
  SignatureRequest SignatureRequest[]

  @@unique([campgroundId, name, version])
  @@index([campgroundId, siteClassId])
  @@index([campgroundId, siteId])
  @@index([campgroundId, type])
}

model DynamicPricingRule {
  id              String                @id
  campgroundId    String
  name            String
  trigger         DynamicPricingTrigger
  conditions      Json
  adjustmentType  String
  adjustmentValue Float
  priority        Int                   @default(100)
  siteClassIds    String[]
  isActive        Boolean               @default(true)
  validFrom       DateTime?
  validTo         DateTime?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  Campground      Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, isActive])
}

model EarlyAccessEnrollment {
  id               String          @id
  organizationId   String          @unique
  tier             EarlyAccessTier
  enrolledAt       DateTime        @default(now())
  lockedBookingFee Int
  monthlyFeeEndsAt DateTime?
  lockedMonthlyFee Int?
  Organization     Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([enrolledAt])
  @@index([tier])
}

model EarlyAccessSpot {
  tier           EarlyAccessTier @id
  totalSpots     Int
  remainingSpots Int
  updatedAt      DateTime
}

model Event {
  id                 String     @id
  campgroundId       String
  title              String
  description        String?
  eventType          EventType  @default(activity)
  startDate          DateTime
  endDate            DateTime?
  startTime          String?
  endTime            String?
  isAllDay           Boolean    @default(false)
  isRecurring        Boolean    @default(false)
  recurrenceRule     String?
  location           String?
  capacity           Int?
  currentSignups     Int        @default(0)
  priceCents         Int        @default(0)
  isGuestOnly        Boolean    @default(true)
  imageUrl           String?
  isPublished        Boolean    @default(false)
  isCancelled        Boolean    @default(false)
  cancelledAt        DateTime?
  cancellationReason String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @default(now())
  recurrenceEndDate  DateTime?
  recurrenceDays     Int[]
  parentEventId      String?
  Campground         Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Event              Event?     @relation("EventToEvent", fields: [parentEventId], references: [id])
  other_Event        Event[]    @relation("EventToEvent")

  @@index([campgroundId])
  @@index([eventType])
  @@index([parentEventId])
  @@index([startDate])
}

model ExpirationAlert {
  id               String         @id
  campgroundId     String
  batchId          String
  tier             ExpirationTier
  expirationDate   DateTime
  daysRemaining    Int
  productName      String
  locationName     String?
  qtyRemaining     Int
  alertedAt        DateTime       @default(now())
  acknowledgedAt   DateTime?
  acknowledgedById String?
  User             User?          @relation(fields: [acknowledgedById], references: [id])
  Campground       Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([acknowledgedById])
  @@index([alertedAt])
  @@index([batchId])
  @@index([campgroundId])
  @@index([tier])
}

model ExternalPosSale {
  id                    String         @id
  campgroundId          String
  externalTransactionId String
  provider              String?
  apiClientId           String?
  items                 Json
  totalCents            Int
  paymentMethod         String?
  locationId            String?
  inventoryDeducted     Boolean        @default(false)
  saleDate              DateTime
  metadata              Json?
  createdAt             DateTime       @default(now())
  ApiClient             ApiClient?     @relation(fields: [apiClientId], references: [id])
  Campground            Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StoreLocation         StoreLocation? @relation(fields: [locationId], references: [id])

  @@unique([campgroundId, externalTransactionId])
  @@index([apiClientId])
  @@index([campgroundId, saleDate])
}

model FactPosDaily {
  id             String     @id
  campgroundId   String
  locationId     String?
  metricDate     DateTime   @db.Date
  netCents       Int
  taxCents       Int        @default(0)
  feeCents       Int        @default(0)
  discountsCents Int        @default(0)
  categoryId     String?
  createdAt      DateTime   @default(now())
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, metricDate, categoryId])
  @@index([campgroundId, metricDate])
}

model FactReservationsDaily {
  id               String     @id
  campgroundId     String
  metricDate       DateTime   @db.Date
  roomsAvailable   Int
  roomsSold        Int
  roomRevenueCents Int
  taxesCents       Int        @default(0)
  feesCents        Int        @default(0)
  discountsCents   Int        @default(0)
  channel          String?
  createdAt        DateTime   @default(now())
  Campground       Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, metricDate, channel])
  @@index([campgroundId, metricDate])
}

model FactStoredValueDaily {
  id            String     @id
  campgroundId  String
  metricDate    DateTime   @db.Date
  issuedCents   Int        @default(0)
  redeemedCents Int        @default(0)
  expiredCents  Int        @default(0)
  createdAt     DateTime   @default(now())
  Campground    Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, metricDate])
  @@index([campgroundId, metricDate])
}

model FeatureFlag {
  id          String           @id
  createdAt   DateTime         @default(now())
  updatedAt   DateTime
  key         String           @unique
  name        String
  description String?
  enabled     Boolean          @default(false)
  scope       FeatureFlagScope @default(global)
  campgrounds String[]
  metadata    Json?

  @@index([enabled])
  @@index([key])
}

model FeatureProgress {
  id          String    @id
  userId      String
  featureKey  String
  completed   Boolean   @default(false)
  completedAt DateTime?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, featureKey])
  @@index([userId])
}

model FeatureSetupQueue {
  id           String             @id
  campgroundId String
  featureKey   String
  status       FeatureSetupStatus @default(setup_later)
  priority     Int                @default(0)
  completedAt  DateTime?
  skippedAt    DateTime?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  Campground   Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, featureKey])
  @@index([campgroundId])
  @@index([campgroundId, status])
}

model FlexCheckPolicy {
  id                      String     @id
  campgroundId            String     @unique
  earlyCheckInEnabled     Boolean    @default(false)
  earlyCheckInMinHours    Int?
  earlyCheckInPricing     Json?
  earlyCheckInAutoApprove Boolean    @default(false)
  lateCheckoutEnabled     Boolean    @default(false)
  lateCheckoutMaxHours    Int?
  lateCheckoutPricing     Json?
  lateCheckoutAutoApprove Boolean    @default(false)
  vipEarlyFree            Boolean    @default(false)
  vipLateFree             Boolean    @default(false)
  createdAt               DateTime   @default(now())
  updatedAt               DateTime
  Campground              Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model FormSubmission {
  id             String               @id
  formTemplateId String
  reservationId  String?
  guestId        String?
  status         FormSubmissionStatus @default(pending)
  responses      Json?
  signedAt       DateTime?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @default(now())
  FormTemplate   FormTemplate         @relation(fields: [formTemplateId], references: [id], onDelete: Cascade)
  Guest          Guest?               @relation(fields: [guestId], references: [id], onDelete: Cascade)
  Reservation    Reservation?         @relation(fields: [reservationId], references: [id], onDelete: Cascade)
}

model FormTemplate {
  id                 String             @id
  campgroundId       String
  title              String
  type               FormTemplateType   @default(custom)
  description        String?
  fields             Json?
  isActive           Boolean            @default(true)
  version            Int                @default(1)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @default(now())
  autoAttachMode     FormAutoAttachMode @default(manual)
  siteClassIds       String[]           @default([])
  showAt             FormShowAt[]       @default([during_booking])
  isRequired         Boolean            @default(true)
  allowSkipWithNote  Boolean            @default(false)
  displayConditions  Json?              @default("[]")
  conditionLogic     String             @default("all")
  validityDays       Int?
  sendReminder       Boolean            @default(false)
  reminderDaysBefore Int?               @default(1)
  FormSubmission     FormSubmission[]
  Campground         Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model GamificationSetting {
  id           String     @id
  campgroundId String     @unique
  enabled      Boolean    @default(false)
  enabledRoles UserRole[] @default([])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
}

model GatewayFeePreset {
  id                             String                           @id
  gateway                        PaymentGatewayProvider
  mode                           PaymentGatewayMode
  percentBasisPoints             Int                              @default(0)
  flatFeeCents                   Int                              @default(0)
  label                          String?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime                         @default(now())
  CampgroundPaymentGatewayConfig CampgroundPaymentGatewayConfig[]

  @@unique([gateway, mode])
  @@index([gateway, mode])
}

model GlAccount {
  id           String        @id
  campgroundId String
  code         String
  name         String
  type         GlAccountType
  description  String?
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now())
  Campground   Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  LedgerLine   LedgerLine[]

  @@unique([campgroundId, code])
  @@index([campgroundId])
  @@index([campgroundId, type])
}

model GlPeriod {
  id           String         @id
  campgroundId String
  name         String?
  startDate    DateTime
  endDate      DateTime
  status       GlPeriodStatus @default(open)
  closedAt     DateTime?
  lockedAt     DateTime?
  closedBy     String?
  lockedBy     String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @default(now())
  Campground   Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  LedgerEntry  LedgerEntry[]

  @@index([campgroundId, startDate, endDate])
  @@index([campgroundId, status])
}

model Group {
  id                   String   @id
  tenantId             String
  sharedPayment        Boolean  @default(false)
  sharedComm           Boolean  @default(false)
  primaryReservationId String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime
}

model GroupBooking {
  id                 String        @id
  campgroundId       String
  groupName          String
  primaryGuestId     String
  groupType          String
  preferAdjacent     Boolean       @default(false)
  preferSameFloor    Boolean       @default(false)
  preferConnecting   Boolean       @default(false)
  preferredZone      String?
  assignmentStatus   String        @default("pending")
  billingType        String        @default("individual")
  masterFolioId      String?
  groupArrivalTime   String?
  groupDepartureTime String?
  welcomeAmenity     String?
  groupNotes         String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime
  Campground         Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest              Guest         @relation(fields: [primaryGuestId], references: [id])
  Reservation        Reservation[]

  @@index([assignmentStatus])
  @@index([campgroundId])
  @@index([primaryGuestId])
}

model Guest {
  id                       String                     @id
  primaryFirstName         String
  primaryLastName          String
  email                    String
  emailNormalized          String?                    @unique
  phone                    String?
  phoneNormalized          String?
  preferredContact         String?
  preferredLanguage        String?
  address1                 String?
  address2                 String?
  city                     String?
  state                    String?
  postalCode               String?
  country                  String?
  rigType                  String?
  rigLength                Int?
  vehiclePlate             String?
  vehicleState             String?
  tags                     String[]                   @default([])
  vip                      Boolean                    @default(false)
  leadSource               String?
  marketingOptIn           Boolean                    @default(false)
  repeatStays              Int                        @default(0)
  notes                    String?
  preferences              Json?
  insights                 Json?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now())
  deletedAt                DateTime?
  deletedBy                String?
  ActivityBooking          ActivityBooking[]
  AnalyticsSession         AnalyticsSession[]
  CampaignSend             CampaignSend[]
  CertificateOfInsurance   CertificateOfInsurance[]
  CoiUpload                CoiUpload[]
  Communication            Communication[]
  CommunicationPlaybookJob CommunicationPlaybookJob[]
  DigitalWaiver            DigitalWaiver[]
  FormSubmission           FormSubmission[]
  GroupBooking             GroupBooking[]
  GuestAccount             GuestAccount?
  GuestEquipment           GuestEquipment[]
  GuestMembership          GuestMembership[]
  GuestSegmentMembership   GuestSegmentMembership[]
  IdVerification           IdVerification[]
  Incident                 Incident[]
  LoyaltyProfile           LoyaltyProfile?
  Message                  Message[]
  NpsInvite                NpsInvite[]
  NpsResponse              NpsResponse[]
  Reservation              Reservation[]
  Review                   Review[]
  ReviewRequest            ReviewRequest[]
  ReviewVote               ReviewVote[]
  SeasonalGuest            SeasonalGuest[]
  SignatureArtifact        SignatureArtifact[]
  SignatureRequest         SignatureRequest[]
  StoreOrder               StoreOrder[]
  StoredValueAccount       StoredValueAccount[]
  StoredValueCode          StoredValueCode[]
  StripeCustomer           StripeCustomer[]
  Vehicle                  Vehicle[]
  WaitlistEntry            WaitlistEntry[]

  @@index([deletedAt])
  @@index([email])
  @@index([phoneNormalized])
}

model GuestAccount {
  id             String    @id
  guestId        String    @unique
  email          String    @unique
  passwordHash   String?
  magicLinkToken String?   @unique
  tokenExpiry    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @default(now())
  Guest          Guest     @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([magicLinkToken])
}

model GuestEquipment {
  id          String   @id
  guestId     String
  type        String
  make        String?
  model       String?
  length      Int?
  plateNumber String?
  plateState  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  Guest       Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([guestId])
}

model GuestMembership {
  id               String         @id
  membershipTypeId String
  guestId          String
  startDate        DateTime
  endDate          DateTime
  status           String         @default("active")
  purchaseAmount   Int
  Guest            Guest          @relation(fields: [guestId], references: [id], onDelete: Cascade)
  MembershipType   MembershipType @relation(fields: [membershipTypeId], references: [id])
}

model GuestPaymentMethod {
  id                    String         @id
  stripeCustomerId      String
  stripePaymentMethodId String
  type                  String
  last4                 String?
  brand                 String?
  expMonth              Int?
  expYear               Int?
  bankName              String?
  isDefault             Boolean        @default(false)
  nickname              String?
  addedBy               String
  addedByUserId         String?
  metadata              Json?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime
  StripeCustomer        StripeCustomer @relation(fields: [stripeCustomerId], references: [id], onDelete: Cascade)

  @@unique([stripeCustomerId, stripePaymentMethodId])
  @@index([stripePaymentMethodId])
}

model GuestSegment {
  id                     String                   @id
  name                   String
  description            String?
  scope                  SegmentScope             @default(campground)
  status                 SegmentStatus            @default(active)
  criteria               Json
  isTemplate             Boolean                  @default(false)
  organizationId         String?
  campgroundId           String?
  createdById            String
  createdByEmail         String
  guestCount             Int                      @default(0)
  lastCalculated         DateTime?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @default(now())
  Campground             Campground?              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  GuestSegmentMembership GuestSegmentMembership[]

  @@index([campgroundId, status])
  @@index([isTemplate])
  @@index([organizationId, status])
  @@index([scope, status])
}

model GuestSegmentMembership {
  id           String       @id
  segmentId    String
  guestId      String
  addedAt      DateTime     @default(now())
  removedAt    DateTime?
  Guest        Guest        @relation(fields: [guestId], references: [id], onDelete: Cascade)
  GuestSegment GuestSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@unique([segmentId, guestId])
  @@index([guestId])
  @@index([segmentId])
}

model IdVerification {
  id            String               @id
  campgroundId  String
  guestId       String
  reservationId String?
  status        IdVerificationStatus @default(pending)
  provider      String?
  providerRef   String?
  verifiedAt    DateTime?
  expiresAt     DateTime?
  documentType  String?
  metadata      Json?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime
  Campground    Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest         Guest                @relation(fields: [guestId], references: [id], onDelete: Cascade)
  Reservation   Reservation?         @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([guestId])
  @@index([reservationId])
}

model IdempotencyKey {
  id           String            @id
  campgroundId String?
  key          String            @unique
  requestHash  String
  responseJson Json?
  status       IdempotencyStatus @default(pending)
  resourceRef  String?
  lastSeenAt   DateTime          @default(now())
  createdAt    DateTime          @default(now())
}

model IdempotencyRecord {
  id             String            @id
  scope          String
  tenantId       String?
  campgroundId   String?
  endpoint       String
  idempotencyKey String
  requestHash    String
  checksum       String?
  requestBody    Json?
  responseJson   Json?
  status         IdempotencyStatus @default(pending)
  sequence       String?
  expiresAt      DateTime?
  lastSeenAt     DateTime          @default(now())
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  metadata       Json?

  @@unique([scope, idempotencyKey])
  @@index([expiresAt])
  @@index([scope, endpoint, sequence])
}

model Incident {
  id                     String                   @id
  campgroundId           String
  reservationId          String?
  guestId                String?
  type                   IncidentType
  status                 IncidentStatus           @default(open)
  severity               Severity?
  notes                  String?
  photos                 Json?
  witnesses              Json?
  occurredAt             DateTime?
  closedAt               DateTime?
  claimId                String?
  reminderAt             DateTime?
  metadata               Json?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @default(now())
  CertificateOfInsurance CertificateOfInsurance[]
  Campground             Campground               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest                  Guest?                   @relation(fields: [guestId], references: [id])
  Reservation            Reservation?             @relation(fields: [reservationId], references: [id])
  IncidentEvidence       IncidentEvidence[]
  IncidentTask           IncidentTask[]

  @@index([campgroundId])
  @@index([guestId])
  @@index([reservationId])
  @@index([status])
  @@index([type])
}

model IncidentEvidence {
  id          String       @id
  incidentId  String
  type        EvidenceType @default(photo)
  url         String?
  storageKey  String?
  description String?
  uploadedBy  String?
  uploadedAt  DateTime     @default(now())
  metadata    Json?
  Incident    Incident     @relation(fields: [incidentId], references: [id], onDelete: Cascade)

  @@index([incidentId])
  @@index([type])
}

model IncidentTask {
  id          String             @id
  incidentId  String
  title       String
  status      IncidentTaskStatus @default(pending)
  dueAt       DateTime?
  reminderAt  DateTime?
  assignedTo  String?
  completedAt DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @default(now())
  Incident    Incident           @relation(fields: [incidentId], references: [id], onDelete: Cascade)

  @@index([dueAt])
  @@index([incidentId])
  @@index([status])
}

model InspectionResult {
  id              String   @id
  taskId          String
  inspectorId     String
  responses       Json
  overallResult   String
  score           Int?
  failedItems     String[] @default([])
  requiresReclean Boolean  @default(false)
  notes           String?
  photos          String[] @default([])
  completedAt     DateTime @default(now())
  User            User     @relation(fields: [inspectorId], references: [id])
  Task            Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([inspectorId])
  @@index([taskId])
}

model IntegrationConnection {
  id                      String                    @id
  campgroundId            String?
  organizationId          String?
  type                    String
  provider                String
  status                  String                    @default("disconnected")
  authType                String?
  credentials             Json?
  settings                Json?
  webhookSecret           String?
  lastSyncAt              DateTime?
  lastSyncStatus          String?
  lastError               String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  Campground              Campground?               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Organization            Organization?             @relation(fields: [organizationId], references: [id])
  IntegrationExportJob    IntegrationExportJob[]
  IntegrationSyncLog      IntegrationSyncLog[]
  IntegrationWebhookEvent IntegrationWebhookEvent[]

  @@unique([campgroundId, type, provider])
  @@index([campgroundId, type, provider])
}

model IntegrationDefinition {
  id                    String                  @id
  slug                  String                  @unique
  name                  String
  description           String
  category              String
  logoUrl               String?
  docsUrl               String?
  authType              String
  configSchema          Json?
  syncTypes             String[]                @default([])
  webhookTypes          String[]                @default([])
  features              Json?
  isActive              Boolean                 @default(true)
  isBeta                Boolean                 @default(false)
  isPremium             Boolean                 @default(false)
  sortOrder             Int                     @default(100)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  MarketplaceConnection MarketplaceConnection[]

  @@index([category])
  @@index([isActive])
}

model IntegrationExportJob {
  id                    String                 @id
  connectionId          String?
  campgroundId          String?
  type                  String
  resource              String?
  status                String                 @default("queued")
  location              String?
  requestedById         String?
  filters               Json?
  startedAt             DateTime?
  completedAt           DateTime?
  lastError             String?
  createdAt             DateTime               @default(now())
  Campground            Campground?            @relation(fields: [campgroundId], references: [id])
  IntegrationConnection IntegrationConnection? @relation(fields: [connectionId], references: [id])
  User                  User?                  @relation(fields: [requestedById], references: [id])

  @@index([campgroundId, status])
  @@index([connectionId, status])
  @@index([requestedById])
}

model IntegrationSyncLog {
  id                    String                @id
  connectionId          String
  direction             String
  scope                 String
  status                String
  message               String?
  payload               Json?
  occurredAt            DateTime              @default(now())
  createdAt             DateTime              @default(now())
  IntegrationConnection IntegrationConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId, occurredAt])
  @@index([status])
}

model IntegrationWebhookEvent {
  id                    String                 @id
  connectionId          String?
  provider              String
  eventType             String?
  status                String                 @default("received")
  signatureValid        Boolean?
  message               String?
  payload               Json?
  receivedAt            DateTime               @default(now())
  IntegrationConnection IntegrationConnection? @relation(fields: [connectionId], references: [id])

  @@index([connectionId, receivedAt])
  @@index([provider, receivedAt])
}

model InternalConversation {
  id                              String                            @id
  name                            String?
  type                            String
  campgroundId                    String
  createdAt                       DateTime                          @default(now())
  updatedAt                       DateTime
  Campground                      Campground                        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  InternalConversationParticipant InternalConversationParticipant[]
  InternalMessage                 InternalMessage[]

  @@index([campgroundId])
}

model InternalConversationParticipant {
  id                   String               @id
  conversationId       String
  userId               String
  joinedAt             DateTime             @default(now())
  InternalConversation InternalConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User                 User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
}

model InternalMessage {
  id                   String               @id
  content              String
  senderId             String
  conversationId       String
  createdAt            DateTime             @default(now())
  InternalConversation InternalConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User                 User                 @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
  @@index([senderId])
}

model InventoryBatch {
  id                  String                @id
  campgroundId        String
  productId           String
  locationId          String?
  batchNumber         String?
  supplierId          String?
  qtyReceived         Int
  qtyRemaining        Int
  receivedDate        DateTime
  expirationDate      DateTime?
  unitCostCents       Int?
  isActive            Boolean               @default(true)
  depletedAt          DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @default(now())
  createdById         String?
  BatchMovement       BatchMovement[]
  Campground          Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StoreLocation       StoreLocation?        @relation(fields: [locationId], references: [id])
  Product             Product               @relation(fields: [productId], references: [id], onDelete: Cascade)
  MarkdownApplication MarkdownApplication[]

  @@index([campgroundId])
  @@index([expirationDate])
  @@index([isActive, expirationDate])
  @@index([locationId])
  @@index([productId])
  @@index([productId, locationId, isActive, expirationDate])
}

model InventoryBlock {
  blockId     String   @id
  tenantId    String
  sites       Json
  windowStart DateTime
  windowEnd   DateTime
  reason      String
  state       String
  lockId      String   @unique
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([tenantId])
}

model InventoryMovement {
  id            String          @id
  campgroundId  String
  productId     String
  locationId    String?
  batchId       String?
  movementType  String
  qty           Int
  previousQty   Int
  newQty        Int
  referenceType String?
  referenceId   String?
  notes         String?
  actorUserId   String
  createdAt     DateTime        @default(now())
  BatchMovement BatchMovement[]
  User          User            @relation(fields: [actorUserId], references: [id])
  Campground    Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StoreLocation StoreLocation?  @relation(fields: [locationId], references: [id])
  Product       Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([batchId])
  @@index([campgroundId])
  @@index([createdAt])
  @@index([locationId])
  @@index([movementType])
  @@index([productId])
}

model InventoryTransfer {
  id                                                            String                  @id
  campgroundId                                                  String
  fromLocationId                                                String
  toLocationId                                                  String
  status                                                        InventoryTransferStatus @default(pending)
  notes                                                         String?
  requestedById                                                 String
  approvedById                                                  String?
  completedById                                                 String?
  requestedAt                                                   DateTime                @default(now())
  approvedAt                                                    DateTime?
  completedAt                                                   DateTime?
  createdAt                                                     DateTime                @default(now())
  updatedAt                                                     DateTime                @default(now())
  User_InventoryTransfer_approvedByIdToUser                     User?                   @relation("InventoryTransfer_approvedByIdToUser", fields: [approvedById], references: [id])
  Campground                                                    Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_InventoryTransfer_completedByIdToUser                    User?                   @relation("InventoryTransfer_completedByIdToUser", fields: [completedById], references: [id])
  StoreLocation_InventoryTransfer_fromLocationIdToStoreLocation StoreLocation           @relation("InventoryTransfer_fromLocationIdToStoreLocation", fields: [fromLocationId], references: [id], onDelete: Cascade)
  User_InventoryTransfer_requestedByIdToUser                    User                    @relation("InventoryTransfer_requestedByIdToUser", fields: [requestedById], references: [id])
  StoreLocation_InventoryTransfer_toLocationIdToStoreLocation   StoreLocation           @relation("InventoryTransfer_toLocationIdToStoreLocation", fields: [toLocationId], references: [id], onDelete: Cascade)
  InventoryTransferItem                                         InventoryTransferItem[]

  @@index([campgroundId])
  @@index([fromLocationId])
  @@index([status])
  @@index([toLocationId])
}

model InventoryTransferItem {
  id                String            @id
  transferId        String
  productId         String
  qty               Int
  createdAt         DateTime          @default(now())
  Product           Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  InventoryTransfer InventoryTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([transferId])
}

model InviteToken {
  id           String     @id
  token        String     @unique
  userId       String
  campgroundId String
  expiresAt    DateTime
  redeemedAt   DateTime?
  createdAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId, createdAt])
  @@index([userId, campgroundId])
}

model Invoice {
  id             String          @id
  billingCycleId String
  campgroundId   String
  reservationId  String
  number         String          @unique
  dueDate        DateTime
  status         String          @default("open")
  subtotalCents  Int             @default(0)
  taxCents       Int             @default(0)
  totalCents     Int             @default(0)
  balanceCents   Int             @default(0)
  createdAt      DateTime        @default(now())
  closedAt       DateTime?
  ArLedgerEntry  ArLedgerEntry[]
  BillingCycle   BillingCycle    @relation(fields: [billingCycleId], references: [id], onDelete: Cascade)
  Campground     Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Reservation    Reservation     @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  InvoiceLine    InvoiceLine[]

  @@index([campgroundId])
  @@index([reservationId, status])
}

model InvoiceLine {
  id            String          @id
  invoiceId     String
  type          String
  description   String
  quantity      Decimal         @default(1)
  unitCents     Int
  amountCents   Int
  meta          Json?
  ArLedgerEntry ArLedgerEntry[]
  Invoice       Invoice         @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId, type])
}

model Issue {
  id           String         @id
  title        String
  description  String?
  category     IssueCategory
  priority     IssuePriority  @default(medium)
  status       IssueStatus    @default(backlog)
  assignedTo   String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  resolvedAt   DateTime?
  IssueAttempt IssueAttempt[]

  @@index([category])
  @@index([priority])
  @@index([status])
  @@index([status, priority])
}

model IssueAttempt {
  id        String         @id
  issueId   String
  notes     String
  outcome   AttemptOutcome
  createdAt DateTime       @default(now())
  Issue     Issue          @relation(fields: [issueId], references: [id], onDelete: Cascade)

  @@index([issueId])
}

model KioskDevice {
  id            String     @id
  campgroundId  String
  name          String
  deviceToken   String     @unique
  status        String     @default("active")
  lastSeenAt    DateTime?
  userAgent     String?
  allowWalkIns  Boolean    @default(true)
  allowCheckIn  Boolean    @default(true)
  allowPayments Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime
  revokedAt     DateTime?
  Campground    Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([deviceToken])
}

model KioskPairingCode {
  id             String     @id
  campgroundId   String
  code           String
  expiresAt      DateTime
  usedAt         DateTime?
  usedByDeviceId String?
  createdAt      DateTime   @default(now())
  createdById    String?
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, code])
  @@index([campgroundId])
  @@index([code])
}

model LateFeeRule {
  id              String     @id
  campgroundId    String
  cadence         String
  graceDays       Int        @default(3)
  feeType         String
  feeCents        Int?
  feePercentBp    Int?
  applyPerInvoice Boolean    @default(true)
  maxOccurrences  Int?
  active          Boolean    @default(true)
  effectiveFrom   DateTime
  effectiveTo     DateTime?
  Campground      Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, cadence, active])
}

model LeadCaptureConfig {
  id                   String     @id
  campgroundId         String     @unique
  eventsEnabled        Boolean    @default(true)
  eventsHeadline       String     @default("Something exciting is coming...")
  eventsSubtext        String     @default("Sign up to be the first to know about special events and deals")
  eventsButtonText     String     @default("Notify Me")
  newsletterEnabled    Boolean    @default(true)
  newsletterHeadline   String     @default("Get the inside scoop")
  newsletterSubtext    String     @default("Exclusive deals, event announcements, and camping tips")
  newsletterButtonText String     @default("Subscribe")
  firstBookingEnabled  Boolean    @default(true)
  firstBookingDiscount Int        @default(10)
  firstBookingHeadline String     @default("First time? Get 10% off")
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  Campground           Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model LedgerEntry {
  id            String         @id
  campgroundId  String
  reservationId String?
  periodId      String?
  glCode        String?
  account       String?
  description   String?
  amountCents   Int
  direction     String         @default("debit")
  occurredAt    DateTime       @default(now())
  createdAt     DateTime       @default(now())
  externalRef   String?
  dedupeKey     String?
  sourceType    String?
  sourceTxId    String?
  sourceTs      DateTime?
  hash          String?
  adjustment    Boolean        @default(false)
  ArLedgerEntry ArLedgerEntry?
  Campground    Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  GlPeriod      GlPeriod?      @relation(fields: [periodId], references: [id])
  Reservation   Reservation?   @relation(fields: [reservationId], references: [id])
  LedgerLine    LedgerLine[]

  @@index([campgroundId, createdAt])
  @@index([campgroundId, glCode, createdAt])
  @@index([campgroundId])
  @@index([dedupeKey])
  @@index([glCode])
  @@index([periodId])
  @@index([reservationId, createdAt])
  @@index([reservationId])
  @@index([sourceTxId])
}

model LedgerLine {
  id                String      @id
  ledgerEntryId     String
  glAccountId       String
  side              String
  amountCents       Int
  memo              String?
  productCode       String?
  channelCode       String?
  taxJurisdiction   String?
  taxRateBps        Int?
  taxableBaseCents  Int?
  reconciliationKey String?
  createdAt         DateTime    @default(now())
  GlAccount         GlAccount   @relation(fields: [glAccountId], references: [id], onDelete: Cascade)
  LedgerEntry       LedgerEntry @relation(fields: [ledgerEntryId], references: [id], onDelete: Cascade)

  @@index([glAccountId])
  @@index([ledgerEntryId])
  @@index([reconciliationKey])
}

model LevelDefinition {
  id        String   @id
  level     Int      @unique
  name      String
  minXp     Int
  perks     Json?
  createdAt DateTime @default(now())
}

model LocationInventory {
  id            String        @id
  productId     String
  locationId    String
  stockQty      Int           @default(0)
  lowStockAlert Int?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now())
  StoreLocation StoreLocation @relation(fields: [locationId], references: [id], onDelete: Cascade)
  Product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locationId])
  @@index([locationId])
  @@index([productId])
}

model LocationPriceOverride {
  id            String        @id
  productId     String
  locationId    String
  priceCents    Int
  reason        String?
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now())
  StoreLocation StoreLocation @relation(fields: [locationId], references: [id], onDelete: Cascade)
  Product       Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locationId])
  @@index([isActive])
  @@index([locationId])
  @@index([productId])
}

model LockCode {
  id                 String                   @id
  campgroundId       String
  name               String
  code               String
  type               LockCodeType
  rotationSchedule   LockCodeRotationSchedule @default(none)
  showOnConfirmation Boolean                  @default(true)
  showAtCheckin      Boolean                  @default(true)
  appliesTo          String[]                 @default([])
  isActive           Boolean                  @default(true)
  lastRotatedAt      DateTime?
  notes              String?
  createdAt          DateTime                 @default(now())
  updatedAt          DateTime
  Campground         Campground               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, type])
}

model LoyaltyProfile {
  id                String              @id
  guestId           String              @unique
  pointsBalance     Int                 @default(0)
  tier              String              @default("Bronze")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now())
  Guest             Guest               @relation(fields: [guestId], references: [id], onDelete: Cascade)
  PointsTransaction PointsTransaction[]

  @@index([guestId])
}

model MaintenanceTicket {
  id               String              @id
  campgroundId     String
  siteId           String?
  title            String
  description      String?
  status           MaintenanceStatus   @default(open)
  priority         MaintenancePriority @default(medium)
  dueDate          DateTime?
  assignedTo       String?
  assignedToTeamId String?
  isBlocking       Boolean             @default(false)
  outOfOrder       Boolean             @default(false)
  outOfOrderReason String?
  outOfOrderUntil  DateTime?
  lockId           String?             @unique
  checklist        Json?
  photos           Json?
  notes            String?
  resolvedAt       DateTime?
  reopenedAt       DateTime?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @default(now())
  User             User?               @relation(fields: [assignedTo], references: [id])
  Campground       Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site             Site?               @relation(fields: [siteId], references: [id])

  @@index([assignedTo])
  @@index([campgroundId])
  @@index([campgroundId, status, dueDate])
  @@index([campgroundId, status, siteId])
  @@index([dueDate])
  @@index([status])
}

model MarkdownApplication {
  id                  String         @id
  campgroundId        String
  markdownRuleId      String
  batchId             String
  cartId              String?
  originalPriceCents  Int
  markdownPriceCents  Int
  discountCents       Int
  qty                 Int
  daysUntilExpiration Int
  createdAt           DateTime       @default(now())
  InventoryBatch      InventoryBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  Campground          Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  MarkdownRule        MarkdownRule   @relation(fields: [markdownRuleId], references: [id], onDelete: Cascade)

  @@index([batchId])
  @@index([campgroundId])
  @@index([createdAt])
  @@index([markdownRuleId])
}

model MarkdownRule {
  id                  String                @id
  campgroundId        String
  daysUntilExpiration Int
  discountType        MarkdownDiscountType
  discountValue       Int
  scope               MarkdownScope
  categoryId          String?
  productId           String?
  priority            Int                   @default(100)
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @default(now())
  createdById         String?
  MarkdownApplication MarkdownApplication[]
  Campground          Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ProductCategory     ProductCategory?      @relation(fields: [categoryId], references: [id])
  Product             Product?              @relation(fields: [productId], references: [id])

  @@index([campgroundId])
  @@index([categoryId])
  @@index([isActive, daysUntilExpiration])
  @@index([productId])
}

model MarketplaceConnection {
  id                    String                @id
  campgroundId          String
  definitionId          String
  status                String                @default("pending")
  credentials           Json?
  config                Json?
  webhookSecret         String?
  lastSyncAt            DateTime?
  lastSyncStatus        String?
  errorMessage          String?
  errorCode             String?
  syncEnabled           Boolean               @default(true)
  syncSchedule          String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  Campground            Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  IntegrationDefinition IntegrationDefinition @relation(fields: [definitionId], references: [id])
  MarketplaceSyncLog    MarketplaceSyncLog[]

  @@unique([campgroundId, definitionId])
  @@index([campgroundId])
  @@index([definitionId])
  @@index([status])
}

model MarketplaceSyncLog {
  id                    String                @id
  connectionId          String
  syncType              String
  direction             String
  recordsProcessed      Int                   @default(0)
  recordsFailed         Int                   @default(0)
  recordsSkipped        Int                   @default(0)
  startedAt             DateTime              @default(now())
  completedAt           DateTime?
  status                String                @default("running")
  errorDetails          Json?
  summary               Json?
  triggeredBy           String?
  metadata              Json?
  MarketplaceConnection MarketplaceConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId])
  @@index([connectionId, startedAt])
  @@index([status])
}

model MembershipType {
  id              String            @id
  campgroundId    String
  name            String
  description     String?
  price           Int
  durationDays    Int
  discountPercent Int
  isActive        Boolean           @default(true)
  GuestMembership GuestMembership[]
  Campground      Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model Message {
  id             String      @id
  campgroundId   String
  reservationId  String
  guestId        String
  senderType     SenderType
  content        String
  readAt         DateTime?
  createdAt      DateTime    @default(now())
  sentiment      String?
  sentimentScore Float?
  urgencyLevel   String?
  aiAnalyzedAt   DateTime?
  Campground     Campground  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest          Guest       @relation(fields: [guestId], references: [id], onDelete: Cascade)
  Reservation    Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, sentiment])
  @@index([guestId])
  @@index([reservationId])
}

model MobileDeviceToken {
  id           String      @id
  userId       String
  campgroundId String?
  deviceToken  String      @unique
  platform     String
  deviceId     String?
  appBundle    String?
  appVersion   String?
  environment  String      @default("production")
  isActive     Boolean     @default(true)
  lastUsedAt   DateTime    @default(now())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime
  Campground   Campground? @relation(fields: [campgroundId], references: [id])
  User         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([deviceId])
  @@index([platform])
  @@index([userId])
}

model MobileSession {
  id               String    @id
  userId           String
  refreshTokenHash String    @unique
  deviceId         String?
  deviceName       String?
  platform         String?
  appVersion       String?
  lastUsedAt       DateTime  @default(now())
  expiresAt        DateTime
  revokedAt        DateTime?
  createdAt        DateTime  @default(now())
  User             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([expiresAt])
  @@index([userId])
}

model NotificationTrigger {
  id                    String                  @id
  campgroundId          String
  event                 String
  channel               String
  enabled               Boolean                 @default(true)
  templateId            String?
  delayMinutes          Int                     @default(0)
  conditions            Json?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  Campground            Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  CampaignTemplate      CampaignTemplate?       @relation(fields: [templateId], references: [id])
  ScheduledNotification ScheduledNotification[]

  @@index([campgroundId])
  @@index([enabled])
  @@index([event])
}

model NpsEvent {
  id        String    @id
  inviteId  String
  type      String
  payload   Json?
  createdAt DateTime  @default(now())
  NpsInvite NpsInvite @relation(fields: [inviteId], references: [id], onDelete: Cascade)

  @@index([inviteId, type])
}

model NpsInvite {
  id             String          @id
  surveyId       String
  campgroundId   String
  organizationId String?
  guestId        String?
  reservationId  String?
  channel        String
  status         NpsInviteStatus @default(queued)
  token          String          @unique
  expiresAt      DateTime?
  sentAt         DateTime?
  openedAt       DateTime?
  respondedAt    DateTime?
  metadata       Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @default(now())
  NpsEvent       NpsEvent[]
  Campground     Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest          Guest?          @relation(fields: [guestId], references: [id])
  Reservation    Reservation?    @relation(fields: [reservationId], references: [id])
  NpsSurvey      NpsSurvey       @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  NpsResponse    NpsResponse?

  @@index([campgroundId, status])
  @@index([guestId])
  @@index([reservationId])
}

model NpsResponse {
  id            String       @id
  surveyId      String
  inviteId      String?      @unique
  campgroundId  String
  guestId       String?
  reservationId String?
  score         Int
  comment       String?
  tags          String[]     @default([])
  sentiment     String?
  createdAt     DateTime     @default(now())
  followedUp    Boolean      @default(false)
  followUpAt    DateTime?
  followUpNote  String?
  followUpBy    String?
  resolved      Boolean      @default(false)
  resolvedAt    DateTime?
  resolvedBy    String?
  resolvedNote  String?
  Campground    Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest         Guest?       @relation(fields: [guestId], references: [id])
  NpsInvite     NpsInvite?   @relation(fields: [inviteId], references: [id])
  Reservation   Reservation? @relation(fields: [reservationId], references: [id])
  NpsSurvey     NpsSurvey    @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  @@index([campgroundId, createdAt])
  @@index([followedUp])
  @@index([guestId])
  @@index([reservationId])
  @@index([resolved])
  @@index([surveyId])
}

model NpsRule {
  id           String    @id
  surveyId     String
  trigger      String
  percentage   Int?
  cooldownDays Int?
  segmentJson  Json?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now())
  NpsSurvey    NpsSurvey @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  @@index([surveyId, isActive])
}

model NpsSurvey {
  id              String          @id
  campgroundId    String
  name            String
  question        String?
  status          NpsSurveyStatus @default(draft)
  channels        String[]        @default(["inapp", "email"])
  locales         String[]        @default(["en"])
  cooldownDays    Int?
  samplingPercent Int?
  metadata        Json?
  activeFrom      DateTime?
  activeTo        DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now())
  NpsInvite       NpsInvite[]
  NpsResponse     NpsResponse[]
  NpsRule         NpsRule[]
  Campground      Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, status])
}

model OAuthClient {
  id                String       @id
  campgroundId      String
  name              String
  description       String?
  clientId          String       @unique
  clientSecretHash  String?
  redirectUris      String[]
  scopes            String[]
  grantTypes        String[]
  isConfidential    Boolean      @default(true)
  isActive          Boolean      @default(true)
  logoUrl           String?
  homepageUrl       String?
  privacyPolicyUrl  String?
  termsOfServiceUrl String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime
  Campground        Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  OAuthToken        OAuthToken[]

  @@index([campgroundId])
  @@index([isActive])
}

model OAuthScope {
  id           String   @id
  name         String   @unique
  description  String
  category     String?
  isDefault    Boolean  @default(false)
  isRestricted Boolean  @default(false)
  createdAt    DateTime @default(now())

  @@index([category])
  @@index([isDefault])
}

model OAuthToken {
  id               String      @id
  oAuthClientId    String
  accessTokenHash  String      @unique
  refreshTokenHash String?     @unique
  scopes           String[]
  userId           String?
  expiresAt        DateTime
  refreshExpiresAt DateTime?
  revokedAt        DateTime?
  createdAt        DateTime    @default(now())
  OAuthClient      OAuthClient @relation(fields: [oAuthClientId], references: [id], onDelete: Cascade)
  User             User?       @relation(fields: [userId], references: [id])

  @@index([expiresAt])
  @@index([oAuthClientId])
  @@index([revokedAt])
  @@index([userId])
}

model OccupancySnapshot {
  id           String     @id
  campgroundId String
  date         DateTime   @db.Date
  totalSites   Int
  occupied     Int
  blocked      Int
  available    Int
  occupancyPct Float
  revenueCents Int        @default(0)
  createdAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id])

  @@unique([campgroundId, date])
  @@index([campgroundId, date])
}

model OnboardingInvite {
  id                String             @id
  token             String             @unique
  email             String
  organizationId    String?
  campgroundId      String?
  invitedById       String?
  expiresAt         DateTime
  redeemedAt        DateTime?
  lastSentAt        DateTime?
  createdAt         DateTime           @default(now())
  Campground        Campground?        @relation(fields: [campgroundId], references: [id])
  User              User?              @relation(fields: [invitedById], references: [id])
  Organization      Organization?      @relation(fields: [organizationId], references: [id])
  OnboardingSession OnboardingSession?

  @@index([campgroundId, createdAt])
  @@index([organizationId, createdAt])
  @@index([token])
}

model OnboardingQuizResponse {
  id                  String            @id
  onboardingSessionId String            @unique
  parkType            String?
  operations          String[]          @default([])
  teamSize            String?
  amenities           String[]          @default([])
  techLevel           String?
  recommendedNow      String[]          @default([])
  recommendedLater    String[]          @default([])
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  OnboardingSession   OnboardingSession @relation(fields: [onboardingSessionId], references: [id], onDelete: Cascade)
}

model OnboardingSession {
  id                     String                  @id
  inviteId               String                  @unique
  organizationId         String?
  campgroundId           String?
  status                 OnboardingStatus        @default(pending)
  currentStep            OnboardingStep          @default(account_profile)
  completedSteps         OnboardingStep[]        @default([])
  data                   Json?
  progress               Json?
  expiresAt              DateTime?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime

  // AI Import fields
  emailVerified          Boolean                 @default(false)
  emailVerifiedAt        DateTime?
  emailVerifyCode        String?
  emailVerifyExpiry      DateTime?
  aiCallsUsed            Int                     @default(0)
  aiAccessTier           String                  @default("none") // none, trial, full
  lastAiCallAt           DateTime?

  // Relations
  OnboardingQuizResponse OnboardingQuizResponse?
  Campground             Campground?             @relation(fields: [campgroundId], references: [id])
  OnboardingInvite       OnboardingInvite        @relation(fields: [inviteId], references: [id], onDelete: Cascade)
  Organization           Organization?           @relation(fields: [organizationId], references: [id])
  importDrafts           OnboardingImportDraft[]
  aiUsageLogs            OnboardingAiUsage[]

  @@index([campgroundId])
  @@index([inviteId])
  @@index([organizationId])
}

model OnboardingImportDraft {
  id            String            @id @default(uuid())
  sessionId     String
  documentId    String            @unique
  documentType  String            // csv, excel, pdf, image
  targetEntity  String            // sites, guests, reservations, rates
  originalFile  String            // temp file path or S3 key
  fileName      String?           // original file name
  extractedData Json?             // { rows: RowConfidence[], summary: {...} }
  corrections   Json?             // user corrections applied
  status        ImportDraftStatus @default(pending_upload)
  aiCallsUsed   Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  expiresAt     DateTime          // TTL for cleanup

  session OnboardingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([expiresAt])
  @@index([status])
}

model OnboardingAiUsage {
  id           String   @id @default(uuid())
  sessionId    String
  featureType  String   // classification, extraction, chat, autofill
  inputTokens  Int
  outputTokens Int
  costCents    Int
  modelUsed    String
  success      Boolean  @default(true)
  errorType    String?
  createdAt    DateTime @default(now())

  session OnboardingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId, createdAt])
}

model OpBadge {
  id           String          @id
  campgroundId String?
  code         String
  name         String
  description  String
  icon         String
  category     OpBadgeCategory
  tier         OpBadgeTier     @default(bronze)
  criteria     Json
  points       Int             @default(10)
  isActive     Boolean         @default(true)
  createdAt    DateTime        @default(now())
  Campground   Campground?     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  OpStaffBadge OpStaffBadge[]

  @@unique([campgroundId, code])
  @@index([campgroundId])
  @@index([category])
}

model OpRecurrenceRule {
  id               String              @id
  campgroundId     String
  name             String
  templateId       String
  pattern          OpRecurrencePattern
  daysOfWeek       Int[]               @default([])
  daysOfMonth      Int[]               @default([])
  generateAtHour   Int                 @default(6)
  generateAtMinute Int                 @default(0)
  siteClassIds     String[]            @default([])
  siteIds          String[]            @default([])
  locationFilter   String?
  assignToTeamId   String?
  assignToUserId   String?
  lastGeneratedAt  DateTime?
  nextGenerationAt DateTime?
  isActive         Boolean             @default(true)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime
  OpTeam           OpTeam?             @relation(fields: [assignToTeamId], references: [id])
  User             User?               @relation(fields: [assignToUserId], references: [id])
  Campground       Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  OpTaskTemplate   OpTaskTemplate      @relation(fields: [templateId], references: [id], onDelete: Cascade)
  OpTask           OpTask[]

  @@index([campgroundId, isActive])
  @@index([campgroundId, pattern])
  @@index([nextGenerationAt])
}

model OpStaffBadge {
  id           String     @id
  userId       String
  badgeId      String
  campgroundId String
  earnedAt     DateTime   @default(now())
  context      Json?
  OpBadge      OpBadge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId, campgroundId])
  @@index([badgeId])
  @@index([campgroundId])
  @@index([earnedAt])
  @@index([userId])
}

model OpStaffDailyStats {
  id                String     @id
  userId            String
  campgroundId      String
  date              DateTime   @db.Date
  tasksCompleted    Int        @default(0)
  tasksOnTime       Int        @default(0)
  tasksLate         Int        @default(0)
  totalWorkMinutes  Int        @default(0)
  avgCompletionTime Int?
  fastestTask       Int?
  fastCompletions   Int        @default(0)
  pointsEarned      Int        @default(0)
  isWorkDay         Boolean    @default(true)
  Campground        Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User              User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, campgroundId, date])
  @@index([campgroundId])
  @@index([date])
  @@index([userId])
}

model OpStaffStats {
  id                   String     @id
  userId               String
  campgroundId         String
  totalTasksCompleted  Int        @default(0)
  totalTasksOnTime     Int        @default(0)
  totalTasksLate       Int        @default(0)
  totalPoints          Int        @default(0)
  currentStreak        Int        @default(0)
  longestStreak        Int        @default(0)
  currentPerfectStreak Int        @default(0)
  longestPerfectStreak Int        @default(0)
  weekTasksCompleted   Int        @default(0)
  weekTasksOnTime      Int        @default(0)
  weekPoints           Int        @default(0)
  weekFastCompletions  Int        @default(0)
  monthTasksCompleted  Int        @default(0)
  monthTasksOnTime     Int        @default(0)
  monthPoints          Int        @default(0)
  avgCompletionTime    Int?       @default(0)
  slaComplianceRate    Float      @default(100)
  totalFastCompletions Int        @default(0)
  weeklyRank           Int?
  monthlyRank          Int?
  allTimeRank          Int?
  lastTaskAt           DateTime?
  updatedAt            DateTime
  Campground           Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User                 User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, campgroundId])
  @@index([campgroundId])
  @@index([monthPoints])
  @@index([totalPoints])
  @@index([weekPoints])
}

model OpTask {
  id                                 String            @id
  campgroundId                       String
  category                           OpTaskCategory
  state                              OpTaskState       @default(pending)
  priority                           OpTaskPriority    @default(medium)
  title                              String
  description                        String?
  checklist                          Json?
  checklistProgress                  Int               @default(0)
  photos                             Json?
  siteId                             String?
  reservationId                      String?
  locationDescription                String?
  assignedToUserId                   String?
  assignedToTeamId                   String?
  slaDueAt                           DateTime?
  slaStatus                          OpSlaStatus       @default(on_track)
  slaEscalatedAt                     DateTime?
  slaEscalatedToId                   String?
  templateId                         String?
  triggerId                          String?
  recurrenceRuleId                   String?
  sourceEvent                        OpTriggerEvent?
  startedAt                          DateTime?
  completedAt                        DateTime?
  completedById                      String?
  verifiedAt                         DateTime?
  verifiedById                       String?
  isBlocking                         Boolean           @default(false)
  outOfOrder                         Boolean           @default(false)
  outOfOrderReason                   String?
  outOfOrderUntil                    DateTime?
  notes                              String?
  xpAwarded                          Int               @default(0)
  createdById                        String
  createdAt                          DateTime          @default(now())
  updatedAt                          DateTime
  OpTeam                             OpTeam?           @relation(fields: [assignedToTeamId], references: [id])
  User_OpTask_assignedToUserIdToUser User?             @relation("OpTask_assignedToUserIdToUser", fields: [assignedToUserId], references: [id])
  Campground                         Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_OpTask_completedByIdToUser    User?             @relation("OpTask_completedByIdToUser", fields: [completedById], references: [id])
  User_OpTask_createdByIdToUser      User              @relation("OpTask_createdByIdToUser", fields: [createdById], references: [id])
  OpRecurrenceRule                   OpRecurrenceRule? @relation(fields: [recurrenceRuleId], references: [id])
  Reservation                        Reservation?      @relation(fields: [reservationId], references: [id])
  Site                               Site?             @relation(fields: [siteId], references: [id])
  User_OpTask_slaEscalatedToIdToUser User?             @relation("OpTask_slaEscalatedToIdToUser", fields: [slaEscalatedToId], references: [id])
  OpTaskTemplate                     OpTaskTemplate?   @relation(fields: [templateId], references: [id])
  OpTaskTrigger                      OpTaskTrigger?    @relation(fields: [triggerId], references: [id])
  User_OpTask_verifiedByIdToUser     User?             @relation("OpTask_verifiedByIdToUser", fields: [verifiedById], references: [id])
  OpTaskComment                      OpTaskComment[]

  @@index([assignedToTeamId])
  @@index([assignedToUserId])
  @@index([campgroundId, category])
  @@index([campgroundId, slaDueAt])
  @@index([campgroundId, slaStatus])
  @@index([campgroundId, state])
  @@index([reservationId])
  @@index([siteId])
}

model OpTaskComment {
  id              String   @id
  taskId          String
  userId          String
  content         String
  isSystemMessage Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  OpTask          OpTask   @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([taskId, createdAt])
}

model OpTaskTemplate {
  id                String             @id
  campgroundId      String
  name              String
  description       String?
  category          OpTaskCategory
  priority          OpTaskPriority     @default(medium)
  checklistTemplate Json?
  suppliesNeeded    Json?
  estimatedMinutes  Int?
  slaMinutes        Int?
  defaultTeamId     String?
  defaultAssigneeId String?
  siteClassIds      String[]           @default([])
  siteIds           String[]           @default([])
  xpValue           Int                @default(10)
  isActive          Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  OpRecurrenceRule  OpRecurrenceRule[]
  OpTask            OpTask[]
  Campground        Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User              User?              @relation(fields: [defaultAssigneeId], references: [id])
  OpTeam            OpTeam?            @relation(fields: [defaultTeamId], references: [id])
  OpTaskTrigger     OpTaskTrigger[]

  @@index([campgroundId, category])
  @@index([campgroundId, isActive])
}

model OpTaskTrigger {
  id               String         @id
  campgroundId     String
  name             String
  triggerEvent     OpTriggerEvent
  templateId       String
  conditions       Json?
  slaOffsetMinutes Int            @default(0)
  assignToTeamId   String?
  assignToUserId   String?
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  OpTask           OpTask[]
  OpTeam           OpTeam?        @relation(fields: [assignToTeamId], references: [id])
  User             User?          @relation(fields: [assignToUserId], references: [id])
  Campground       Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  OpTaskTemplate   OpTaskTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([campgroundId, isActive])
  @@index([campgroundId, triggerEvent])
}

model OpTeam {
  id               String             @id
  campgroundId     String
  name             String
  description      String?
  color            String?
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  OpRecurrenceRule OpRecurrenceRule[]
  OpTask           OpTask[]
  OpTaskTemplate   OpTaskTemplate[]
  OpTaskTrigger    OpTaskTrigger[]
  Campground       Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  OpTeamMember     OpTeamMember[]

  @@unique([campgroundId, name])
  @@index([campgroundId])
}

model OpTeamMember {
  id       String   @id
  teamId   String
  userId   String
  role     String   @default("member")
  joinedAt DateTime @default(now())
  OpTeam   OpTeam   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  User     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
}

model OperationalTask {
  id           String     @id
  campgroundId String
  title        String
  description  String?
  type         String
  status       String     @default("pending")
  priority     String     @default("medium")
  assignedTo   String?
  dueDate      DateTime?
  completedAt  DateTime?
  siteId       String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site         Site?      @relation(fields: [siteId], references: [id])
}

model OrgReferral {
  id                                                   String            @id
  referrerOrgId                                        String
  referredOrgId                                        String?
  referredEmail                                        String?
  referralCode                                         String
  status                                               OrgReferralStatus @default(clicked)
  creditAmountCents                                    Int               @default(5000)
  clickedAt                                            DateTime          @default(now())
  signedUpAt                                           DateTime?
  convertedAt                                          DateTime?
  creditedAt                                           DateTime?
  utmSource                                            String?
  utmMedium                                            String?
  utmCampaign                                          String?
  ipAddress                                            String?
  userAgent                                            String?
  createdAt                                            DateTime          @default(now())
  updatedAt                                            DateTime          @default(now())
  Organization_OrgReferral_referredOrgIdToOrganization Organization?     @relation("OrgReferral_referredOrgIdToOrganization", fields: [referredOrgId], references: [id])
  Organization_OrgReferral_referrerOrgIdToOrganization Organization      @relation("OrgReferral_referrerOrgIdToOrganization", fields: [referrerOrgId], references: [id], onDelete: Cascade)

  @@index([referralCode])
  @@index([referredEmail])
  @@index([referredOrgId])
  @@index([referrerOrgId])
  @@index([status])
}

model Organization {
  id                                                  String                      @id
  name                                                String
  subscriptionTier                                    SubscriptionTier            @default(free)
  billingEmail                                        String?
  billingName                                         String?
  billingAddress1                                     String?
  billingAddress2                                     String?
  billingCity                                         String?
  billingState                                        String?
  billingPostalCode                                   String?
  billingCountry                                      String?
  stripeCustomerId                                    String?                     @unique
  stripeSubscriptionId                                String?                     @unique
  subscriptionStatus                                  String?
  billingTier                                         String?                     @default("standard")
  billingStatus                                       String?                     @default("active")
  trialEndsAt                                         DateTime?
  dataRegion                                          String                      @default("us-east-1")
  referralCode                                        String?                     @unique
  referralCredits                                     Int                         @default(0)
  createdAt                                           DateTime                    @default(now())
  updatedAt                                           DateTime                    @default(now())
  AbEnrollment                                        AbEnrollment[]
  AbTest                                              AbTest[]
  AnalyticsAnomaly                                    AnalyticsAnomaly[]
  AnalyticsDailyAggregate                             AnalyticsDailyAggregate[]
  AnalyticsEvent                                      AnalyticsEvent[]
  AnalyticsFeatureUsage                               AnalyticsFeatureUsage[]
  AnalyticsFunnel                                     AnalyticsFunnel[]
  AnalyticsPageStats                                  AnalyticsPageStats[]
  AnalyticsSession                                    AnalyticsSession[]
  Campground                                          Campground[]
  CentralizedRatePush                                 CentralizedRatePush[]
  EarlyAccessEnrollment                               EarlyAccessEnrollment?
  IntegrationConnection                               IntegrationConnection[]
  OnboardingInvite                                    OnboardingInvite[]
  OnboardingSession                                   OnboardingSession[]
  OrgReferral_OrgReferral_referredOrgIdToOrganization OrgReferral[]               @relation("OrgReferral_referredOrgIdToOrganization")
  OrgReferral_OrgReferral_referrerOrgIdToOrganization OrgReferral[]               @relation("OrgReferral_referrerOrgIdToOrganization")
  OrganizationBillingPeriod                           OrganizationBillingPeriod[]
  PortfolioDashboard                                  PortfolioDashboard[]
  PortfolioMetric                                     PortfolioMetric[]
  SetupService                                        SetupService[]
  UsageEvent                                          UsageEvent[]
}

model OrganizationBillingLineItem {
  id                        String                    @id
  billingPeriodId           String
  type                      OrgBillingLineItemType
  description               String
  quantity                  Int                       @default(1)
  unitCents                 Int
  totalCents                Int
  campgroundId              String?
  reservationId             String?
  metadata                  Json?
  createdAt                 DateTime                  @default(now())
  OrganizationBillingPeriod OrganizationBillingPeriod @relation(fields: [billingPeriodId], references: [id], onDelete: Cascade)
  Campground                Campground?               @relation(fields: [campgroundId], references: [id])

  @@index([billingPeriodId])
  @@index([campgroundId])
  @@index([type])
}

model OrganizationBillingPeriod {
  id                          String                        @id
  organizationId              String
  periodStart                 DateTime
  periodEnd                   DateTime
  status                      OrgBillingPeriodStatus        @default(open)
  subtotalCents               Int                           @default(0)
  discountCents               Int                           @default(0)
  taxCents                    Int                           @default(0)
  totalCents                  Int                           @default(0)
  stripeInvoiceId             String?                       @unique
  stripePaymentIntentId       String?
  invoicedAt                  DateTime?
  paidAt                      DateTime?
  dueAt                       DateTime?
  notes                       String?
  metadata                    Json?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  OrganizationBillingLineItem OrganizationBillingLineItem[]
  Organization                Organization                  @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, periodStart])
  @@index([organizationId])
  @@index([periodStart])
  @@index([status])
}

model OtaChannel {
  id                         String                 @id
  campgroundId               String
  name                       String
  provider                   String
  status                     String                 @default("disabled")
  rateMultiplier             Float                  @default(1.0)
  defaultStatus              String                 @default("confirmed")
  sendEmailNotifications     Boolean                @default(false)
  ignoreSiteRestrictions     Boolean                @default(false)
  ignoreCategoryRestrictions Boolean                @default(false)
  feeMode                    String                 @default("absorb")
  webhookSecret              String?
  lastSyncAt                 DateTime?
  createdAt                  DateTime               @default(now())
  updatedAt                  DateTime
  Campground                 Campground             @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  OtaListingMapping          OtaListingMapping[]
  OtaReservationImport       OtaReservationImport[]
  OtaSyncLog                 OtaSyncLog[]

  @@index([campgroundId])
  @@index([provider, campgroundId])
}

model OtaListingMapping {
  id                 String     @id
  channelId          String
  siteId             String?
  siteClassId        String?
  externalId         String
  status             String     @default("mapped")
  lastSyncAt         DateTime?
  lastError          String?
  icalToken          String?    @unique
  icalUrl            String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime
  icalTokenExpiresAt DateTime?
  OtaChannel         OtaChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  SiteClass          SiteClass? @relation(fields: [siteClassId], references: [id])
  Site               Site?      @relation(fields: [siteId], references: [id])

  @@unique([channelId, externalId])
  @@index([channelId, siteClassId])
  @@index([channelId, siteId])
}

model OtaReservationImport {
  id                    String       @id
  channelId             String
  externalReservationId String
  status                String
  message               String?
  reservationId         String?
  createdAt             DateTime     @default(now())
  OtaChannel            OtaChannel   @relation(fields: [channelId], references: [id], onDelete: Cascade)
  Reservation           Reservation? @relation(fields: [reservationId], references: [id])

  @@unique([channelId, externalReservationId])
  @@index([reservationId])
}

model OtaSyncLog {
  id         String     @id
  channelId  String
  direction  String
  eventType  String
  status     String
  message    String?
  payload    Json?
  createdAt  DateTime   @default(now())
  OtaChannel OtaChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@index([channelId, createdAt])
  @@index([channelId, direction, eventType])
}

model OverrideRequest {
  id                                    String         @id
  campgroundId                          String
  userId                                String
  approverId                            String?
  type                                  OverrideType
  reason                                String?
  status                                OverrideStatus @default(pending)
  targetEntity                          String?
  targetId                              String?
  deltaAmount                           Decimal?       @db.Decimal(10, 2)
  metadata                              Json?
  approvedAt                            DateTime?
  rejectedAt                            DateTime?
  createdAt                             DateTime       @default(now())
  updatedAt                             DateTime
  User_OverrideRequest_approverIdToUser User?          @relation("OverrideRequest_approverIdToUser", fields: [approverId], references: [id])
  Campground                            Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_OverrideRequest_userIdToUser     User           @relation("OverrideRequest_userIdToUser", fields: [userId], references: [id])

  @@index([campgroundId, status, type])
  @@index([targetEntity, targetId])
}

model OvertimeConfig {
  id                   String     @id
  campgroundId         String     @unique
  weeklyThreshold      Int        @default(40)
  dailyThreshold       Int?
  overtimeMultiplier   Decimal    @default(1.5) @db.Decimal(3, 2)
  doubleTimeThreshold  Int?
  doubleTimeMultiplier Decimal?   @db.Decimal(3, 2)
  weekStartDay         Int        @default(0)
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  Campground           Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model Payment {
  id                         String      @id
  campgroundId               String
  reservationId              String
  amountCents                Int
  method                     String      @default("card")
  direction                  String      @default("charge")
  note                       String?
  stripePaymentIntentId      String?     @unique
  stripeChargeId             String?
  stripeBalanceTransactionId String?
  stripePayoutId             String?
  applicationFeeCents        Int?
  stripeFeeCents             Int?
  methodType                 String?
  capturedAt                 DateTime?
  createdAt                  DateTime    @default(now())
  stripePaymentMethodId      String?
  stripeCustomerId           String?
  paymentMethodType          String?
  paymentMethodLast4         String?
  paymentMethodBrand         String?
  terminalReaderId           String?
  paymentSource              String?
  refundedAmountCents        Int?        @default(0)
  refundedAt                 DateTime?
  originalPaymentId          String?
  Campground                 Campground  @relation(fields: [campgroundId], references: [id])
  Reservation                Reservation @relation(fields: [reservationId], references: [id])

  @@index([campgroundId, capturedAt])
  @@index([campgroundId, createdAt])
  @@index([campgroundId])
  @@index([reservationId, direction])
  @@index([reservationId])
  @@index([stripeChargeId])
  @@index([stripeCustomerId])
  @@index([stripePaymentIntentId])
  @@index([stripePaymentMethodId])
  @@index([stripePayoutId])
}

model PaymentAuditLog {
  id           String   @id
  campgroundId String
  actorId      String?
  actorEmail   String?
  actorRole    String?
  action       String
  entityType   String
  entityId     String
  before       Json?
  after        Json?
  metadata     Json?
  ip           String?
  userAgent    String?
  createdAt    DateTime @default(now())

  @@index([actorId])
  @@index([campgroundId, action])
  @@index([campgroundId, createdAt])
  @@index([campgroundId])
  @@index([entityType, entityId])
}

model Payout {
  id                  String       @id
  campgroundId        String
  stripePayoutId      String       @unique
  stripeAccountId     String
  amountCents         Int
  feeCents            Int?
  currency            String       @default("usd")
  status              PayoutStatus @default(pending)
  arrivalDate         DateTime?
  paidAt              DateTime?
  statementDescriptor String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @default(now())
  Dispute             Dispute[]
  Campground          Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  PayoutLine          PayoutLine[]

  @@index([campgroundId])
  @@index([status])
  @@index([stripeAccountId])
}

model PayoutLine {
  id                   String       @id
  payoutId             String
  type                 String
  amountCents          Int
  currency             String       @default("usd")
  description          String?
  reservationId        String?
  paymentIntentId      String?
  chargeId             String?
  balanceTransactionId String?
  createdAt            DateTime     @default(now())
  Payout               Payout       @relation(fields: [payoutId], references: [id], onDelete: Cascade)
  Reservation          Reservation? @relation(fields: [reservationId], references: [id])

  @@index([balanceTransactionId])
  @@index([chargeId])
  @@index([paymentIntentId])
  @@index([payoutId])
  @@index([reservationId])
}

model PayoutRecon {
  id                  String            @id
  campgroundId        String
  provider            String            @default("stripe")
  status              PayoutReconStatus @default(pending)
  expectedAmountCents Int?
  actualAmountCents   Int?
  varianceCents       Int?
  currency            String            @default("usd")
  payoutDate          DateTime?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @default(now())
  Campground          Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  PayoutReconLine     PayoutReconLine[]

  @@index([campgroundId])
  @@index([payoutDate])
  @@index([status])
}

model PayoutReconLine {
  id            String      @id
  payoutReconId String
  type          String
  status        String      @default("matched")
  sourceTxId    String?
  sourceTs      DateTime?
  amountCents   Int
  currency      String      @default("usd")
  glEntryId     String?
  notes         String?
  createdAt     DateTime    @default(now())
  PayoutRecon   PayoutRecon @relation(fields: [payoutReconId], references: [id], onDelete: Cascade)

  @@index([glEntryId])
  @@index([payoutReconId])
  @@index([sourceTxId])
}

model PayrollConfig {
  id           String          @id
  campgroundId String          @unique
  provider     PayrollProvider @default(generic)
  companyId    String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime
  Campground   Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model PayrollEarningCode {
  id           String          @id
  campgroundId String
  roleCode     String
  provider     PayrollProvider @default(generic)
  earningCode  String
  createdAt    DateTime        @default(now())
  updatedAt    DateTime

  @@unique([campgroundId, roleCode, provider])
  @@index([campgroundId, provider])
}

model PayrollExport {
  id                String              @id
  campgroundId      String
  periodStart       DateTime            @db.Date
  periodEnd         DateTime            @db.Date
  provider          PayrollProvider     @default(generic)
  format            PayrollExportFormat @default(csv)
  status            PayrollExportStatus @default(pending)
  requestedById     String
  rowCount          Int?
  totalHours        Float?
  fileKey           String?
  failureReason     String?
  createdAt         DateTime            @default(now())
  completedAt       DateTime?
  Campground        Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User              User                @relation(fields: [requestedById], references: [id], onDelete: Cascade)
  PayrollExportLine PayrollExportLine[]

  @@index([campgroundId, periodStart, periodEnd])
  @@index([provider, status])
}

model PayrollExportLine {
  id             String          @id
  exportId       String
  userId         String
  shiftId        String?
  timeEntryId    String?
  hours          Float
  earningCode    String?
  rate           Decimal?        @db.Decimal(10, 2)
  roleCode       String?
  notes          String?
  createdAt      DateTime        @default(now())
  PayrollExport  PayrollExport   @relation(fields: [exportId], references: [id], onDelete: Cascade)
  StaffShift     StaffShift?     @relation(fields: [shiftId], references: [id])
  StaffTimeEntry StaffTimeEntry? @relation(fields: [timeEntryId], references: [id])
  User           User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([exportId])
  @@index([userId])
}

model PermissionRule {
  id           String           @id
  campgroundId String?
  role         UserRole
  resource     String
  action       String
  fields       String[]
  effect       PermissionEffect @default(allow)
  createdById  String?
  createdAt    DateTime         @default(now())
  Campground   Campground?      @relation(fields: [campgroundId], references: [id])
  User         User?            @relation(fields: [createdById], references: [id])

  @@unique([campgroundId, role, resource, action])
  @@index([resource, action])
}

model PiiFieldTag {
  id             String            @id
  resource       String
  field          String
  classification PiiClassification
  redactionMode  RedactionMode     @default(mask)
  createdById    String?
  createdAt      DateTime          @default(now())
  User           User?             @relation(fields: [createdById], references: [id])

  @@unique([resource, field])
  @@index([classification])
  @@index([createdById])
}

model PlatformAuditLog {
  id         String      @id
  createdAt  DateTime    @default(now())
  userId     String?
  userEmail  String?
  action     AuditAction
  resource   String
  resourceId String?
  details    String?
  metadata   Json?
  ipAddress  String?
  userAgent  String?

  @@index([action])
  @@index([createdAt])
  @@index([resource])
  @@index([userId])
}

model PlatformGoal {
  id           String       @id
  name         String
  description  String?
  metric       String
  target       Float
  current      Float        @default(0)
  unit         GoalUnit
  period       String
  category     GoalCategory
  status       GoalStatus   @default(on_track)
  dueDate      DateTime
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  createdBy    String?
  campgroundId String?
  Campground   Campground?  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([category])
  @@index([dueDate])
  @@index([status])
}

model PointsTransaction {
  id             String         @id
  profileId      String
  amount         Int
  reason         String
  createdAt      DateTime       @default(now())
  LoyaltyProfile LoyaltyProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model PortfolioDashboard {
  id           String       @id
  orgId        String
  name         String
  layout       Json
  isDefault    Boolean      @default(false)
  createdById  String
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  User         User         @relation(fields: [createdById], references: [id], onDelete: Cascade)
  Organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@index([orgId])
}

model PortfolioMetric {
  id            String       @id
  orgId         String
  campgroundId  String?
  metricDate    DateTime     @db.Date
  metricType    String
  value         Float
  previousValue Float?
  changePercent Float?
  createdAt     DateTime     @default(now())
  Campground    Campground?  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Organization  Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@unique([orgId, campgroundId, metricDate, metricType])
  @@index([orgId, metricDate])
}

model PosCart {
  id               String             @id
  campgroundId     String
  terminalId       String?
  status           PosCartStatus      @default(open)
  needsReview      Boolean            @default(false)
  netCents         Int                @default(0)
  taxCents         Int                @default(0)
  feeCents         Int                @default(0)
  grossCents       Int                @default(0)
  currency         String
  taxVersion       String?
  priceVersion     String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  Campground       Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  PosTerminal      PosTerminal?       @relation(fields: [terminalId], references: [id])
  PosCartItem      PosCartItem[]
  PosOfflineReplay PosOfflineReplay[]
  PosPayment       PosPayment[]
  PosReturn        PosReturn[]
  TillMovement     TillMovement[]

  @@index([campgroundId, status])
  @@index([terminalId])
}

model PosCartItem {
  id                    String  @id
  cartId                String
  productId             String
  qty                   Int
  unitPriceCents        Int
  discountCents         Int     @default(0)
  taxCents              Int     @default(0)
  feeCents              Int     @default(0)
  totalCents            Int
  metadata              Json?
  markdownApplied       Boolean @default(false)
  markdownRuleId        String?
  originalPriceCents    Int?
  markdownDiscountCents Int?
  batchId               String?
  PosCart               PosCart @relation(fields: [cartId], references: [id], onDelete: Cascade)
  Product               Product @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([cartId])
  @@index([productId])
}

model PosOfflineReplay {
  id                 String      @id
  clientTxId         String?
  cartId             String?
  campgroundId       String?
  recordedTotalsHash String?
  expectedHash       String?
  payloadHash        String?
  status             String?
  reason             String?
  payload            Json?
  tender             Json?
  items              Json?
  expectedBreakdown  Json?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime
  Campground         Campground? @relation(fields: [campgroundId], references: [id])
  PosCart            PosCart?    @relation(fields: [cartId], references: [id])

  @@index([campgroundId])
  @@index([cartId])
  @@index([clientTxId])
}

model PosPayment {
  id             String           @id
  cartId         String
  method         PosPaymentMethod
  amountCents    Int
  currency       String
  status         PosPaymentStatus @default(pending)
  idempotencyKey String
  referenceType  String?
  referenceId    String?
  processorIds   Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  PosCart        PosCart          @relation(fields: [cartId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([idempotencyKey])
}

model PosProviderIntegration {
  id              String                  @id
  campgroundId    String
  provider        PosProviderType
  displayName     String?
  status          PosIntegrationStatus    @default(enabled)
  capabilities    PosProviderCapability[]
  credentials     Json
  locations       Json?
  devices         Json?
  webhookSecret   String?
  lastValidatedAt DateTime?
  lastSyncAt      DateTime?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime
  Campground      Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  PosProviderSync PosProviderSync[]

  @@unique([campgroundId, provider])
  @@index([campgroundId, status])
}

model PosProviderSync {
  id                     String                 @id
  integrationId          String
  type                   PosSyncTarget
  status                 PosSyncStatus          @default(idle)
  lastRunAt              DateTime?
  lastError              String?
  metadata               Json?
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  PosProviderIntegration PosProviderIntegration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@unique([integrationId, type])
  @@index([integrationId, type])
}

model PosReturn {
  id             String          @id
  originalCartId String
  status         PosReturnStatus @default(pending)
  reasonCode     String?
  restock        Boolean         @default(false)
  netCents       Int             @default(0)
  taxCents       Int             @default(0)
  feeCents       Int             @default(0)
  grossCents     Int             @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  PosCart        PosCart         @relation(fields: [originalCartId], references: [id], onDelete: Cascade)

  @@index([originalCartId])
}

model PosTerminal {
  id             String         @id
  campgroundId   String
  locationId     String?
  offlineCapable Boolean        @default(false)
  taxVersion     String?
  priceVersion   String?
  createdAt      DateTime       @default(now())
  PosCart        PosCart[]
  Campground     Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StoreLocation  StoreLocation? @relation(fields: [locationId], references: [id])
  TillSession    TillSession[]

  @@index([campgroundId])
  @@index([locationId])
}

model PricingRule {
  id            String     @id
  campgroundId  String
  siteClassId   String?
  label         String?
  ruleType      String
  startDate     DateTime?
  endDate       DateTime?
  dayOfWeek     Int?
  percentAdjust Decimal?   @db.Decimal(6, 4)
  flatAdjust    Int?
  minNights     Int?
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @default(now())
  Campground    Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass     SiteClass? @relation(fields: [siteClassId], references: [id])

  @@index([campgroundId])
  @@index([siteClassId])
}

model PricingRuleV2 {
  id              String           @id
  campgroundId    String
  siteClassId     String?
  name            String
  type            PricingRuleType
  priority        Int
  stackMode       PricingStackMode
  adjustmentType  AdjustmentType
  adjustmentValue Decimal          @db.Decimal(8, 4)
  startDate       DateTime?
  endDate         DateTime?
  dowMask         Int[]
  calendarRefId   String?
  demandBandId    String?
  minRateCap      Int?
  maxRateCap      Int?
  active          Boolean          @default(true)
  createdBy       String?
  updatedBy       String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  Campground      Campground       @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass       SiteClass?       @relation(fields: [siteClassId], references: [id])
}

model PrivacySetting {
  id                  String     @id
  campgroundId        String     @unique
  redactPII           Boolean    @default(true)
  consentRequired     Boolean    @default(true)
  backupRetentionDays Int        @default(30)
  keyRotationDays     Int        @default(90)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  Campground          Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
}

model Product {
  id                      String                    @id
  campgroundId            String
  categoryId              String?
  name                    String
  description             String?
  priceCents              Int
  imageUrl                String?
  sku                     String?
  stockQty                Int                       @default(0)
  onlineStockQty          Int?
  posStockQty             Int?
  channelInventoryMode    ChannelInventoryMode      @default(shared)
  inventoryMode           ProductInventoryMode      @default(shared)
  availableLocations      String[]                  @default([])
  lowStockAlert           Int?
  trackInventory          Boolean                   @default(true)
  afterHoursAllowed       Boolean                   @default(false)
  isActive                Boolean                   @default(true)
  sortOrder               Int                       @default(0)
  glCode                  String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @default(now())
  useBatchTracking        Boolean                   @default(false)
  lastSaleDate            DateTime?
  InventoryBatch          InventoryBatch[]
  InventoryMovement       InventoryMovement[]
  InventoryTransferItem   InventoryTransferItem[]
  LocationInventory       LocationInventory[]
  LocationPriceOverride   LocationPriceOverride[]
  MarkdownRule            MarkdownRule[]
  PosCartItem             PosCartItem[]
  Campground              Campground                @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  ProductCategory         ProductCategory?          @relation(fields: [categoryId], references: [id])
  ProductExpirationConfig ProductExpirationConfig[]
  ProductExternalMapping  ProductExternalMapping[]
  StoreOrderItem          StoreOrderItem[]

  @@index([campgroundId])
  @@index([categoryId])
}

model ProductCategory {
  id                       String                     @id
  campgroundId             String
  name                     String
  description              String?
  sortOrder                Int                        @default(0)
  isActive                 Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now())
  defaultWarningDays       Int                        @default(7)
  defaultCriticalDays      Int                        @default(2)
  defaultSlowMovingDays    Int                        @default(30)
  CategoryExpirationConfig CategoryExpirationConfig[]
  MarkdownRule             MarkdownRule[]
  Product                  Product[]
  Campground               Campground                 @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, name])
  @@index([campgroundId])
}

model ProductExpirationConfig {
  id             String     @id
  campgroundId   String
  productId      String
  warningDays    Int?
  criticalDays   Int?
  slowMovingDays Int?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @default(now())
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Product        Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, productId])
  @@index([campgroundId])
}

model ProductExternalMapping {
  id           String          @id
  campgroundId String
  productId    String
  provider     PosProviderType
  externalId   String
  externalSku  String?
  lastSyncedAt DateTime?
  syncStatus   String?
  syncError    String?
  metadata     Json?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime
  Campground   Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Product      Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, provider, externalId])
  @@unique([campgroundId, provider, productId])
  @@index([campgroundId, provider])
  @@index([productId])
}

model Promotion {
  id             String           @id
  campgroundId   String
  code           String
  type           PromotionType    @default(percentage)
  value          Int
  validFrom      DateTime?
  validTo        DateTime?
  usageLimit     Int?
  usageCount     Int              @default(0)
  isActive       Boolean          @default(true)
  description    String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now())
  AnalyticsEvent AnalyticsEvent[]
  Campground     Campground       @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, code])
  @@index([campgroundId])
  @@index([code])
}

model PublicLead {
  id             String     @id
  campgroundId   String
  email          String
  source         String
  ipAddress      String?
  userAgent      String?
  marketingOptIn Boolean    @default(true)
  convertedAt    DateTime?
  guestId        String?
  createdAt      DateTime   @default(now())
  Campground     Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, email, source])
  @@index([campgroundId])
  @@index([email])
  @@index([source])
}

model PushNotification {
  id           String               @id
  campgroundId String
  userId       String?
  type         PushNotificationType
  title        String
  body         String
  data         Json?
  sentAt       DateTime?
  readAt       DateTime?
  clickedAt    DateTime?
  createdAt    DateTime             @default(now())
  Campground   Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User?                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId, userId, createdAt])
}

model PushSubscription {
  id             String      @id
  userId         String?
  campgroundId   String?
  endpoint       String      @unique
  keys           Json?
  subscription   Json?
  expirationTime DateTime?
  userAgent      String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime
  Campground     Campground? @relation(fields: [campgroundId], references: [id])
  User           User?       @relation(fields: [userId], references: [id])

  @@index([campgroundId])
  @@index([userId])
}

model QRCode {
  id            String       @id
  campgroundId  String
  reservationId String?
  siteId        String?
  type          String
  code          String       @unique
  expiresAt     DateTime?
  usedAt        DateTime?
  scanCount     Int          @default(0)
  lastScannedAt DateTime?
  metadata      Json?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  Campground    Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Reservation   Reservation? @relation(fields: [reservationId], references: [id])
  Site          Site?        @relation(fields: [siteId], references: [id])

  @@index([campgroundId])
  @@index([expiresAt])
  @@index([reservationId])
  @@index([siteId])
  @@index([type])
}

model RateParityAlert {
  id              String                @id
  campgroundId    String
  siteType        String
  directRateCents Int
  otaRateCents    Int
  otaSource       String
  difference      Int
  status          RateParityAlertStatus @default(active)
  acknowledgedBy  String?
  acknowledgedAt  DateTime?
  resolvedAt      DateTime?
  createdAt       DateTime              @default(now())
  Campground      Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, status])
  @@index([createdAt])
}

model ReferralProgram {
  id             String                @id
  campgroundId   String
  code           String
  linkSlug       String?
  source         String?
  channel        String?
  incentiveType  ReferralIncentiveType @default(percent_discount)
  incentiveValue Int                   @default(0)
  isActive       Boolean               @default(true)
  notes          String?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @default(now())
  Campground     Campground            @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Reservation    Reservation[]

  @@unique([campgroundId, code])
  @@unique([campgroundId, linkSlug])
  @@index([campgroundId, isActive])
}

model RepeatCharge {
  id            String       @id
  reservationId String
  amount        Int
  dueDate       DateTime
  status        ChargeStatus @default(pending)
  paidAt        DateTime?
  failedAt      DateTime?
  failureReason String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @default(now())
  Reservation   Reservation  @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([reservationId])
  @@index([reservationId, status])
  @@index([status, dueDate])
  @@index([status])
}

model ReportRun {
  id          String      @id
  reportId    String
  status      String
  startedAt   DateTime?
  completedAt DateTime?
  rowCount    Int?
  fileUrl     String?
  error       String?
  triggeredBy String?
  createdAt   DateTime    @default(now())
  SavedReport SavedReport @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId, createdAt])
}

model ReportSubscription {
  id           String          @id
  createdAt    DateTime        @default(now())
  updatedAt    DateTime
  userId       String
  userEmail    String
  campgroundId String?
  reportType   ReportType
  frequency    ReportFrequency
  enabled      Boolean         @default(true)
  lastSentAt   DateTime?
  nextSendAt   DateTime?
  deliveryTime String          @default("08:00")
  dayOfWeek    Int?
  dayOfMonth   Int?

  @@unique([userId, campgroundId, reportType])
  @@index([campgroundId])
  @@index([enabled, nextSendAt])
  @@index([userId])
}

model Reservation {
  id                       String                     @id
  campgroundId             String
  siteId                   String
  siteLocked               Boolean                    @default(false)
  guestId                  String
  arrivalDate              DateTime
  departureDate            DateTime
  adults                   Int
  children                 Int                        @default(0)
  petCount                 Int?                       @default(0)
  petTypes                 Json?
  status                   ReservationStatus          @default(pending)
  totalAmount              Int                        @default(0)
  paidAmount               Int                        @default(0)
  balanceAmount            Int                        @default(0)
  depositAmount            Int                        @default(0)
  depositDueDate           DateTime?
  pricingRuleVersion       String?
  depositPolicyVersion     String?
  nextAutoCollectAttemptAt DateTime?
  paymentStatus            String                     @default("unpaid")
  baseSubtotal             Int                        @default(0)
  feesAmount               Int                        @default(0)
  taxesAmount              Int                        @default(0)
  discountsAmount          Int                        @default(0)
  promoCode                String?
  source                   String?
  policyVersion            String?
  checkInWindowStart       String?
  checkInWindowEnd         String?
  vehiclePlate             String?
  vehicleState             String?
  rigType                  String?
  rigLength                Int?
  stayReasonPreset         StayReasonPreset?
  stayReasonOther          String?
  referralProgramId        String?
  referralCode             String?
  referralSource           String?
  referralChannel          String?
  referralIncentiveType    ReferralIncentiveType?
  referralIncentiveValue   Int?                       @default(0)
  createdBy                String?
  updatedBy                String?
  checkInAt                DateTime?
  checkOutAt               DateTime?
  notes                    String?
  stayType                 StayType                   @default(standard)
  taxExempt                Boolean                    @default(false)
  taxWaiverSigned          Boolean                    @default(false)
  taxWaiverDate            DateTime?
  seasonalRateId           String?
  billingCadence           String                     @default("monthly")
  billingAnchorDate        DateTime?
  utilityMeterIds          Json?
  leadTimeDays             Int?
  bookedAt                 DateTime?
  additionalGuests         Json?
  childrenDetails          Json?
  groupId                  String?
  groupRole                GroupRole?
  checkInStatus            CheckInStatus              @default(not_started)
  checkOutStatus           CheckOutStatus             @default(not_started)
  idVerificationRequired   Boolean                    @default(false)
  waiverRequired           Boolean                    @default(false)
  paymentRequired          Boolean                    @default(true)
  lateArrivalFlag          Boolean                    @default(false)
  siteReady                Boolean                    @default(false)
  siteReadyAt              DateTime?
  selfCheckInAt            DateTime?
  selfCheckOutAt           DateTime?
  earlyCheckInRequested    DateTime?
  earlyCheckInApproved     Boolean?
  earlyCheckInCharge       Int?
  lateCheckoutRequested    DateTime?
  lateCheckoutApproved     Boolean?
  lateCheckoutCharge       Int?
  groupBookingId           String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now())
  deletedAt                DateTime?
  deletedBy                String?
  seasonalGuestId          String?
  AccessCredential         AccessCredential[]
  AccessGrant              AccessGrant[]
  ActivityBooking          ActivityBooking[]
  AiNoShowRisk             AiNoShowRisk?
  AnalyticsEvent           AnalyticsEvent[]
  BillingCycle             BillingCycle[]
  CertificateOfInsurance   CertificateOfInsurance[]
  CharityDonation          CharityDonation?
  CoiUpload                CoiUpload[]
  Communication            Communication[]
  CommunicationPlaybookJob CommunicationPlaybookJob[]
  DigitalWaiver            DigitalWaiver[]
  Dispute                  Dispute[]
  FormSubmission           FormSubmission[]
  IdVerification           IdVerification[]
  Incident                 Incident[]
  Invoice                  Invoice[]
  LedgerEntry              LedgerEntry[]
  Message                  Message[]
  NpsInvite                NpsInvite[]
  NpsResponse              NpsResponse[]
  OpTask                   OpTask[]
  OtaReservationImport     OtaReservationImport[]
  Payment                  Payment[]
  PayoutLine               PayoutLine[]
  QRCode                   QRCode[]
  RepeatCharge             RepeatCharge[]
  Campground               Campground                 @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  GroupBooking             GroupBooking?              @relation(fields: [groupBookingId], references: [id])
  Guest                    Guest                      @relation(fields: [guestId], references: [id], onDelete: Cascade)
  ReferralProgram          ReferralProgram?           @relation(fields: [referralProgramId], references: [id])
  SeasonalGuest            SeasonalGuest?             @relation(fields: [seasonalGuestId], references: [id])
  SeasonalRate             SeasonalRate?              @relation(fields: [seasonalRateId], references: [id])
  Site                     Site                       @relation(fields: [siteId], references: [id], onDelete: Cascade)
  ReservationSegment       ReservationSegment[]
  ReservationUpsell        ReservationUpsell[]
  Review                   Review[]
  ReviewRequest            ReviewRequest[]
  RoomMoveRequest          RoomMoveRequest[]
  SignatureArtifact        SignatureArtifact[]
  SignatureRequest         SignatureRequest[]
  StoreOrder               StoreOrder[]
  Vehicle                  Vehicle?

  @@index([campgroundId, arrivalDate, departureDate])
  @@index([campgroundId, guestId, status])
  @@index([campgroundId])
  @@index([campgroundId, status, arrivalDate, departureDate])
  @@index([campgroundId, status, arrivalDate])
  @@index([campgroundId, status])
  @@index([deletedAt])
  @@index([groupBookingId])
  @@index([groupId])
  @@index([guestId])
  @@index([referralCode])
  @@index([referralProgramId])
  @@index([seasonalGuestId])
  @@index([seasonalRateId])
  @@index([siteId, arrivalDate, departureDate])
  @@index([siteId])
  @@index([status, arrivalDate])
}

model ReservationSegment {
  id            String      @id
  reservationId String
  siteId        String
  startDate     DateTime
  endDate       DateTime
  subtotalCents Int         @default(0)
  sortOrder     Int         @default(0)
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @default(now())
  Reservation   Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  Site          Site        @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([reservationId])
  @@index([siteId])
  @@index([startDate])
}

model ReservationUpsell {
  id              String           @id
  reservationId   String
  itemId          String?
  bundleId        String?
  quantity        Int              @default(1)
  priceSnapshot   Json
  taxCodeSnapshot String?
  chargeType      UpsellChargeType
  status          UpsellStatus     @default(pending_charge)
  attemptNo       Int              @default(0)
  idempotencyKey  String?
  createdBy       String?
  updatedBy       String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  UpsellBundle    UpsellBundle?    @relation(fields: [bundleId], references: [id])
  UpsellItem      UpsellItem?      @relation(fields: [itemId], references: [id])
  Reservation     Reservation      @relation(fields: [reservationId], references: [id], onDelete: Cascade)
}

model RevenueForecast {
  id           String     @id
  campgroundId String
  forecastDate DateTime   @db.Date
  projectedRev Int
  actualRev    Int?
  occupancyPct Float
  confidence   Float?
  factors      Json?
  createdAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id])

  @@unique([campgroundId, forecastDate])
  @@index([campgroundId, forecastDate])
}

model Review {
  id               String            @id
  campgroundId     String
  organizationId   String?
  guestId          String?
  reservationId    String?
  requestId        String?           @unique
  rating           Int
  title            String?
  body             String?
  photos           String[]          @default([])
  tags             String[]          @default([])
  sentiment        String?
  source           ReviewSource      @default(onsite)
  status           ReviewStatus      @default(pending)
  exposure         ReviewExposure    @default(private)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  Campground       Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest            Guest?            @relation(fields: [guestId], references: [id])
  ReviewRequest    ReviewRequest?    @relation(fields: [requestId], references: [id])
  Reservation      Reservation?      @relation(fields: [reservationId], references: [id])
  ReviewModeration ReviewModeration?
  ReviewReply      ReviewReply[]
  ReviewVote       ReviewVote[]

  @@index([campgroundId, status, createdAt])
  @@index([guestId])
  @@index([reservationId])
  @@index([source])
}

model ReviewModeration {
  id        String                 @id
  reviewId  String                 @unique
  status    ReviewModerationStatus @default(pending)
  reasons   String[]               @default([])
  decidedBy String?
  decidedAt DateTime?
  notes     String?
  Review    Review                 @relation(fields: [reviewId], references: [id], onDelete: Cascade)
}

model ReviewReply {
  id         String   @id
  reviewId   String
  authorType String
  authorId   String?
  body       String
  createdAt  DateTime @default(now())
  Review     Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@index([reviewId])
}

model ReviewRequest {
  id             String       @id
  campgroundId   String
  organizationId String?
  guestId        String?
  reservationId  String?
  channel        String
  status         String       @default("queued")
  token          String       @unique
  expiresAt      DateTime?
  sentAt         DateTime?
  respondedAt    DateTime?
  metadata       Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now())
  Review         Review?
  Campground     Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest          Guest?       @relation(fields: [guestId], references: [id])
  Reservation    Reservation? @relation(fields: [reservationId], references: [id])

  @@index([campgroundId, status])
  @@index([guestId])
  @@index([reservationId])
}

model ReviewVote {
  id           String          @id
  reviewId     String
  guestId      String?
  ipHash       String?
  value        ReviewVoteValue
  createdAt    DateTime        @default(now())
  campgroundId String
  Campground   Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest        Guest?          @relation(fields: [guestId], references: [id])
  Review       Review          @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId, guestId])
  @@index([campgroundId])
  @@index([ipHash])
  @@index([reviewId])
}

model RoomMoveRequest {
  id                                       String      @id
  campgroundId                             String
  reservationId                            String
  fromSiteId                               String
  toSiteId                                 String
  moveDate                                 DateTime
  moveReason                               String
  isComplimentary                          Boolean     @default(false)
  priceDifference                          Int?
  status                                   String      @default("requested")
  luggageAssistance                        Boolean     @default(false)
  newKeysIssued                            Boolean     @default(false)
  requestedById                            String
  approvedById                             String?
  completedById                            String?
  completedAt                              DateTime?
  notes                                    String?
  createdAt                                DateTime    @default(now())
  updatedAt                                DateTime
  User_RoomMoveRequest_approvedByIdToUser  User?       @relation("RoomMoveRequest_approvedByIdToUser", fields: [approvedById], references: [id])
  Campground                               Campground  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_RoomMoveRequest_completedByIdToUser User?       @relation("RoomMoveRequest_completedByIdToUser", fields: [completedById], references: [id])
  Site_RoomMoveRequest_fromSiteIdToSite    Site        @relation("RoomMoveRequest_fromSiteIdToSite", fields: [fromSiteId], references: [id])
  User_RoomMoveRequest_requestedByIdToUser User        @relation("RoomMoveRequest_requestedByIdToUser", fields: [requestedById], references: [id])
  Reservation                              Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  Site_RoomMoveRequest_toSiteIdToSite      Site        @relation("RoomMoveRequest_toSiteIdToSite", fields: [toSiteId], references: [id])

  @@index([campgroundId])
  @@index([reservationId])
  @@index([status])
}

model SavedReport {
  id           String                   @id
  campgroundId String?
  orgId        String?
  createdById  String
  name         String
  description  String?
  reportType   String
  config       Json
  isPublic     Boolean                  @default(false)
  scheduleFreq ReportScheduleFrequency?
  scheduleDay  Int?
  scheduleTime String?
  recipients   String[]
  lastRunAt    DateTime?
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime
  ReportRun    ReportRun[]
  Campground   Campground?              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User                     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([createdById])
}

model ScheduleTemplate {
  id                  String     @id
  campgroundId        String
  name                String
  description         String?
  shifts              Json
  createdById         String
  isActive            Boolean    @default(true)
  isRecurring         Boolean    @default(false)
  recurringDay        Int?
  recurringWeeksAhead Int?       @default(1)
  lastAppliedAt       DateTime?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  Campground          Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User                User       @relation(fields: [createdById], references: [id])

  @@index([campgroundId, isActive])
  @@index([isRecurring, recurringDay])
}

model ScheduledNotification {
  id                  String              @id
  campgroundId        String
  triggerId           String
  event               String
  channel             String
  payload             Json
  sendAt              DateTime
  status              String              @default("pending")
  sentAt              DateTime?
  error               String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  Campground          Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  NotificationTrigger NotificationTrigger @relation(fields: [triggerId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([status, sendAt])
}

model SeasonalCommunication {
  id              String        @id
  seasonalGuestId String
  campgroundId    String
  channel         String
  direction       String
  subject         String?
  body            String
  status          String
  sentAt          DateTime?
  deliveredAt     DateTime?
  openedAt        DateTime?
  clickedAt       DateTime?
  bouncedAt       DateTime?
  failReason      String?
  campaignId      String?
  campaignName    String?
  sentBy          String?
  createdAt       DateTime      @default(now())
  Campground      Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SeasonalGuest   SeasonalGuest @relation(fields: [seasonalGuestId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([campgroundId, createdAt])
  @@index([seasonalGuestId, createdAt])
}

model SeasonalDiscount {
  id               String                    @id
  rateCardId       String
  name             String
  description      String?
  conditionType    SeasonalDiscountCondition
  conditionValue   String?
  discountType     SeasonalDiscountType
  discountAmount   Decimal                   @db.Decimal(10, 2)
  stackable        Boolean                   @default(true)
  priority         Int                       @default(0)
  isActive         Boolean                   @default(true)
  createdAt        DateTime                  @default(now())
  updatedAt        DateTime
  SeasonalRateCard SeasonalRateCard          @relation(fields: [rateCardId], references: [id], onDelete: Cascade)

  @@index([rateCardId, isActive])
}

model SeasonalGuest {
  id                     String                  @id
  campgroundId           String
  guestId                String
  firstSeasonYear        Int
  totalSeasons           Int                     @default(1)
  seniorityRank          Int?
  currentSiteId          String?
  preferredSites         String[]                @default([])
  status                 SeasonalStatus          @default(active)
  renewalIntent          RenewalIntent?
  renewalIntentAt        DateTime?
  renewalNotes           String?
  preferredPaymentMethod SeasonalPaymentMethod?
  paysInFull             Boolean                 @default(false)
  autoPayEnabled         Boolean                 @default(false)
  paymentDay             Int                     @default(1)
  isMetered              Boolean                 @default(false)
  meteredElectric        Boolean                 @default(false)
  meteredWater           Boolean                 @default(false)
  coiExpiresAt           DateTime?
  coiDocumentUrl         String?
  vehiclePlates          String[]                @default([])
  petCount               Int                     @default(0)
  petNotes               String?
  emergencyContact       String?
  emergencyPhone         String?
  guestPassBalance       Decimal                 @default(0) @db.Decimal(10, 2)
  storeCreditBalance     Decimal                 @default(0) @db.Decimal(10, 2)
  notes                  String?
  tags                   String[]                @default([])
  originReservationId    String?
  convertedAt            DateTime?
  convertedBy            String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  createdBy              String?
  Reservation            Reservation[]
  SeasonalCommunication  SeasonalCommunication[]
  Campground             Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site                   Site?                   @relation(fields: [currentSiteId], references: [id])
  Guest                  Guest                   @relation(fields: [guestId], references: [id], onDelete: Cascade)
  SeasonalGuestPricing   SeasonalGuestPricing[]
  SeasonalPayment        SeasonalPayment[]

  @@unique([guestId, campgroundId])
  @@index([campgroundId, currentSiteId])
  @@index([campgroundId, renewalIntent])
  @@index([campgroundId, status])
}

model SeasonalGuestPricing {
  id               String                   @id
  seasonalGuestId  String
  rateCardId       String
  seasonYear       Int
  baseRate         Decimal                  @db.Decimal(10, 2)
  totalDiscount    Decimal                  @default(0) @db.Decimal(10, 2)
  finalRate        Decimal                  @db.Decimal(10, 2)
  appliedDiscounts Json                     @default("[]")
  earnedIncentives Json                     @default("[]")
  paymentSchedule  Json                     @default("[]")
  billingFrequency SeasonalBillingFrequency
  manualAdjustment Decimal?                 @db.Decimal(10, 2)
  adjustmentReason String?
  adjustmentBy     String?
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime
  SeasonalRateCard SeasonalRateCard         @relation(fields: [rateCardId], references: [id])
  SeasonalGuest    SeasonalGuest            @relation(fields: [seasonalGuestId], references: [id], onDelete: Cascade)

  @@unique([seasonalGuestId, seasonYear])
  @@index([rateCardId])
  @@index([seasonalGuestId])
}

model SeasonalIncentive {
  id               String                    @id
  rateCardId       String
  name             String
  description      String?
  conditionType    SeasonalDiscountCondition
  conditionValue   String?
  incentiveType    SeasonalIncentiveType
  incentiveValue   Decimal                   @db.Decimal(10, 2)
  incentiveDetails String?
  isActive         Boolean                   @default(true)
  createdAt        DateTime                  @default(now())
  updatedAt        DateTime
  SeasonalRateCard SeasonalRateCard          @relation(fields: [rateCardId], references: [id], onDelete: Cascade)

  @@index([rateCardId, isActive])
}

model SeasonalPayment {
  id              String                 @id
  seasonalGuestId String
  campgroundId    String
  seasonYear      Int
  periodStart     DateTime
  periodEnd       DateTime
  description     String?
  amount          Decimal                @db.Decimal(10, 2)
  dueDate         DateTime
  status          SeasonalPaymentStatus  @default(scheduled)
  paidAmount      Decimal?               @db.Decimal(10, 2)
  paidAt          DateTime?
  paymentMethod   SeasonalPaymentMethod?
  transactionId   String?
  checkNumber     String?
  receiptUrl      String?
  lateFee         Decimal?               @db.Decimal(10, 2)
  lateFeeWaived   Boolean                @default(false)
  lateFeeWaivedBy String?
  lateFeeWaivedAt DateTime?
  notes           String?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime
  recordedBy      String?
  Campground      Campground             @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SeasonalGuest   SeasonalGuest          @relation(fields: [seasonalGuestId], references: [id], onDelete: Cascade)

  @@index([campgroundId, dueDate])
  @@index([campgroundId, status])
  @@index([seasonalGuestId, seasonYear])
}

model SeasonalRate {
  id                String           @id
  campgroundId      String
  siteClassId       String?
  name              String
  rateType          RateType
  amount            Int
  minNights         Int?
  startDate         DateTime?
  endDate           DateTime?
  isActive          Boolean          @default(true)
  paymentSchedule   PaymentSchedule  @default(single)
  pricingStructure  PricingStructure @default(per_night)
  offseasonInterval Int?
  offseasonAmount   Int?
  prorateExcess     Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @default(now())
  Reservation       Reservation[]
  Campground        Campground       @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass         SiteClass?       @relation(fields: [siteClassId], references: [id])

  @@index([campgroundId])
  @@index([siteClassId])
}

model SeasonalRateCard {
  id                   String                   @id
  campgroundId         String
  name                 String
  seasonYear           Int
  baseRate             Decimal                  @db.Decimal(10, 2)
  billingFrequency     SeasonalBillingFrequency @default(monthly)
  description          String?
  includedUtilities    String[]                 @default([])
  seasonStartDate      DateTime
  seasonEndDate        DateTime
  validFrom            DateTime                 @default(now())
  validUntil           DateTime?
  isActive             Boolean                  @default(true)
  isDefault            Boolean                  @default(false)
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime
  SeasonalDiscount     SeasonalDiscount[]
  SeasonalGuestPricing SeasonalGuestPricing[]
  SeasonalIncentive    SeasonalIncentive[]
  Campground           Campground               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, name, seasonYear])
  @@index([campgroundId, isActive])
  @@index([campgroundId, seasonYear])
}

model SeoLocation {
  id                 String               @id
  type               SeoLocationType
  name               String
  slug               String               @unique
  state              String?
  country            String               @default("USA")
  latitude           Decimal?             @db.Decimal(12, 8)
  longitude          Decimal?             @db.Decimal(12, 8)
  boundingBox        Json?
  parentId           String?
  metaTitle          String?
  metaDescription    String?
  heroImageUrl       String?
  description        String?
  highlights         String[]             @default([])
  bestTimeToVisit    String?
  campgroundCount    Int                  @default(0)
  avgRating          Decimal?             @db.Decimal(3, 2)
  popularAmenities   String[]             @default([])
  priceRangeLow      Int?
  priceRangeHigh     Int?
  statsUpdatedAt     DateTime?
  isPublished        Boolean              @default(false)
  publishedAt        DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  CampgroundLocation CampgroundLocation[]
  SeoLocation        SeoLocation?         @relation("SeoLocationToSeoLocation", fields: [parentId], references: [id])
  other_SeoLocation  SeoLocation[]        @relation("SeoLocationToSeoLocation")

  @@index([isPublished])
  @@index([parentId])
  @@index([state])
  @@index([type])
}

model SetupService {
  id                       String             @id
  organizationId           String
  serviceType              SetupServiceType
  status                   SetupServiceStatus @default(pending)
  totalCents               Int
  paidUpfrontCents         Int                @default(0)
  balanceRemainingCents    Int                @default(0)
  perBookingSurchargeCents Int                @default(100)
  reservationCount         Int?
  importFileUrl            String?
  importNotes              String?
  stripePaymentIntentId    String?
  stripeInvoiceId          String?
  purchasedAt              DateTime           @default(now())
  startedAt                DateTime?
  completedAt              DateTime?
  completedBy              String?
  bookingsCharged          Int                @default(0)
  lastChargedAt            DateTime?
  paidOffAt                DateTime?
  notes                    String?
  metadata                 Json?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime
  Organization             Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([balanceRemainingCents])
  @@index([organizationId])
  @@index([status])
}

model ShiftApproval {
  id         String              @id
  shiftId    String
  approverId String
  status     ShiftApprovalStatus @default(pending)
  note       String?
  approvedAt DateTime?
  createdAt  DateTime            @default(now())
  updatedAt  DateTime
  User       User                @relation(fields: [approverId], references: [id])
  StaffShift StaffShift          @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@index([approverId])
  @@index([shiftId, status])
}

model ShiftSwapRequest {
  id                                          String     @id
  campgroundId                                String
  requesterShiftId                            String
  requesterId                                 String
  recipientUserId                             String
  status                                      SwapStatus @default(pending_recipient)
  requesterNote                               String?
  recipientNote                               String?
  managerId                                   String?
  managerNote                                 String?
  recipientRespondedAt                        DateTime?
  managerRespondedAt                          DateTime?
  createdAt                                   DateTime   @default(now())
  updatedAt                                   DateTime
  Campground                                  Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_ShiftSwapRequest_managerIdToUser       User?      @relation("ShiftSwapRequest_managerIdToUser", fields: [managerId], references: [id])
  User_ShiftSwapRequest_recipientUserIdToUser User       @relation("ShiftSwapRequest_recipientUserIdToUser", fields: [recipientUserId], references: [id])
  User_ShiftSwapRequest_requesterIdToUser     User       @relation("ShiftSwapRequest_requesterIdToUser", fields: [requesterId], references: [id])
  StaffShift                                  StaffShift @relation(fields: [requesterShiftId], references: [id], onDelete: Cascade)

  @@index([campgroundId, status])
  @@index([recipientUserId])
  @@index([requesterId])
  @@index([requesterShiftId])
}

model SignatureArtifact {
  id               String           @id
  requestId        String           @unique
  campgroundId     String
  reservationId    String?
  guestId          String?
  pdfUrl           String
  storageKey       String?
  checksum         String?
  metadata         Json?
  completedAt      DateTime?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  Campground       Campground       @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest            Guest?           @relation(fields: [guestId], references: [id])
  SignatureRequest SignatureRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  Reservation      Reservation?     @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([guestId])
  @@index([reservationId])
}

model SignatureRequest {
  id                    String                   @id
  campgroundId          String
  reservationId         String?
  guestId               String?
  templateId            String?
  documentType          SignatureDocumentType
  status                SignatureRequestStatus   @default(draft)
  deliveryChannel       SignatureDeliveryChannel @default(email)
  token                 String                   @unique
  subject               String?
  message               String?
  recipientName         String?
  recipientEmail        String?
  recipientPhone        String?
  sentAt                DateTime?
  viewedAt              DateTime?
  signedAt              DateTime?
  declinedAt            DateTime?
  voidedAt              DateTime?
  expiresAt             DateTime?
  reminderAt            DateTime?
  reminderCount         Int                      @default(0)
  metadata              Json?
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime
  signatureMethod       SignatureMethod          @default(digital)
  paperSignedAt         DateTime?
  paperReceivedBy       String?
  paperArtifactUrl      String?
  signatureWaived       Boolean                  @default(false)
  waiverReason          WaiverReason?
  waiverNotes           String?
  waivedBy              String?
  waivedAt              DateTime?
  previewAvailableAt    DateTime?
  availableForSigningAt DateTime?
  renewsContractId      String?
  seasonYear            Int?
  SignatureArtifact     SignatureArtifact?
  Campground            Campground               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest                 Guest?                   @relation(fields: [guestId], references: [id])
  Reservation           Reservation?             @relation(fields: [reservationId], references: [id])
  DocumentTemplate      DocumentTemplate?        @relation(fields: [templateId], references: [id])

  @@index([campgroundId, seasonYear])
  @@index([campgroundId, status])
  @@index([expiresAt])
  @@index([guestId])
  @@index([renewsContractId])
  @@index([reservationId])
}

model Site {
  id                                               String               @id
  campgroundId                                     String
  siteClassId                                      String?
  name                                             String
  siteNumber                                       String
  siteType                                         SiteType
  maxOccupancy                                     Int
  rigMaxLength                                     Int?
  rigMaxWidth                                      Int?
  rigMaxHeight                                     Int?
  pullThrough                                      Boolean              @default(false)
  hookupsPower                                     Boolean              @default(false)
  powerAmps                                        Int[]                @default([])
  hookupsWater                                     Boolean              @default(false)
  hookupsSewer                                     Boolean              @default(false)
  petFriendly                                      Boolean              @default(true)
  accessible                                       Boolean              @default(false)
  minNights                                        Int?
  maxNights                                        Int?
  photos                                           String[]             @default([])
  photoAttributions                                Json?
  description                                      String?
  tags                                             String[]             @default([])
  amenityTags                                      String[]             @default([])
  vibeTags                                         String[]             @default([])
  popularityScore                                  Int                  @default(0)
  isActive                                         Boolean              @default(true)
  status                                           String?
  latitude                                         Decimal?             @db.Decimal(12, 8)
  longitude                                        Decimal?             @db.Decimal(12, 8)
  surfaceType                                      String?
  padSlopePercent                                  Int?
  mapLabel                                         String?
  cleaningMinutes                                  Int?
  zone                                             String?
  createdAt                                        DateTime             @default(now())
  updatedAt                                        DateTime             @default(now())
  housekeepingStatus                               String               @default("vacant_clean")
  AccessGrant                                      AccessGrant[]
  AnalyticsEvent                                   AnalyticsEvent[]
  BlackoutDate                                     BlackoutDate[]
  DocumentTemplate                                 DocumentTemplate[]
  MaintenanceTicket                                MaintenanceTicket[]
  OpTask                                           OpTask[]
  OperationalTask                                  OperationalTask[]
  OtaListingMapping                                OtaListingMapping[]
  QRCode                                           QRCode[]
  Reservation                                      Reservation[]
  ReservationSegment                               ReservationSegment[]
  RoomMoveRequest_RoomMoveRequest_fromSiteIdToSite RoomMoveRequest[]    @relation("RoomMoveRequest_fromSiteIdToSite")
  RoomMoveRequest_RoomMoveRequest_toSiteIdToSite   RoomMoveRequest[]    @relation("RoomMoveRequest_toSiteIdToSite")
  SeasonalGuest                                    SeasonalGuest[]
  Campground                                       Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass                                        SiteClass?           @relation(fields: [siteClassId], references: [id])
  SiteHold                                         SiteHold[]
  SiteMapAssignment                                SiteMapAssignment?
  SiteMapLayout                                    SiteMapLayout?
  SmartLock                                        SmartLock[]
  StructureAttributes                              StructureAttributes?
  UtilityMeter                                     UtilityMeter[]
  WaitlistEntry                                    WaitlistEntry[]

  @@unique([campgroundId, name])
  @@index([campgroundId])
  @@index([campgroundId, isActive])
  @@index([siteClassId])
  @@index([siteType])
}

model SiteClass {
  id                          String              @id
  campgroundId                String
  name                        String
  description                 String?
  defaultRate                 Int                 @default(0)
  siteType                    SiteType
  maxOccupancy                Int
  rigMaxLength                Int?
  hookupsPower                Boolean             @default(false)
  hookupsWater                Boolean             @default(false)
  hookupsSewer                Boolean             @default(false)
  rvOrientation               String?
  electricAmps                Int[]               @default([])
  meteredEnabled              Boolean             @default(false)
  meteredType                 String?
  meteredBillingMode          String?
  meteredBillTo               String?
  meteredMultiplier           Decimal?            @default(1.0)
  meteredRatePlanId           String?
  meteredAutoEmail            Boolean             @default(false)
  tags                        String[]            @default([])
  amenityTags                 String[]            @default([])
  glCode                      String?
  clientAccount               String?
  minNights                   Int?
  maxNights                   Int?
  sameDayBookingCutoffMinutes Int?
  petFriendly                 Boolean             @default(true)
  accessible                  Boolean             @default(false)
  photos                      String[]            @default([])
  photoAttributions           Json?
  policyVersion               String?
  isActive                    Boolean             @default(true)
  rentalType                  String              @default("transient")
  equipmentTypes              String[]            @default([])
  slideOutsAccepted           String?
  occupantsIncluded           Int                 @default(2)
  extraAdultFeeCents          Int?
  extraChildFeeCents          Int?
  petFeeEnabled               Boolean             @default(false)
  petFeeCents                 Int?
  bookingFeeCents             Int?
  siteLockFeeCents            Int?
  monthlyRateCents            Int?
  weeklyRateCents             Int?
  createdAt                   DateTime            @default(now())
  updatedAt                   DateTime            @default(now())
  AnalyticsEvent              AnalyticsEvent[]
  DemandBand                  DemandBand[]
  DepositPolicy               DepositPolicy[]
  DocumentTemplate            DocumentTemplate[]
  OtaListingMapping           OtaListingMapping[]
  PricingRule                 PricingRule[]
  PricingRuleV2               PricingRuleV2[]
  SeasonalRate                SeasonalRate[]
  Site                        Site[]
  Campground                  Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  UpsellItem                  UpsellItem[]
  WaitlistEntry               WaitlistEntry[]

  @@index([campgroundId])
}

model SiteHold {
  id            String     @id
  campgroundId  String
  siteId        String
  arrivalDate   DateTime
  departureDate DateTime
  expiresAt     DateTime?
  status        String     @default("active")
  note          String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @default(now())
  Campground    Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site          Site       @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([expiresAt])
  @@index([siteId])
}

model SiteMapAssignment {
  id           String       @id
  campgroundId String
  siteId       String       @unique
  shapeId      String       @unique
  label        String?
  rotation     Float?
  metadata     Json?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  Campground   Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteMapShape SiteMapShape @relation(fields: [shapeId], references: [id], onDelete: Cascade)
  Site         Site         @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([shapeId])
}

model SiteMapLayout {
  id           String     @id
  campgroundId String
  siteId       String     @unique
  geometry     Json
  centroid     Json?
  label        String?
  rotation     Float?
  metadata     Json?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site         Site       @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
}

model SiteMapShape {
  id                String             @id
  campgroundId      String
  name              String?
  geometry          Json
  centroid          Json?
  metadata          Json?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  SiteMapAssignment SiteMapAssignment?
  Campground        Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
}

model SmartLock {
  id           String     @id
  campgroundId String
  siteId       String?
  name         String?
  vendor       String
  externalId   String?
  status       String     @default("locked")
  batteryLevel Int?
  metadata     Json?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Site         Site?      @relation(fields: [siteId], references: [id])

  @@index([campgroundId])
  @@index([siteId])
}

model SocialContentAsset {
  id           String          @id
  campgroundId String
  title        String
  type         SocialAssetType
  url          String
  tags         String[]        @default([])
  notes        String?
  uploadedById String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime
  Campground   Campground      @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User?           @relation(fields: [uploadedById], references: [id])

  @@index([campgroundId])
  @@index([type])
}

model SocialOpportunityAlert {
  id           String              @id
  campgroundId String
  category     SocialAlertCategory
  message      String
  startsAt     DateTime?
  endsAt       DateTime?
  dismissed    Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime
  Campground   Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([category])
}

model SocialPerformanceInput {
  id           String      @id
  campgroundId String
  postId       String?
  likes        Int?
  reach        Int?
  comments     Int?
  saves        Int?
  shares       Int?
  notes        String?
  recordedAt   DateTime    @default(now())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime
  Campground   Campground  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SocialPost   SocialPost? @relation(fields: [postId], references: [id])

  @@index([campgroundId])
  @@index([postId])
  @@index([recordedAt])
}

model SocialPost {
  id                     String                   @id
  campgroundId           String
  title                  String
  platform               SocialPlatform
  status                 SocialPostStatus         @default(draft)
  category               SocialContentCategory?
  scheduledFor           DateTime?
  publishedFor           DateTime?
  caption                String?
  hashtags               String[]                 @default([])
  imagePrompt            String?
  notes                  String?
  templateId             String?
  assetUrls              String[]                 @default([])
  tags                   String[]                 @default([])
  ideaParkingLot         Boolean                  @default(false)
  suggestionId           String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  SocialPerformanceInput SocialPerformanceInput[]
  Campground             Campground               @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SocialSuggestion       SocialSuggestion?        @relation(fields: [suggestionId], references: [id])
  SocialTemplate         SocialTemplate?          @relation(fields: [templateId], references: [id])

  @@index([campgroundId])
  @@index([platform, status])
  @@index([scheduledFor])
}

model SocialStrategy {
  id           String     @id
  campgroundId String
  month        DateTime
  annual       Boolean    @default(false)
  plan         Json
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, month])
}

model SocialSuggestion {
  id            String                 @id
  campgroundId  String
  type          SocialSuggestionType
  status        SocialSuggestionStatus @default(new)
  message       String
  reason        Json?
  category      SocialContentCategory?
  platform      SocialPlatform?
  proposedDate  DateTime?
  opportunityAt DateTime?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime
  SocialPost    SocialPost[]
  Campground    Campground             @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([proposedDate])
  @@index([type, status])
}

model SocialTemplate {
  id             String                 @id
  campgroundId   String
  name           String
  summary        String?
  category       SocialContentCategory?
  style          SocialTemplateStyle?
  defaultCaption String?
  captionFillIns String?
  imageGuidance  String?
  hashtagSet     String[]               @default([])
  bestTime       String?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime
  SocialPost     SocialPost[]
  Campground     Campground             @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
}

model SocialWeeklyIdea {
  id           String     @id
  campgroundId String
  generatedFor DateTime
  ideas        Json
  cadence      Json?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, generatedFor])
  @@index([generatedFor])
}

model SoftwarePage {
  id                String    @id
  slug              String    @unique
  type              String
  title             String
  metaTitle         String?
  metaDescription   String?
  heroImageUrl      String?
  content           Json?
  competitorName    String?
  competitorSlug    String?
  primaryKeyword    String?
  secondaryKeywords String[]  @default([])
  isPublished       Boolean   @default(false)
  publishedAt       DateTime?
  pageViews         Int       @default(0)
  conversions       Int       @default(0)
  lastViewedAt      DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime

  @@index([competitorSlug])
  @@index([isPublished])
  @@index([type])
}

model StaffAvailability {
  id           String     @id
  campgroundId String
  userId       String
  dayOfWeek    Int
  startTime    String
  endTime      String
  isAvailable  Boolean    @default(true)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, userId, dayOfWeek])
}

model StaffBreak {
  id             String         @id
  timeEntryId    String
  type           BreakType
  startedAt      DateTime
  endedAt        DateTime?
  durationMins   Int?
  note           String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  StaffTimeEntry StaffTimeEntry @relation(fields: [timeEntryId], references: [id], onDelete: Cascade)

  @@index([timeEntryId])
}

model StaffPerformance {
  id              String     @id
  campgroundId    String
  userId          String
  periodStart     DateTime   @db.Date
  periodEnd       DateTime   @db.Date
  tasksCompleted  Int        @default(0)
  tasksSlaOnTime  Int        @default(0)
  checkinsHandled Int        @default(0)
  avgTaskMinutes  Float?
  hoursWorked     Float?
  notes           String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  Campground      Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User            User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, userId, periodStart, periodEnd])
  @@index([campgroundId, periodStart])
}

model StaffRole {
  id           String       @id
  campgroundId String
  code         String
  name         String
  hourlyRate   Decimal?     @db.Decimal(10, 2)
  earningCode  String?
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  Campground   Campground   @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StaffShift   StaffShift[]

  @@unique([campgroundId, code])
  @@index([campgroundId, isActive])
}

model StaffShift {
  id                String              @id
  campgroundId      String
  userId            String
  roleId            String?
  shiftDate         DateTime            @db.Date
  startTime         DateTime
  endTime           DateTime
  role              String?
  status            ShiftStatus         @default(scheduled)
  scheduledMinutes  Int?
  actualMinutes     Int?
  notes             String?
  clockedInAt       DateTime?
  clockedOutAt      DateTime?
  approvedById      String?
  approvedAt        DateTime?
  approvalNote      String?
  createdBy         String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  PayrollExportLine PayrollExportLine[]
  ShiftApproval     ShiftApproval[]
  ShiftSwapRequest  ShiftSwapRequest[]
  Campground        Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StaffRole         StaffRole?          @relation(fields: [roleId], references: [id])
  User              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  StaffTimeEntry    StaffTimeEntry[]

  @@index([campgroundId, shiftDate])
  @@index([roleId])
  @@index([status])
  @@index([userId, shiftDate])
}

model StaffTimeEntry {
  id                                     String              @id
  shiftId                                String
  campgroundId                           String
  userId                                 String
  clockInAt                              DateTime
  clockOutAt                             DateTime?
  source                                 TimeEntrySource     @default(web)
  status                                 TimeEntryStatus     @default(open)
  note                                   String?
  approvedById                           String?
  approvedAt                             DateTime?
  createdAt                              DateTime            @default(now())
  updatedAt                              DateTime
  PayrollExportLine                      PayrollExportLine[]
  StaffBreak                             StaffBreak[]
  User_StaffTimeEntry_approvedByIdToUser User?               @relation("StaffTimeEntry_approvedByIdToUser", fields: [approvedById], references: [id])
  StaffShift                             StaffShift          @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  User_StaffTimeEntry_userIdToUser       User                @relation("StaffTimeEntry_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId, userId, status])
  @@index([shiftId])
}

model StayRule {
  id               String     @id
  campgroundId     String
  name             String
  minNights        Int        @default(1)
  maxNights        Int        @default(28)
  siteClasses      String[]   @default([])
  dateRanges       Json       @default("[]")
  ignoreDaysBefore Int        @default(0)
  isActive         Boolean    @default(true)
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  Campground       Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, isActive])
}

model StoreLocation {
  id                                                                String                  @id
  campgroundId                                                      String
  name                                                              String
  code                                                              String?
  type                                                              StoreLocationType       @default(physical)
  isDefault                                                         Boolean                 @default(false)
  isActive                                                          Boolean                 @default(true)
  acceptsOnline                                                     Boolean                 @default(false)
  sortOrder                                                         Int                     @default(0)
  createdAt                                                         DateTime                @default(now())
  updatedAt                                                         DateTime                @default(now())
  ExternalPosSale                                                   ExternalPosSale[]
  InventoryBatch                                                    InventoryBatch[]
  InventoryMovement                                                 InventoryMovement[]
  InventoryTransfer_InventoryTransfer_fromLocationIdToStoreLocation InventoryTransfer[]     @relation("InventoryTransfer_fromLocationIdToStoreLocation")
  InventoryTransfer_InventoryTransfer_toLocationIdToStoreLocation   InventoryTransfer[]     @relation("InventoryTransfer_toLocationIdToStoreLocation")
  LocationInventory                                                 LocationInventory[]
  LocationPriceOverride                                             LocationPriceOverride[]
  PosTerminal                                                       PosTerminal[]
  Campground                                                        Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StoreOrder                                                        StoreOrder[]

  @@unique([campgroundId, name])
  @@index([campgroundId])
  @@index([isActive])
}

model StoreOrder {
  id                                  String                      @id
  campgroundId                        String
  reservationId                       String?
  guestId                             String?
  siteNumber                          String?
  channel                             OrderChannel                @default(pos)
  fulfillmentType                     String?
  deliveryInstructions                String?
  promisedAt                          DateTime?
  prepTimeMinutes                     Int?
  status                              OrderStatus                 @default(pending)
  paymentMethod                       PaymentMethod               @default(card)
  paymentIntentId                     String?
  subtotalCents                       Int                         @default(0)
  taxCents                            Int                         @default(0)
  totalCents                          Int                         @default(0)
  notes                               String?
  createdBy                           String?
  seenAt                              DateTime?
  readyAt                             DateTime?
  deliveredAt                         DateTime?
  completedAt                         DateTime?
  completedById                       String?
  fulfillmentLocationId               String?
  fulfillmentStatus                   FulfillmentAssignmentStatus @default(unassigned)
  assignedAt                          DateTime?
  assignedById                        String?
  createdAt                           DateTime                    @default(now())
  updatedAt                           DateTime                    @default(now())
  User_StoreOrder_assignedByIdToUser  User?                       @relation("StoreOrder_assignedByIdToUser", fields: [assignedById], references: [id])
  Campground                          Campground                  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_StoreOrder_completedByIdToUser User?                       @relation("StoreOrder_completedByIdToUser", fields: [completedById], references: [id])
  StoreLocation                       StoreLocation?              @relation(fields: [fulfillmentLocationId], references: [id])
  Guest                               Guest?                      @relation(fields: [guestId], references: [id])
  Reservation                         Reservation?                @relation(fields: [reservationId], references: [id])
  StoreOrderAdjustment                StoreOrderAdjustment[]
  StoreOrderItem                      StoreOrderItem[]

  @@index([campgroundId])
  @@index([fulfillmentLocationId])
  @@index([fulfillmentStatus])
  @@index([guestId])
  @@index([reservationId])
  @@index([seenAt])
  @@index([status])
}

model StoreOrderAdjustment {
  id                String              @id
  orderId           String
  type              StoreAdjustmentType @default(refund)
  amountCents       Int
  note              String?
  items             Json?
  createdById       String?
  stripeRefundId    String?
  refundStatus      String?
  refundError       String?
  inventoryRestored Boolean             @default(false)
  notificationSent  Boolean             @default(false)
  createdAt         DateTime            @default(now())
  User              User?               @relation(fields: [createdById], references: [id])
  StoreOrder        StoreOrder          @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([orderId])
  @@index([type])
}

model StoreOrderItem {
  id           String        @id
  orderId      String
  productId    String?
  addOnId      String?
  name         String
  qty          Int           @default(1)
  unitCents    Int
  totalCents   Int
  createdAt    DateTime      @default(now())
  AddOnService AddOnService? @relation(fields: [addOnId], references: [id])
  StoreOrder   StoreOrder    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  Product      Product?      @relation(fields: [productId], references: [id])

  @@index([addOnId])
  @@index([orderId])
  @@index([productId])
}

model StoredValueAccount {
  id                String               @id
  campgroundId      String
  scopeType         StoredValueScopeType @default(campground)
  scopeId           String?
  type              StoredValueType
  currency          String
  status            StoredValueStatus    @default(active)
  issuedAt          DateTime
  expiresAt         DateTime?
  liabilityAccount  String?
  createdBy         String?
  createdVia        String?
  metadata          Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  guestId           String?
  Campground        Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest             Guest?               @relation(fields: [guestId], references: [id])
  StoredValueCode   StoredValueCode[]
  StoredValueHold   StoredValueHold[]
  StoredValueLedger StoredValueLedger[]

  @@index([campgroundId])
  @@index([guestId])
  @@index([scopeType, scopeId])
  @@index([status])
}

model StoredValueCode {
  id                 String             @id
  accountId          String
  code               String             @unique
  pinHash            String?
  active             Boolean            @default(true)
  redeemedByGuestId  String?
  createdAt          DateTime           @default(now())
  StoredValueAccount StoredValueAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  Guest              Guest?             @relation(fields: [redeemedByGuestId], references: [id])

  @@index([accountId])
}

model StoredValueHold {
  id                 String                @id
  accountId          String
  amountCents        Int
  status             StoredValueHoldStatus @default(open)
  expiresAt          DateTime
  referenceType      String
  referenceId        String
  idempotencyKey     String
  createdAt          DateTime              @default(now())
  updatedAt          DateTime
  StoredValueAccount StoredValueAccount    @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId, status])
}

model StoredValueLedger {
  id                 String               @id
  campgroundId       String
  issuerCampgroundId String?
  scopeType          StoredValueScopeType @default(campground)
  scopeId            String?
  accountId          String
  direction          StoredValueDirection
  amountCents        Int
  currency           String
  beforeBalanceCents Int
  afterBalanceCents  Int
  referenceType      String
  referenceId        String
  idempotencyKey     String
  actorType          String?
  actorId            String?
  channel            String?
  reason             String?
  createdAt          DateTime             @default(now())
  StoredValueAccount StoredValueAccount   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  Campground         Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([accountId, createdAt])
  @@index([campgroundId, idempotencyKey])
  @@index([issuerCampgroundId])
  @@index([scopeType, scopeId])
}

model StripeCustomer {
  id                     String               @id
  campgroundId           String
  guestId                String
  stripeCustomerId       String
  email                  String?
  defaultPaymentMethodId String?
  metadata               Json?
  createdAt              DateTime             @default(now())
  updatedAt              DateTime
  GuestPaymentMethod     GuestPaymentMethod[]
  Campground             Campground           @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest                  Guest                @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, guestId])
  @@unique([campgroundId, stripeCustomerId])
  @@index([guestId])
  @@index([stripeCustomerId])
}

model StripeTerminalLocation {
  id                   String                 @id
  campgroundId         String
  stripeLocationId     String
  displayName          String
  address              Json?
  metadata             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  Campground           Campground             @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StripeTerminalReader StripeTerminalReader[]

  @@unique([campgroundId, stripeLocationId])
  @@index([campgroundId])
}

model StripeTerminalReader {
  id                     String                  @id
  campgroundId           String
  locationId             String?
  stripeReaderId         String
  label                  String
  registrationCode       String?
  deviceType             String
  serialNumber           String?
  status                 String                  @default("offline")
  lastSeenAt             DateTime?
  ipAddress              String?
  firmwareVersion        String?
  metadata               Json?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  Campground             Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  StripeTerminalLocation StripeTerminalLocation? @relation(fields: [locationId], references: [id])

  @@unique([campgroundId, stripeReaderId])
  @@index([campgroundId, status])
  @@index([locationId])
}

model StructureAttributes {
  id                String   @id
  siteId            String   @unique
  bedConfiguration  Json?
  bedroomCount      Int?
  bathroomCount     Int?
  bathroomType      String?
  hasKitchen        Boolean  @default(false)
  kitchenType       String?
  hasHeat           Boolean  @default(false)
  hasAC             Boolean  @default(false)
  hasFireplace      Boolean  @default(false)
  floorNumber       Int?
  buildingName      String?
  squareFeet        Int?
  hasBalcony        Boolean  @default(false)
  hasPatio          Boolean  @default(false)
  viewType          String?
  linensProvided    Boolean  @default(true)
  towelsProvided    Boolean  @default(true)
  connectingRoomIds String[] @default([])
  isConnecting      Boolean  @default(false)
  minibar           Boolean  @default(false)
  roomService       Boolean  @default(false)
  safe              Boolean  @default(false)
  coffeemaker       Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  Site              Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([siteId])
}

model SupportReport {
  id                                  String              @id
  createdAt                           DateTime            @default(now())
  updatedAt                           DateTime
  description                         String
  steps                               String?
  contactEmail                        String?
  path                                String?
  userAgent                           String?
  language                            String?
  timezone                            String?
  viewportWidth                       Int?
  viewportHeight                      Int?
  roleFilter                          String?
  pinnedIds                           String[]
  recentIds                           String[]
  rawContext                          Json?
  status                              SupportReportStatus @default(new)
  assigneeId                          String?
  authorId                            String?
  campgroundId                        String?
  User_SupportReport_assigneeIdToUser User?               @relation("SupportReport_assigneeIdToUser", fields: [assigneeId], references: [id])
  User_SupportReport_authorIdToUser   User?               @relation("SupportReport_authorIdToUser", fields: [authorId], references: [id])
  Campground                          Campground?         @relation(fields: [campgroundId], references: [id])
}

model Task {
  id               String             @id
  tenantId         String
  type             TaskType
  state            TaskState
  priority         String?
  siteId           String
  reservationId    String?
  assignedToUserId String?
  assignedToTeamId String?
  slaDueAt         DateTime?
  slaStatus        SlaStatus          @default(on_track)
  checklist        Json?
  photos           Json?
  notes            String?
  source           String?
  createdBy        String
  templateId       String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  InspectionResult InspectionResult[]

  @@index([tenantId, siteId, state])
  @@index([tenantId, slaStatus])
}

model TaxRule {
  id             String      @id
  campgroundId   String
  name           String
  type           TaxRuleType
  rate           Decimal?    @db.Decimal(10, 4)
  minNights      Int?
  maxNights      Int?
  category       String      @default("general")
  requiresWaiver Boolean     @default(false)
  waiverText     String?
  isActive       Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @default(now())
  Campground     Campground  @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
}

model Ticket {
  id          String         @id
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @default(now())
  completedAt DateTime?
  title       String
  notes       String?
  category    TicketCategory @default(issue)
  area        String?
  url         String?
  path        String?
  pageTitle   String?
  selection   String?
  status      TicketState    @default(open)
  agentNotes  String?
  votes       Int            @default(0)
  submitter   Json?
  upvoters    Json?
  client      Json?
  extra       Json?

  @@index([category])
  @@index([createdAt])
  @@index([status])
}

model TillMovement {
  id           String           @id
  sessionId    String
  type         TillMovementType
  amountCents  Int
  currency     String
  sourceCartId String?
  actorUserId  String
  note         String?
  createdAt    DateTime         @default(now())
  User         User             @relation(fields: [actorUserId], references: [id], onDelete: Cascade)
  TillSession  TillSession      @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  PosCart      PosCart?         @relation(fields: [sourceCartId], references: [id])

  @@index([sessionId, type])
  @@index([sourceCartId])
}

model TillSession {
  id                                    String            @id
  campgroundId                          String
  terminalId                            String?
  status                                TillSessionStatus @default(open)
  openingFloatCents                     Int               @default(0)
  expectedCloseCents                    Int               @default(0)
  countedCloseCents                     Int?
  overShortCents                        Int               @default(0)
  currency                              String
  notes                                 String?
  openedByUserId                        String
  closedByUserId                        String?
  openedAt                              DateTime          @default(now())
  closedAt                              DateTime?
  createdAt                             DateTime          @default(now())
  updatedAt                             DateTime
  TillMovement                          TillMovement[]
  Campground                            Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_TillSession_closedByUserIdToUser User?             @relation("TillSession_closedByUserIdToUser", fields: [closedByUserId], references: [id])
  User_TillSession_openedByUserIdToUser User              @relation("TillSession_openedByUserIdToUser", fields: [openedByUserId], references: [id], onDelete: Cascade)
  PosTerminal                           PosTerminal?      @relation(fields: [terminalId], references: [id])

  @@index([campgroundId, status])
  @@index([terminalId, status])
}

model TimeOffRequest {
  id                                   String        @id
  campgroundId                         String
  userId                               String
  type                                 TimeOffType
  status                               TimeOffStatus @default(pending)
  startDate                            DateTime      @db.Date
  endDate                              DateTime      @db.Date
  hoursRequested                       Float?
  reason                               String?
  reviewerId                           String?
  reviewerNote                         String?
  reviewedAt                           DateTime?
  createdAt                            DateTime      @default(now())
  updatedAt                            DateTime
  Campground                           Campground    @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User_TimeOffRequest_reviewerIdToUser User?         @relation("TimeOffRequest_reviewerIdToUser", fields: [reviewerId], references: [id])
  User_TimeOffRequest_userIdToUser     User          @relation("TimeOffRequest_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId, status])
  @@index([reviewerId])
  @@index([userId, startDate])
}

model UpsellBundle {
  id                String              @id
  campgroundId      String
  name              String
  priceMode         String
  bundlePrice       Int?
  active            Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  ReservationUpsell ReservationUpsell[]
  Campground        Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  UpsellBundleItem  UpsellBundleItem[]
}

model UpsellBundleItem {
  id           String       @id
  bundleId     String
  itemId       String
  required     Boolean      @default(true)
  quantity     Int          @default(1)
  UpsellBundle UpsellBundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  UpsellItem   UpsellItem   @relation(fields: [itemId], references: [id], onDelete: Cascade)
}

model UpsellItem {
  id                String              @id
  campgroundId      String
  siteClassId       String?
  name              String
  description       String?
  priceType         UpsellPriceType
  priceCents        Int
  taxCode           String?
  inventoryTracking Boolean             @default(false)
  active            Boolean             @default(true)
  version           Int                 @default(1)
  createdBy         String?
  updatedBy         String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  ReservationUpsell ReservationUpsell[]
  UpsellBundleItem  UpsellBundleItem[]
  Campground        Campground          @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  SiteClass         SiteClass?          @relation(fields: [siteClassId], references: [id])
}

model UsageEvent {
  id              String       @id
  organizationId  String
  campgroundId    String?
  eventType       String
  quantity        Int          @default(1)
  unitCents       Int?
  referenceType   String?
  referenceId     String?
  billingPeriodId String?
  billed          Boolean      @default(false)
  billedAt        DateTime?
  metadata        Json?
  createdAt       DateTime     @default(now())
  Campground      Campground?  @relation(fields: [campgroundId], references: [id])
  Organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([billed])
  @@index([billingPeriodId])
  @@index([campgroundId])
  @@index([createdAt])
  @@index([eventType])
  @@index([organizationId])
}

model User {
  id                                                      String                            @id
  email                                                   String                            @unique
  passwordHash                                            String
  firstName                                               String
  lastName                                                String
  region                                                  String?
  platformRole                                            PlatformRole?
  platformRegion                                          String?
  platformActive                                          Boolean                           @default(true)
  ownershipRoles                                          String[]                          @default([])
  isActive                                                Boolean                           @default(true)
  mustChangePassword                                      Boolean                           @default(false)
  totpEnabled                                             Boolean                           @default(false)
  totpSecret                                              String?
  totpPendingSecret                                       String?
  totpBackupCodes                                         Json?
  totpEnabledAt                                           DateTime?
  createdAt                                               DateTime                          @default(now())
  updatedAt                                               DateTime                          @default(now())
  AnalyticsSession                                        AnalyticsSession[]
  AnalyticsStaffMetrics                                   AnalyticsStaffMetrics[]
  ApprovalPolicy                                          ApprovalPolicy[]
  AuditExport                                             AuditExport[]
  AuditLog                                                AuditLog[]
  AvailabilityOverride                                    AvailabilityOverride[]
  BatchMovement                                           BatchMovement[]
  Campground                                              Campground[]
  CampgroundClaim                                         CampgroundClaim[]
  CampgroundMembership                                    CampgroundMembership[]
  CommunicationTemplate                                   CommunicationTemplate[]
  ExpirationAlert                                         ExpirationAlert[]
  FeatureProgress                                         FeatureProgress[]
  InspectionResult                                        InspectionResult[]
  IntegrationExportJob                                    IntegrationExportJob[]
  InternalConversationParticipant                         InternalConversationParticipant[]
  InternalMessage                                         InternalMessage[]
  InventoryMovement                                       InventoryMovement[]
  InventoryTransfer_InventoryTransfer_approvedByIdToUser  InventoryTransfer[]               @relation("InventoryTransfer_approvedByIdToUser")
  InventoryTransfer_InventoryTransfer_completedByIdToUser InventoryTransfer[]               @relation("InventoryTransfer_completedByIdToUser")
  InventoryTransfer_InventoryTransfer_requestedByIdToUser InventoryTransfer[]               @relation("InventoryTransfer_requestedByIdToUser")
  InviteToken                                             InviteToken[]
  MaintenanceTicket                                       MaintenanceTicket[]
  MobileDeviceToken                                       MobileDeviceToken[]
  MobileSession                                           MobileSession[]
  OAuthToken                                              OAuthToken[]
  OnboardingInvite                                        OnboardingInvite[]
  OpRecurrenceRule                                        OpRecurrenceRule[]
  OpStaffBadge                                            OpStaffBadge[]
  OpStaffDailyStats                                       OpStaffDailyStats[]
  OpStaffStats                                            OpStaffStats[]
  OpTask_OpTask_assignedToUserIdToUser                    OpTask[]                          @relation("OpTask_assignedToUserIdToUser")
  OpTask_OpTask_completedByIdToUser                       OpTask[]                          @relation("OpTask_completedByIdToUser")
  OpTask_OpTask_createdByIdToUser                         OpTask[]                          @relation("OpTask_createdByIdToUser")
  OpTask_OpTask_slaEscalatedToIdToUser                    OpTask[]                          @relation("OpTask_slaEscalatedToIdToUser")
  OpTask_OpTask_verifiedByIdToUser                        OpTask[]                          @relation("OpTask_verifiedByIdToUser")
  OpTaskComment                                           OpTaskComment[]
  OpTaskTemplate                                          OpTaskTemplate[]
  OpTaskTrigger                                           OpTaskTrigger[]
  OpTeamMember                                            OpTeamMember[]
  OverrideRequest_OverrideRequest_approverIdToUser        OverrideRequest[]                 @relation("OverrideRequest_approverIdToUser")
  OverrideRequest_OverrideRequest_userIdToUser            OverrideRequest[]                 @relation("OverrideRequest_userIdToUser")
  PayrollExport                                           PayrollExport[]
  PayrollExportLine                                       PayrollExportLine[]
  PermissionRule                                          PermissionRule[]
  PiiFieldTag                                             PiiFieldTag[]
  PortfolioDashboard                                      PortfolioDashboard[]
  PushNotification                                        PushNotification[]
  PushSubscription                                        PushSubscription[]
  RoomMoveRequest_RoomMoveRequest_approvedByIdToUser      RoomMoveRequest[]                 @relation("RoomMoveRequest_approvedByIdToUser")
  RoomMoveRequest_RoomMoveRequest_completedByIdToUser     RoomMoveRequest[]                 @relation("RoomMoveRequest_completedByIdToUser")
  RoomMoveRequest_RoomMoveRequest_requestedByIdToUser     RoomMoveRequest[]                 @relation("RoomMoveRequest_requestedByIdToUser")
  SavedReport                                             SavedReport[]
  ScheduleTemplate                                        ScheduleTemplate[]
  ShiftApproval                                           ShiftApproval[]
  ShiftSwapRequest_ShiftSwapRequest_managerIdToUser       ShiftSwapRequest[]                @relation("ShiftSwapRequest_managerIdToUser")
  ShiftSwapRequest_ShiftSwapRequest_recipientUserIdToUser ShiftSwapRequest[]                @relation("ShiftSwapRequest_recipientUserIdToUser")
  ShiftSwapRequest_ShiftSwapRequest_requesterIdToUser     ShiftSwapRequest[]                @relation("ShiftSwapRequest_requesterIdToUser")
  SocialContentAsset                                      SocialContentAsset[]
  StaffAvailability                                       StaffAvailability[]
  StaffPerformance                                        StaffPerformance[]
  StaffShift                                              StaffShift[]
  StaffTimeEntry_StaffTimeEntry_approvedByIdToUser        StaffTimeEntry[]                  @relation("StaffTimeEntry_approvedByIdToUser")
  StaffTimeEntry_StaffTimeEntry_userIdToUser              StaffTimeEntry[]                  @relation("StaffTimeEntry_userIdToUser")
  StoreOrder_StoreOrder_assignedByIdToUser                StoreOrder[]                      @relation("StoreOrder_assignedByIdToUser")
  StoreOrder_StoreOrder_completedByIdToUser               StoreOrder[]                      @relation("StoreOrder_completedByIdToUser")
  StoreOrderAdjustment                                    StoreOrderAdjustment[]
  SupportReport_SupportReport_assigneeIdToUser            SupportReport[]                   @relation("SupportReport_assigneeIdToUser")
  SupportReport_SupportReport_authorIdToUser              SupportReport[]                   @relation("SupportReport_authorIdToUser")
  TillMovement                                            TillMovement[]
  TillSession_TillSession_closedByUserIdToUser            TillSession[]                     @relation("TillSession_closedByUserIdToUser")
  TillSession_TillSession_openedByUserIdToUser            TillSession[]                     @relation("TillSession_openedByUserIdToUser")
  TimeOffRequest_TimeOffRequest_reviewerIdToUser          TimeOffRequest[]                  @relation("TimeOffRequest_reviewerIdToUser")
  TimeOffRequest_TimeOffRequest_userIdToUser              TimeOffRequest[]                  @relation("TimeOffRequest_userIdToUser")
  UserMenuConfig                                          UserMenuConfig?
  XpBalance                                               XpBalance[]
  XpEvent                                                 XpEvent[]
  XpRule                                                  XpRule[]
}

model UserMenuConfig {
  id                String   @id
  userId            String   @unique
  pinnedPages       String[] @default([])
  sidebarCollapsed  Boolean  @default(false)
  migratedFromLocal Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  User              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UtilityMeter {
  id               String             @id
  campgroundId     String
  siteId           String
  type             String
  serialNumber     String?
  active           Boolean            @default(true)
  installedAt      DateTime           @default(now())
  removedAt        DateTime?
  ratePlanId       String?
  billingMode      String             @default("cycle")
  billTo           String             @default("reservation")
  multiplier       Decimal            @default(1.0)
  autoEmail        Boolean            @default(false)
  lastBilledReadAt DateTime?
  metadata         Json?
  Campground       Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  UtilityRatePlan  UtilityRatePlan?   @relation(fields: [ratePlanId], references: [id])
  Site             Site               @relation(fields: [siteId], references: [id], onDelete: Cascade)
  UtilityMeterRead UtilityMeterRead[]

  @@index([campgroundId])
  @@index([siteId, type])
}

model UtilityMeterRead {
  id           String       @id
  meterId      String
  readingValue Decimal
  readAt       DateTime
  source       String
  note         String?
  readBy       String?
  createdAt    DateTime     @default(now())
  UtilityMeter UtilityMeter @relation(fields: [meterId], references: [id], onDelete: Cascade)

  @@index([meterId, readAt])
}

model UtilityRatePlan {
  id             String         @id
  campgroundId   String
  type           String
  pricingMode    String
  baseRateCents  Int
  tiers          Json?
  demandFeeCents Int?
  minimumCents   Int?
  effectiveFrom  DateTime
  effectiveTo    DateTime?
  UtilityMeter   UtilityMeter[]
  Campground     Campground     @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId, type, effectiveFrom])
}

model Vehicle {
  id               String             @id
  campgroundId     String
  reservationId    String?            @unique
  guestId          String?
  plate            String?
  state            String?
  rigType          String?
  rigLength        Int?
  description      String?
  color            String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  AccessCredential AccessCredential[]
  AccessGrant      AccessGrant[]
  Campground       Campground         @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest            Guest?             @relation(fields: [guestId], references: [id])
  Reservation      Reservation?       @relation(fields: [reservationId], references: [id])

  @@index([campgroundId])
  @@index([plate, state])
}

model WaitlistEntry {
  id                     String                  @id
  campgroundId           String
  guestId                String?
  siteId                 String?
  siteTypeId             String?
  arrivalDate            DateTime?
  departureDate          DateTime?
  status                 WaitlistStatus          @default(active)
  type                   WaitlistType            @default(regular)
  contactName            String?
  contactEmail           String?
  contactPhone           String?
  notes                  String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @default(now())
  lastNotifiedAt         DateTime?
  notifiedCount          Int                     @default(0)
  priority               Int                     @default(50)
  autoOffer              Boolean                 @default(false)
  maxPrice               Int?
  flexibleDates          Boolean                 @default(false)
  flexibleDays           Int                     @default(0)
  convertedReservationId String?
  convertedAt            DateTime?
  throttleBucket         String?
  cooldownUntil          DateTime?
  lastOfferSentAt        DateTime?
  lastOfferStatus        String?
  offerCount             Int                     @default(0)
  AiWaitlistScore        AiWaitlistScore?
  Campground             Campground              @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  Guest                  Guest?                  @relation(fields: [guestId], references: [id], onDelete: Cascade)
  Site                   Site?                   @relation(fields: [siteId], references: [id])
  SiteClass              SiteClass?              @relation(fields: [siteTypeId], references: [id])
  WaitlistInventoryHold  WaitlistInventoryHold[]
  WaitlistOffer          WaitlistOffer[]

  @@index([arrivalDate])
  @@index([campgroundId])
  @@index([guestId])
  @@index([priority])
  @@index([status])
  @@index([type])
}

model WaitlistInventoryHold {
  id            String         @id
  inventoryRef  String
  entryId       String?
  status        String         @default("held")
  holdExpiresAt DateTime
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  WaitlistEntry WaitlistEntry? @relation(fields: [entryId], references: [id])

  @@index([entryId])
  @@index([inventoryRef, status])
}

model WaitlistOffer {
  id              String              @id
  entryId         String
  inventoryRef    String
  offerExpiresAt  DateTime
  sentAt          DateTime?
  acceptedAt      DateTime?
  declinedAt      DateTime?
  autoExpiredAt   DateTime?
  status          WaitlistOfferStatus @default(pending)
  commsTemplateId String?
  idempotencyKey  String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime
  WaitlistEntry   WaitlistEntry       @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@index([entryId, status])
  @@index([idempotencyKey])
  @@index([inventoryRef])
}

model WaiverTemplate {
  id           String     @id
  campgroundId String
  name         String
  content      String
  version      Int        @default(1)
  isDefault    Boolean    @default(false)
  isActive     Boolean    @default(true)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
}

model WebhookDelivery {
  id                String          @id
  webhookEndpointId String
  eventType         String
  status            String
  payload           Json
  responseStatus    Int?
  responseBody      String?
  attempt           Int             @default(1)
  signature         String?
  createdAt         DateTime        @default(now())
  deliveredAt       DateTime?
  errorMessage      String?
  replayOfId        String?
  nextRetryAt       DateTime?
  WebhookEndpoint   WebhookEndpoint @relation(fields: [webhookEndpointId], references: [id], onDelete: Cascade)

  @@index([eventType])
  @@index([status])
  @@index([status, nextRetryAt])
  @@index([webhookEndpointId, createdAt])
}

model WebhookEndpoint {
  id              String            @id
  campgroundId    String
  apiClientId     String?
  url             String
  secret          String
  eventTypes      String[]
  description     String?
  isActive        Boolean           @default(true)
  disabledAt      DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  WebhookDelivery WebhookDelivery[]
  ApiClient       ApiClient?        @relation(fields: [apiClientId], references: [id])
  Campground      Campground        @relation(fields: [campgroundId], references: [id], onDelete: Cascade)

  @@index([apiClientId])
  @@index([campgroundId, isActive])
}

model WorkflowExecution {
  id                    String                  @id
  workflowId            String
  reservationId         String?
  guestId               String?
  status                WorkflowExecutionStatus @default(pending)
  currentStep           Int                     @default(0)
  context               Json?
  startedAt             DateTime?
  completedAt           DateTime?
  error                 String?
  createdAt             DateTime                @default(now())
  CommunicationWorkflow CommunicationWorkflow   @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([reservationId])
  @@index([workflowId, status])
}

model WorkflowStep {
  id                    String                @id
  workflowId            String
  stepOrder             Int
  actionType            String
  config                Json
  isActive              Boolean               @default(true)
  CommunicationWorkflow CommunicationWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId, stepOrder])
}

model XpBalance {
  id           String     @id
  campgroundId String
  userId       String
  totalXp      Int        @default(0)
  currentLevel Int        @default(1)
  lastEventAt  DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @default(now())
  Campground   Campground @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([campgroundId, userId])
  @@index([campgroundId])
  @@index([userId])
}

model XpEvent {
  id                   String                    @id
  campgroundId         String
  userId               String
  membershipId         String?
  category             GamificationEventCategory
  xp                   Int
  reason               String?
  sourceType           String?
  sourceId             String?
  eventKey             String?                   @unique
  metadata             Json?
  occurredAt           DateTime                  @default(now())
  createdAt            DateTime                  @default(now())
  Campground           Campground                @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  CampgroundMembership CampgroundMembership?     @relation(fields: [membershipId], references: [id])
  User                 User                      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campgroundId])
  @@index([campgroundId, userId])
  @@index([category])
  @@index([membershipId])
  @@index([userId])
}

model XpRule {
  id           String                    @id
  campgroundId String
  category     GamificationEventCategory
  minXp        Int                       @default(0)
  maxXp        Int                       @default(0)
  defaultXp    Int                       @default(0)
  isActive     Boolean                   @default(true)
  createdById  String?
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @default(now())
  Campground   Campground                @relation(fields: [campgroundId], references: [id], onDelete: Cascade)
  User         User?                     @relation(fields: [createdById], references: [id])

  @@unique([campgroundId, category])
  @@index([campgroundId])
  @@index([createdById])
}

enum AbTestStatus {
  draft
  active
  paused
  stopped
  completed
}

enum AccessCredentialType {
  pin
  card
  fob
  mobile
  qr
}

enum AccessGrantStatus {
  pending
  active
  revoked
  blocked
  expired
  failed
}

enum AccessProviderType {
  kisi
  brivo
  cloudkey
}

enum ActivitySchedulingMode {
  scheduled
  open_availability
}

enum AddOnPricingType {
  flat
  per_night
  per_person
}

enum AdjustmentType {
  percent
  flat
}

enum AiConsentType {
  booking_assist
  personalization
  communications
  analytics
}

enum AiFeatureType {
  reply_assist
  booking_assist
  analytics
  forecasting
  anomaly_detection
  recommendations
}

enum AnalyticsActorType {
  staff
  guest
  anonymous
  system
}

enum AnalyticsEventName {
  page_view
  site_card_view
  image_viewed
  image_hovered
  image_clicked
  site_class_viewed
  availability_check
  add_to_stay
  reservation_start
  reservation_abandoned
  reservation_completed
  deal_viewed
  deal_applied
  email_signup
  review_viewed
  admin_page_view
  admin_action
  admin_search
  admin_error
  admin_feature_use
  admin_session_start
  admin_session_end
  admin_pricing_change
  admin_image_reorder
  funnel_step
  funnel_abandon
  funnel_complete
  portal_login
  portal_view
  portal_action
}

enum AnalyticsType {
  overview
  geographic
  demographics
  seasonal_trends
  travel_behavior
  full_report
  segment
}

enum AnnouncementStatus {
  draft
  scheduled
  sent
}

enum AnnouncementTarget {
  all
  admins
  campground
}

enum AnnouncementType {
  info
  warning
  success
}

enum ApiClientTier {
  free
  standard
  enterprise
}

enum ApprovalStatus {
  pending
  approved
  rejected
}

enum AttemptOutcome {
  success
  failed
  partial
}

enum AttractionType {
  national_park
  state_park
  national_forest
  national_monument
  lake
  beach
  river
  mountain
  ski_resort
  theme_park
  historic_site
  scenic_byway
  wildlife_area
  recreation_area
  other
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  SYNC
  EXPORT
  IMPORT
}

enum AwardType {
  campground_of_year
  rising_star
  world_class
  top_1_percent
  top_5_percent
  top_10_percent
}

enum BackoffStrategy {
  fixed
  linear
  exponential
}

enum BatchDisposalReason {
  expired
  damaged
  quality_issue
  recall
  theft_loss
  donation
  sample
  other
}

enum BillingPlan {
  ota_only
  standard
  enterprise
}

enum BreakType {
  paid
  unpaid
  meal
  rest
}

enum CampaignSendStatus {
  queued
  sent
  failed
  unsubscribed
}

enum CampaignStatus {
  draft
  scheduled
  sending
  sent
  cancelled
}

enum CampgroundClaimStatus {
  unclaimed
  claim_pending
  claimed
}

enum CampgroundDataSource {
  recreation_gov
  reserve_california
  reserve_america
  nps
  usfs
  blm
  state_parks
  osm
  manual
  user_submitted
  claimed
}

enum ChannelInventoryMode {
  shared
  split
}

enum ChannelType {
  email
  sms
  both
}

enum ChargeStatus {
  pending
  paid
  failed
}

enum CharityPayoutStatus {
  pending
  processing
  completed
  failed
}

enum ChatMessageRole {
  user
  assistant
  tool
  system
}

enum ChatParticipantType {
  guest
  staff
}

enum CheckInStatus {
  not_started
  pending_id
  pending_payment
  pending_waiver
  pending_site_ready
  completed
  failed
}

enum CheckOutStatus {
  not_started
  pending_review
  completed
  failed
}

enum ClaimVerificationMethod {
  phone
  email
  document
  domain
  manual
}

enum CoiStatus {
  pending
  active
  expired
  voided
}

enum ConsentMethod {
  verbal
  written
  digital
}

enum DepositApplyTo {
  lodging_only
  lodging_plus_fees
}

enum DepositDueTiming {
  at_booking
  before_arrival
}

enum DepositStrategy {
  first_night
  percent
  fixed
}

enum DisputeStatus {
  warning_needs_response
  warning_under_review
  needs_response
  under_review
  charge_refunded
  won
  lost
}

enum DonationStatus {
  collected
  pending_payout
  paid_out
  refunded
}

enum DynamicPricingTrigger {
  occupancy_high
  occupancy_low
  demand_surge
  last_minute
  advance_booking
  event_proximity
  weather
  manual
}

enum EarlyAccessTier {
  founders_circle
  pioneer
  trailblazer
}

enum EventType {
  activity
  workshop
  entertainment
  holiday
  recurring
  ongoing
  themed
}

enum EvidenceType {
  photo
  document
  note
  audio
  video
  other
}

enum ExpirationTier {
  fresh
  warning
  critical
  expired
}

enum ExportFormat {
  csv
  json
  pdf
}

enum ExportStatus {
  pending
  processing
  completed
  failed
}

enum FeatureFlagScope {
  global
  campground
}

enum FeatureSetupStatus {
  setup_now
  setup_later
  skipped
  completed
}

enum FormAutoAttachMode {
  manual
  all_bookings
  site_classes
}

enum FormShowAt {
  during_booking
  at_checkin
  after_booking
  on_demand
}

enum FormSubmissionStatus {
  pending
  completed
  void
}

enum FormTemplateType {
  waiver
  vehicle
  intake
  custom
}

enum FulfillmentAssignmentStatus {
  unassigned
  assigned
  preparing
  ready
  completed
}

enum FulfillmentType {
  pickup
  curbside
  delivery
  table_service
}

enum GamificationEventCategory {
  task
  maintenance
  check_in
  reservation_quality
  checklist
  review_mention
  on_time_assignment
  assist
  manual
  other
  payment_collection
}

enum GlAccountType {
  asset
  liability
  equity
  revenue
  expense
}

enum GlPeriodStatus {
  open
  closed
  locked
}

enum GoalCategory {
  revenue
  bookings
  guests
  satisfaction
}

enum GoalStatus {
  on_track
  at_risk
  behind
  achieved
}

enum GoalUnit {
  currency
  percentage
  number
  score
}

enum GroupRole {
  primary
  member
}

enum GuaranteeType {
  unconditional
  conditional
  performance
  satisfaction
  weather
  best_price
}

enum HousekeepingStatus {
  vacant_dirty
  cleaning_in_progress
  pending_inspection
  inspection_failed
  vacant_clean
  vacant_inspected
  occupied
  occupied_service
  occupied_dnd
  out_of_order
  out_of_inventory
}

enum IdVerificationStatus {
  pending
  verified
  failed
  expired
}

enum IdempotencyStatus {
  pending
  inflight
  succeeded
  failed
}

enum IncidentStatus {
  open
  investigating
  resolved
  closed
}

enum IncidentTaskStatus {
  pending
  in_progress
  done
  cancelled
}

enum IncidentType {
  injury
  property_damage
  safety
  security
  near_miss
  environmental
  other
}

enum InventoryTransferStatus {
  pending
  in_transit
  completed
  cancelled
}

enum IssueCategory {
  database
  frontend
  performance
  security
  api
  infrastructure
  documentation
  other
}

enum IssuePriority {
  low
  medium
  high
  critical
}

enum IssueStatus {
  backlog
  todo
  in_progress
  review
  done
}

enum LockCodeRotationSchedule {
  none
  daily
  weekly
  monthly
  per_guest
}

enum LockCodeType {
  gate
  cabin
  amenity
  wifi
  master
}

enum MaintenancePriority {
  low
  medium
  high
  critical
}

enum MaintenanceStatus {
  open
  in_progress
  closed
}

enum MarkdownDiscountType {
  percentage
  flat
}

enum MarkdownScope {
  all
  category
  product
}

enum NpsInviteStatus {
  queued
  sent
  bounced
  opened
  responded
  expired
}

enum NpsSurveyStatus {
  draft
  active
  paused
  archived
}

enum OnboardingStatus {
  pending
  in_progress
  completed
  expired
  cancelled
}

enum ImportDraftStatus {
  pending_upload
  pending_classification
  pending_extraction
  extraction_complete
  review_in_progress
  confirmed
  imported
  failed
  expired
}

enum OnboardingStep {
  park_profile
  operational_hours
  stripe_connect
  inventory_choice
  data_import
  site_classes
  sites_builder
  rate_periods
  rates_setup
  fees_and_addons
  tax_rules
  booking_rules
  deposit_policy
  cancellation_rules
  waivers_documents
  park_rules
  team_setup
  communication_setup
  integrations
  menu_setup
  feature_discovery
  smart_quiz
  feature_triage
  guided_setup
  review_launch
  account_profile
  payment_gateway
  taxes_and_fees
  inventory_sites
  rates_and_fees
  policies
  communications_templates
  pos_hardware
  imports
}

enum OpBadgeCategory {
  speed
  volume
  quality
  streak
  teamwork
  milestone
  special
}

enum OpBadgeTier {
  bronze
  silver
  gold
  platinum
}

enum OpRecurrencePattern {
  daily
  weekly
  biweekly
  monthly
  seasonal
}

enum OpSlaStatus {
  on_track
  at_risk
  breached
}

enum OpTaskCategory {
  turnover
  housekeeping
  maintenance
  inspection
  grounds
  pool
  front_desk
  custom
}

enum OpTaskPriority {
  low
  medium
  high
  urgent
}

enum OpTaskState {
  pending
  assigned
  in_progress
  blocked
  completed
  verified
  cancelled
}

enum OpTriggerEvent {
  reservation_checkout
  reservation_checkin
  reservation_created
  reservation_cancelled
  reservation_modified
  maintenance_reported
  inspection_failed
  site_status_changed
  manual
}

enum OrderChannel {
  pos
  online
  kiosk
  portal
  internal
}

enum OrderStatus {
  pending
  ready
  delivered
  completed
  cancelled
  refunded
}

enum OrgBillingLineItemType {
  subscription
  booking_fee
  sms_outbound
  sms_inbound
  ai_usage
  overage
  credit
  discount
  early_access_discount
}

enum OrgBillingPeriodStatus {
  open
  processing
  invoiced
  paid
  past_due
  void
}

enum OrgReferralStatus {
  clicked
  signed_up
  converted
  credited
}

enum OverrideStatus {
  pending
  approved
  rejected
  cancelled
}

enum OverrideType {
  comp
  void
  discount
}

enum PaymentFeeMode {
  absorb
  pass_through
}

enum PaymentGatewayMode {
  test
  prod
}

enum PaymentGatewayProvider {
  stripe
  adyen
  authorize_net
  other
}

enum PaymentMethod {
  card
  cash
  charge_to_site
}

enum PaymentSchedule {
  single
  weekly
  monthly
  as_you_stay
  offseason_installments
}

enum PayoutReconStatus {
  pending
  matched
  drift
  failed
}

enum PayoutStatus {
  pending
  in_transit
  paid
  failed
  canceled
}

enum PayrollExportFormat {
  csv
  json
}

enum PayrollExportStatus {
  pending
  generated
  failed
}

enum PayrollProvider {
  generic
  onpay
  gusto
  adp
}

enum PermissionEffect {
  allow
  deny
}

enum PiiClassification {
  basic
  sensitive
  payment
  secret
}

enum PlatformRole {
  support_agent
  support_lead
  regional_support
  ops_engineer
  platform_admin
}

enum PosCartStatus {
  open
  checked_out
  void
}

enum PosIntegrationStatus {
  enabled
  disabled
  error
}

enum PosPaymentMethod {
  card
  cash
  gift
  store_credit
  charge_to_site
}

enum PosPaymentStatus {
  pending
  succeeded
  failed
  refunded
}

enum PosProviderCapability {
  payments
  items_sync
  receipts
  inventory_push
  inventory_pull
  markdown_sync
  expiration_sync
}

enum PosProviderType {
  clover
  square
  toast
  lightspeed
  shopify
  vend
}

enum PosReturnStatus {
  pending
  completed
  failed
}

enum PosSyncStatus {
  idle
  running
  succeeded
  failed
}

enum PosSyncTarget {
  catalog
  tenders
  payments
  inventory
  markdowns
}

enum PricingRuleType {
  season
  weekend
  holiday
  event
  demand
}

enum PricingStackMode {
  additive
  max
  override
}

enum PricingStructure {
  per_night
  flat_week
  flat_month
  flat_season
}

enum ProductInventoryMode {
  shared
  per_location
}

enum PromotionType {
  percentage
  flat
}

enum PushNotificationType {
  arrival
  departure
  task_assigned
  task_sla_warning
  maintenance_urgent
  payment_received
  payment_failed
  message_received
  general
}

enum RateParityAlertStatus {
  active
  acknowledged
  resolved
}

enum RateType {
  nightly
  weekly
  monthly
  seasonal
}

enum RecurrencePatternType {
  none
  daily
  weekly
  biweekly
  monthly
}

enum RedactionMode {
  mask
  remove
}

enum ReferralIncentiveType {
  percent_discount
  amount_discount
  credit
}

enum RenewalIntent {
  committed
  likely
  undecided
  not_renewing
}

enum ReportFrequency {
  daily
  weekly
  monthly
}

enum ReportScheduleFrequency {
  daily
  weekly
  monthly
  quarterly
}

enum ReportType {
  occupancy_summary
  revenue_summary
  arrivals_departures
  maintenance_summary
  reservation_activity
  guest_activity
  financial_summary
}

enum ReservationStatus {
  pending
  confirmed
  checked_in
  checked_out
  cancelled
}

enum ReviewExposure {
  private
  public
}

enum ReviewModerationStatus {
  pending
  approved
  rejected
}

enum ReviewSource {
  onsite
  email
  sms
  kiosk
  import
}

enum ReviewStatus {
  pending
  approved
  rejected
  removed
}

enum ReviewVoteValue {
  helpful
  not_helpful
}

enum SeasonalBillingFrequency {
  monthly
  biweekly
  semi_monthly
  quarterly
  semi_annual
  seasonal
  deposit_plus_monthly
  offseason_installments
  custom
}

enum SeasonalDiscountCondition {
  metered_utilities
  pay_in_full
  payment_method
  early_bird
  returning_guest
  tenure_years
  site_class
  referral
  military
  senior
  custom
}

enum SeasonalDiscountType {
  fixed_amount
  percentage
  per_month
}

enum SeasonalIncentiveType {
  guest_passes
  store_credit
  free_nights
  early_site_selection
  rate_lock
  amenity_access
  custom
}

enum SeasonalPaymentMethod {
  check
  cash
  card
  ach
  autopay
}

enum SeasonalPaymentStatus {
  scheduled
  due
  past_due
  paid
  partial
  waived
}

enum SeasonalStatus {
  active
  pending_renewal
  not_renewing
  departed
  waitlist
}

enum SegmentScope {
  global
  organization
  campground
}

enum SegmentStatus {
  active
  archived
}

enum SenderType {
  guest
  staff
}

enum SeoLocationType {
  country
  state
  region
  county
  city
  neighborhood
  attraction
}

enum SetupServiceStatus {
  pending
  in_progress
  completed
  cancelled
}

enum SetupServiceType {
  quick_start
  data_import_500
  data_import_2000
  data_import_5000
  data_import_custom
}

enum Severity {
  low
  med
  high
  critical
}

enum ShareAccessLevel {
  view_only
  downloadable
}

enum ShiftApprovalStatus {
  pending
  approved
  rejected
}

enum ShiftStatus {
  scheduled
  in_progress
  submitted
  approved
  rejected
}

enum SignatureDeliveryChannel {
  email
  sms
  email_and_sms
}

enum SignatureDocumentType {
  long_term_stay
  seasonal
  monthly
  park_rules
  deposit
  waiver
  coi
  other
}

enum SignatureMethod {
  digital
  paper
  waived
}

enum SignatureRequestStatus {
  preview
  draft
  sent
  viewed
  signed
  signed_paper
  waived
  declined
  voided
  expired
}

enum SiteType {
  rv
  tent
  cabin
  group
  glamping
  hotel_room
  suite
  lodge_room
  yurt
  treehouse
  tiny_house
  airstream
  safari_tent
  dome
  boat_slip
}

enum SlaStatus {
  on_track
  at_risk
  breached
}

enum SocialAlertCategory {
  weather
  occupancy
  events
  deals
  reviews
  inactivity
  inventory
}

enum SocialAssetType {
  photo
  video
  logo
  template
  other
}

enum SocialContentCategory {
  amenities
  events
  offers
  reviews
  tips
  general
  promo
}

enum SocialPlatform {
  facebook
  instagram
  tiktok
  email
  blog
}

enum SocialPostStatus {
  draft
  scheduled
  needs_image
  needs_approval
  ready
  completed
  dismissed
}

enum SocialSuggestionStatus {
  new
  accepted
  rejected
  published
}

enum SocialSuggestionType {
  idea
  auto
  operator
  occupancy
  event
  deal
  seasonal
}

enum SocialTemplateStyle {
  short
  detailed
  story
  carousel
  announce
}

enum StayReasonPreset {
  vacation
  family_visit
  event
  work_remote
  stopover
  relocation
  other
}

enum StayType {
  standard
  weekly
  monthly
  seasonal
}

enum StoreAdjustmentType {
  refund
  exchange
  discount
}

enum StoreLocationType {
  physical
  virtual
}

enum StoredValueDirection {
  issue
  redeem
  adjust
  expire
  refund
  hold_create
  hold_capture
  hold_release
}

enum StoredValueHoldStatus {
  open
  captured
  released
  expired
}

enum StoredValueScopeType {
  campground
  organization
  global
}

enum StoredValueStatus {
  active
  frozen
  expired
}

enum StoredValueType {
  gift
  credit
}

enum SubscriptionTier {
  free
  starter
  professional
  enterprise
}

enum SupportReportStatus {
  new
  triage
  in_progress
  resolved
  closed
}

enum SwapStatus {
  pending_recipient
  pending_manager
  approved
  rejected
  declined
  cancelled
}

enum TaskState {
  pending
  in_progress
  blocked
  done
  failed
  expired
}

enum TaskType {
  turnover
  inspection
  other
  deep_clean
  touch_up
  make_ready
  checkout_express
  vip_prep
  pet_treatment
  linen_change
  restocking
}

enum TaxRuleType {
  percentage
  flat
  exemption
}

enum TicketCategory {
  issue
  question
  feature
  other
}

enum TicketState {
  open
  in_progress
  blocked
  resolved
  reopened
  closed
}

enum TillMovementType {
  cash_sale
  cash_refund
  paid_in
  paid_out
  adjustment
}

enum TillSessionStatus {
  open
  closed
}

enum TimeEntrySource {
  kiosk
  mobile
  web
  manual
}

enum TimeEntryStatus {
  open
  submitted
  approved
  rejected
  corrected
}

enum TimeOffStatus {
  pending
  approved
  rejected
  cancelled
}

enum TimeOffType {
  vacation
  sick
  personal
  bereavement
  jury_duty
  unpaid
  other
}

enum UpsellChargeType {
  pay_now
  add_to_reservation
}

enum UpsellPriceType {
  flat
  per_night
  per_guest
  per_site
}

enum UpsellStatus {
  pending_charge
  charged
  canceled
}

enum UserRole {
  owner
  manager
  front_desk
  maintenance
  finance
  marketing
  readonly
}

enum WaitlistOfferStatus {
  pending
  sent
  accepted
  declined
  expired
  failed
}

enum WaitlistStatus {
  active
  fulfilled
  expired
  cancelled
}

enum WaitlistType {
  regular
  seasonal
}

enum WaiverReason {
  returning_same_terms
  corporate_agreement
  grandfathered
  family_member
  owner_discretion
  other
}

enum WaiverStatus {
  pending
  signed
  expired
  declined
}

enum WorkflowExecutionStatus {
  pending
  running
  completed
  failed
  cancelled
}

enum WorkflowStatus {
  active
  paused
  draft
  archived
}

enum WorkflowTrigger {
  reservation_created
  reservation_confirmed
  days_before_arrival
  check_in
  days_after_checkin
  check_out
  days_after_checkout
  payment_received
  payment_failed
  review_received
  birthday
  anniversary
  manual
}
